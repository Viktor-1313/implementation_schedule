<!DOCTYPE html>
<html>
<head>
    <title>Диагностика фиксации столбцов</title>
</head>
<body>
    <h1>Диагностика фиксации столбцов</h1>
    <p>Откройте консоль браузера (F12) и выполните следующие проверки:</p>
    
    <script>
        // Скопируйте и вставьте этот код в консоль браузера на странице с диаграммой Ганта
        
        function debugStickyColumns() {
            console.log('=== ДИАГНОСТИКА ФИКСАЦИИ СТОЛБЦОВ ===\n');
            
            // 1. Проверка наличия элемента ganttChart
            const chart = document.getElementById('ganttChart');
            if (!chart) {
                console.error('❌ Элемент #ganttChart не найден!');
                return;
            }
            console.log('✅ Элемент #ganttChart найден');
            
            // 2. Проверка родительского контейнера
            const chartContainer = chart.closest('.chart-container');
            if (!chartContainer) {
                console.error('❌ Родительский контейнер .chart-container не найден!');
            } else {
                const containerStyle = getComputedStyle(chartContainer);
                console.log('✅ Родительский контейнер .chart-container найден');
                console.log('   overflow-x:', containerStyle.overflowX);
                console.log('   overflow-y:', containerStyle.overflowY);
                if (containerStyle.overflowX === 'visible' && containerStyle.overflowY === 'visible') {
                    console.warn('⚠️ ПРОБЛЕМА: overflow-x и overflow-y = visible! Для sticky нужен auto или scroll');
                }
            }
            
            // 3. Проверка наличия элементов
            const selectors = [
                '.gantt-header-label',
                '.gantt-label',
                '.gantt-details-cell.start-col',
                '.gantt-details-cell.end-col',
                '.gantt-details-cell.days-col'
            ];
            
            console.log('\n--- Проверка элементов ---');
            selectors.forEach(selector => {
                const elements = chart.querySelectorAll(selector);
                console.log(`${selector}: найдено ${elements.length} элементов`);
                if (elements.length > 0) {
                    const firstEl = elements[0];
                    const style = getComputedStyle(firstEl);
                    console.log(`   position: ${style.position}`);
                    console.log(`   left: ${style.left}`);
                    console.log(`   z-index: ${style.zIndex}`);
                }
            });
            
            // 4. Проверка stickyColumns
            if (typeof stickyColumns !== 'undefined') {
                console.log('\n--- Состояние stickyColumns ---');
                console.log('stickyColumns:', Array.from(stickyColumns));
            } else {
                console.warn('⚠️ Переменная stickyColumns не определена!');
            }
            
            // 5. Проверка вызова функции
            console.log('\n--- Проверка функции updateStickyColumns ---');
            if (typeof updateStickyColumns === 'function') {
                console.log('✅ Функция updateStickyColumns определена');
                console.log('Вызываем функцию...');
                updateStickyColumns();
            } else {
                console.error('❌ Функция updateStickyColumns не определена!');
            }
            
            // 6. Проверка после вызова
            setTimeout(() => {
                console.log('\n--- Проверка после вызова функции ---');
                selectors.forEach(selector => {
                    const elements = chart.querySelectorAll(selector);
                    if (elements.length > 0) {
                        const firstEl = elements[0];
                        const style = getComputedStyle(firstEl);
                        console.log(`${selector}:`);
                        console.log(`   position: ${style.position}`);
                        console.log(`   left: ${style.left}`);
                        if (style.position === 'sticky') {
                            console.log('   ✅ position: sticky применен');
                        } else {
                            console.warn('   ⚠️ position: sticky НЕ применен!');
                        }
                    }
                });
            }, 100);
        }
        
        console.log('Для запуска диагностики выполните: debugStickyColumns()');
    </script>
    
    <h2>Инструкция:</h2>
    <ol>
        <li>Откройте страницу с диаграммой Ганта</li>
        <li>Откройте консоль браузера (F12)</li>
        <li>Скопируйте функцию debugStickyColumns из этого файла</li>
        <li>Вставьте в консоль и выполните: <code>debugStickyColumns()</code></li>
        <li>Проверьте вывод в консоли</li>
    </ol>
</body>
</html>
