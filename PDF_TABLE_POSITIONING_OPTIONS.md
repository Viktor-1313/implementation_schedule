# Варианты решения проблемы позиционирования таблиц в PDF

## Проблема
Таблицы смещаются вверх на каждом листе и могут быть разрезаны пополам между страницами.

## Варианты решения

### **ВАРИАНТ 1: Разбиение таблиц по строкам (РЕКОМЕНДУЕТСЯ)**
**Идея:** Вычисляем, сколько строк помещается на странице, и создаем несколько секций с отдельными таблицами.

**Плюсы:**
- ✅ Гарантирует, что таблица не будет разрезана посередине
- ✅ Каждая секция = одна страница с точным позиционированием
- ✅ Можно контролировать количество строк на странице
- ✅ Не требует замены библиотеки

**Минусы:**
- ⚠️ Нужно дублировать заголовок таблицы на каждой странице
- ⚠️ Немного сложнее код

**Реализация:**
- Высота страницы A3 landscape: ~297mm
- Высота шапки + заголовка: ~15mm
- Доступная высота для таблицы: ~282mm
- При высоте строки ~4mm: ~70 строк на странице
- С запасом: **60-65 строк на страницу**

**Код:**
```javascript
// Разбиваем задачи на части по 60 строк
const ROWS_PER_PAGE = 60;
const taskChunks = [];
for (let i = 0; i < tasks.length; i += ROWS_PER_PAGE) {
    taskChunks.push(tasks.slice(i, i + ROWS_PER_PAGE));
}

// Создаем отдельную секцию для каждого chunk
taskChunks.forEach((chunk, chunkIdx) => {
    const section = createPageSection(chunkIdx === 0);
    // ... создаем таблицу только с этими строками
    // Заголовок таблицы добавляем на каждую страницу
});
```

---

### **ВАРИАНТ 2: Фиксированная высота секций с overflow**
**Идея:** Задаем строго фиксированную высоту для секций и обрезаем/скрываем переполнение.

**Плюсы:**
- ✅ Простая реализация
- ✅ Жесткий контроль высоты

**Минусы:**
- ❌ Часть данных может быть обрезана
- ❌ Не решает проблему разрезания таблиц
- ❌ Нужно заранее вычислять высоту строк

---

### **ВАРИАНТ 3: Использование jsPDF напрямую (сложно)**
**Идея:** Заменяем html2pdf на jsPDF с ручным построением таблиц.

**Плюсы:**
- ✅ Полный контроль над позиционированием
- ✅ Можно точно задавать координаты каждой строки

**Минусы:**
- ❌ Требует полной переработки кода экспорта
- ❌ Сложнее поддерживать
- ❌ Потеря всех стилей из HTML
- ❌ Нужно вручную строить каждую ячейку

**Библиотеки:**
- `jspdf` + `jspdf-autotable` (для таблиц)

---

### **ВАРИАНТ 4: Гибридный подход (html2pdf + ручное разбиение)**
**Идея:** Комбинируем варианты 1 и 2 - разбиваем таблицы на части И задаем фиксированную высоту.

**Плюсы:**
- ✅ Максимальный контроль
- ✅ Гарантия, что ничего не обрежется

**Минусы:**
- ⚠️ Самый сложный код

---

## Рекомендация

**Выбрать ВАРИАНТ 1** - разбиение таблиц по строкам. Это оптимальный баланс между:
- Простотой реализации
- Надежностью
- Качеством результата

### Параметры для варианта 1:

**Для диаграммы Ганта:**
- Шапка: ~15mm
- Заголовок: ~5mm  
- Высота строки таблицы: ~4-5mm
- Доступная высота: ~275mm
- **Строк на странице: 50-55** (с запасом)

**Для детальной таблицы:**
- Шапка: ~15mm
- Заголовок: ~5mm
- Высота строки: ~6-7mm (могут быть длинные комментарии)
- Доступная высота: ~275mm
- **Строк на странице: 35-40** (с запасом для многострочных ячеек)

---

## Реализовано

✅ **ВАРИАНТ 1 реализован**

### Что сделано:

1. **Детальная таблица задач:**
   - Разбита на части по **35 строк** на страницу
   - Заголовок таблицы дублируется на каждой странице
   - Добавлена нумерация страниц в заголовке: "Детальная таблица задач (стр. 1 из 3)"

2. **Диаграмма Ганта:**
   - Разбита на части по **50 строк** на страницу
   - Заголовок таблицы дублируется на каждой странице
   - Поддержка разбиения как по временным диапазонам (chunks), так и по задачам

3. **Жесткое позиционирование:**
   - Отступ сверху секции: `8mm`
   - Отступ снизу шапки: `3mm`
   - Отступ снизу заголовка: `2mm`
   - У таблиц верхний отступ: `0`
   - Принудительные разрывы страниц между секциями

### Параметры:
- **Детальная таблица:** 35 строк на страницу (с запасом для длинных комментариев)
- **Диаграмма Ганта:** 50 строк на страницу (более компактные строки)

### Результат:
- ✅ Таблицы не разрезаются посередине
- ✅ Каждая секция = одна страница
- ✅ Точное позиционирование на каждой странице
- ✅ Все данные сохраняются, ничего не обрезается


