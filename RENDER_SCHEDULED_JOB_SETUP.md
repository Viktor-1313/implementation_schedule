# Быстрая настройка Render.com Scheduled Job

## Проблема
Сервер на Render.com засыпает после 15 минут бездействия. GitHub Actions может не работать для приватных репозиториев.

## Решение: Render.com Scheduled Jobs

Это встроенная функция Render.com, которая запускает скрипты по расписанию. Работает надежнее, чем внешние сервисы.

---

## Пошаговая инструкция

### 1. Откройте панель Render.com
- Войдите в ваш аккаунт на [render.com](https://render.com)
- Найдите ваш Web Service (например, `icona-design`)

### 2. Создайте новый Scheduled Job

**Способ 1: Через меню**
1. В левом верхнем углу нажмите **"New"**
2. Выберите **"Scheduled Job"**

**Способ 2: Через раздел Scheduled Jobs**
1. В левом меню найдите раздел **"Scheduled Jobs"**
2. Нажмите **"New Scheduled Job"**

### 3. Настройте Job

Заполните форму:

- **Name:** `Keep Service Alive`
- **Schedule:** `*/10 * * * *` (каждые 10 минут)
- **Command:** `node keep-alive.js`
- **Environment:** выберите тот же environment, что и у вашего Web Service
- **Working Directory:** 
  - Если репозиторий в корне, оставьте пустым
  - Если файлы в папке `1/`, укажите `1` (или измените команду на `cd 1 && node keep-alive.js`)

### 4. Переменные окружения (опционально)

Если ваш URL отличается от `https://icona-design.onrender.com`, добавьте переменную:

- **Key:** `RENDER_SERVICE_URL`
- **Value:** `https://ваш-проект.onrender.com`

**Где найти URL вашего сервиса:**
- В панели Render.com откройте ваш Web Service
- URL указан в разделе "Settings" → "Service Details"

### 5. Сохраните

Нажмите **"Create Scheduled Job"**

### 6. Проверьте работу

**Проверка 1: Логи Scheduled Job**
1. Откройте созданный Scheduled Job
2. Перейдите в раздел **"Logs"**
3. Должны появляться сообщения каждые 10 минут:
   ```
   [2025-01-15T12:00:00.000Z] Запуск keep-alive скрипта...
   [2025-01-15T12:00:00.000Z] Отправка запроса к: https://icona-design.onrender.com/health
   [2025-01-15T12:00:00.000Z] ✅ Успешно! Сервис активен
   ```

**Проверка 2: Логи Web Service**
1. Откройте ваш Web Service
2. Перейдите в раздел **"Logs"**
3. Должны появляться запросы к `/health` каждые 10 минут:
   ```
   GET /health 200
   ```

**Проверка 3: Вручную**
Откройте в браузере:
```
https://icona-design.onrender.com/health
```

Должен вернуться JSON:
```json
{
  "status": "ok",
  "timestamp": "2025-01-15T12:00:00.000Z",
  "uptime": 3600
}
```

---

## Настройка расписания

### Каждые 10 минут (рекомендуется)
```
*/10 * * * *
```

### Каждые 14 минут (максимум перед сном)
```
*/14 * * * *
```

### Каждые 5 минут (чаще, но больше запросов)
```
*/5 * * * *
```

**Формат cron:** `минута час день месяц день_недели`

---

## Устранение проблем

### Проблема: Job не запускается

**Решение:**
1. Проверьте, что файл `keep-alive.js` находится в корне репозитория (в папке `1/`)
2. Убедитесь, что в "Working Directory" указан путь к папке `1` (если репозиторий не в корне)
3. Проверьте логи Scheduled Job на наличие ошибок

### Проблема: Ошибка "Cannot find module"

**Решение:**
1. Убедитесь, что в "Environment" выбран тот же environment, что и у Web Service
2. Проверьте, что Node.js установлен (должен быть автоматически)

### Проблема: Сервис все еще засыпает

**Решение:**
1. Проверьте логи Scheduled Job — запускается ли он вообще
2. Уменьшите интервал до 5 минут: `*/5 * * * *`
3. Проверьте, что URL в переменной окружения правильный
4. Убедитесь, что эндпоинт `/health` работает (проверьте вручную в браузере)

---

## Преимущества Render.com Scheduled Jobs

✅ **Встроенная функция Render** — работает на той же платформе  
✅ **Максимальная надежность** — не зависит от внешних сервисов  
✅ **Работает для приватных репозиториев** — не требует публичного доступа  
✅ **Бесплатно** на бесплатном тарифе Render  
✅ **Простая настройка** через веб-интерфейс  

---

## Альтернативы

Если Render.com Scheduled Jobs недоступен, используйте:
- **cron-job.org** — простой внешний сервис (см. [`KEEP_ALIVE_SETUP.md`](KEEP_ALIVE_SETUP.md))
- **GitHub Actions** — для публичных репозиториев (см. [`KEEP_ALIVE_SETUP.md`](KEEP_ALIVE_SETUP.md))

