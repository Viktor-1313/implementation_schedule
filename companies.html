<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>–í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Open Graph –º–µ—Ç–∞—Ç–µ–≥–∏ –¥–ª—è –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫ -->
    <meta property="og:title" content="–í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –ì—Ä–∞—Ñ–∏–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è ICONA">
    <meta property="og:description" content="–í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏ –æ–±—É—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã ICONA">
    <meta property="og:image" content="logo.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <style>
        :root {
            --color-primary: #2196f3;
            --color-primary-hover: #42a5f5;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #212121;
            --color-text-secondary: #757575;
            --color-border: #e0e0e0;
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --color-error: #f44336;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        [data-theme="dark"] {
            --color-primary: #42a5f5;
            --color-primary-hover: #64b5f6;
            --color-bg: #121212;
            --color-surface: #1e1e1e;
            --color-text: #e0e0e0;
            --color-text-secondary: #b0b0b0;
            --color-border: #333333;
            --color-success: #66bb6a;
            --color-warning: #ffa726;
            --color-error: #ef5350;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
        }

        [data-theme="dark"] body {
            background: 
                linear-gradient(135deg, rgba(30, 30, 50, 0.4) 0%, rgba(20, 20, 40, 0.5) 50%, rgba(25, 25, 45, 0.4) 100%),
                radial-gradient(circle at 30% 50%, rgba(40, 40, 60, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(35, 35, 55, 0.2) 0%, transparent 50%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: 
                linear-gradient(135deg, rgba(135, 206, 250, 0.3) 0%, rgba(176, 224, 230, 0.4) 50%, rgba(173, 216, 230, 0.3) 100%),
                radial-gradient(circle at 30% 50%, rgba(100, 180, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(135, 206, 250, 0.15) 0%, transparent 50%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            opacity: 1;
            color: var(--color-text);
            background-color: var(--color-bg);
        }


        /* –°–≤–µ—Ç–ª—è—á–∫–∏ */
        .firefly {
            position: fixed;
            left: 0;
            top: 0;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(255, 255, 255, 0.6),
                0 0 30px rgba(255, 255, 255, 0.4);
            pointer-events: none;
            z-index: 2;
            will-change: transform;
            transform: translateZ(0); /* –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ */
            backface-visibility: hidden; /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–∑ —Ç—É–º–∞–Ω–∞ */
        @keyframes fadeInFromFog {
            0% {
                opacity: 0;
                filter: blur(30px);
                transform: scale(0.95);
            }
            50% {
                opacity: 0.3;
                filter: blur(15px);
                transform: scale(0.98);
            }
            100% {
                opacity: 1;
                filter: blur(0px);
                transform: scale(1);
            }
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Ç—É–º–∞–Ω–∞ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ - —É–±—Ä–∞–Ω, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–µ–º–Ω—è—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ */

        /* –°—Ç–∞—Ç–∏—á–Ω—ã–π —Ñ–æ–Ω (–±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(100, 181, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(66, 165, 245, 0.3) 0%, transparent 50%);
            z-index: 0;
            pointer-events: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
            opacity: 1;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞—Å—Ç–≤–æ—Ä–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ - –£–î–ê–õ–ï–ù–ê, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–µ–º–Ω—è—Ç—å —ç–∫—Ä–∞–Ω */
        .container.fade-out {
            /* –£–±—Ä–∞–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è */
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Ç—É–º–∞–Ω–∞ –ø—Ä–∏ —Ä–∞—Å—Ç–≤–æ—Ä–µ–Ω–∏–∏ - –£–î–ê–õ–ï–ù, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–µ–º–Ω—è—Ç—å —ç–∫—Ä–∞–Ω */
        .container.fade-out::before {
            display: none !important;
            content: none !important;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(100, 181, 246, 0.3);
            text-align: center;
            position: relative;
            overflow: visible;
        }

        [data-theme="dark"] .header {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .company-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
        }

        /* –ó–µ–ª–µ–Ω—ã–π –±–æ—Ä–¥–µ—Ä –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ - –≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã */
        [data-theme="dark"] .company-card.all-completed {
            border: 3px solid #66bb6a;
            box-shadow: 0 10px 40px rgba(102, 187, 106, 0.3);
        }

        [data-theme="dark"] .company-card.all-completed:hover {
            box-shadow: 0 15px 50px rgba(102, 187, 106, 0.4);
        }

        /* –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π –±–æ—Ä–¥–µ—Ä –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ - –µ—Å—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ */
        [data-theme="dark"] .company-card.has-overdue {
            border: 3px solid #d32f2f;
            box-shadow: 0 10px 40px rgba(211, 47, 47, 0.3);
        }

        [data-theme="dark"] .company-card.has-overdue:hover {
            box-shadow: 0 15px 50px rgba(211, 47, 47, 0.4);
        }

        [data-theme="dark"] .company-card:hover {
            border-color: #2196f3 !important;
        }

        [data-theme="dark"] h1,
        [data-theme="dark"] p,
        [data-theme="dark"] .company-name,
        [data-theme="dark"] .company-id {
            color: var(--color-text);
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å */
        .archive-btn {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            top: 80px;
            right: 30px;
            opacity: 0;
            transform: scale(0.8);
        }

        .archive-btn.show {
            animation: fadeInScale 0.4s ease forwards;
        }

        .archive-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        .archive-btn .archive-icon {
            font-size: 20px;
        }

        .archive-tooltip {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            border-radius: 8px;
            background: #000000;
            color: #ffffff;
            font-size: 0.75rem;
            white-space: normal;
            min-width: max-content;
            max-width: 200px;
            word-wrap: break-word;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10001;
            width: auto;
            height: auto;
        }

        .admin-btn {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #2c2c2c;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            overflow: visible;
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            top: 30px;
            left: 80px;
            text-decoration: none;
            opacity: 0;
            transform: scale(0.8);
        }
        
        .admin-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        .admin-btn.show {
            animation: fadeInScale 0.4s ease forwards;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
        .theme-toggle-btn {
            position: absolute !important;
            top: 30px !important;
            left: 30px !important;
            right: auto !important;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            border: 2px solid #2c2c2c;
            cursor: pointer;
            display: flex !important;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 1001 !important;
            overflow: visible;
            visibility: visible !important;
            opacity: 0;
            transform: scale(0.8);
        }

        .theme-toggle-btn.show {
            opacity: 1 !important;
            transform: scale(1);
        }

        /* –ó–æ–ª–æ—Ç–∞—è —Ç–æ—á–∫–∞, –≤—Ä–∞—â–∞—é—â–∞—è—Å—è –ø–æ –∫—Ä—É–≥—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .theme-toggle-btn::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            z-index: 1002;
            transition: opacity 0.3s ease;
        }

        /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç—É—é —Ç–æ—á–∫—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é */
        .theme-toggle-btn:hover::after {
            opacity: 1;
            animation: rotateDot 2s linear infinite;
        }

        .theme-toggle-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4);
        }

        .theme-toggle-btn::before {
            content: 'üåô';
            font-size: 20px;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.3s ease;
            display: inline-block;
            z-index: 1003;
            position: relative;
        }

        [data-theme="dark"] .theme-toggle-btn::before {
            content: '‚òÄÔ∏è';
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
        .theme-toggle-btn.animating {
            animation: themeTogglePulse 1.2s ease-in-out;
            opacity: 1 !important;
            transition: box-shadow 0.3s ease !important;
        }

        .theme-toggle-btn.animating::before {
            animation: themeIconRotate 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transition: none !important;
        }

        .theme-toggle-btn.animating:hover {
            transform: none !important;
        }

        .theme-toggle-btn:hover .theme-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
            transition-delay: 1s;
        }

        .theme-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #000000;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1001;
        }

        .theme-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #000000;
        }

        /* –ó–æ–ª–æ—Ç–∞—è —Ç–æ—á–∫–∞, –≤—Ä–∞—â–∞—é—â–∞—è—Å—è –ø–æ –∫—Ä—É–≥—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .admin-btn::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            top: 50%;
            left: 50%;
            transform: rotate(0deg) translateY(-20px) translateX(-50%);
            transform-origin: center center;
            opacity: 0;
            z-index: 1001;
            transition: opacity 0.3s ease;
        }

        /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç—É—é —Ç–æ—á–∫—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é */
        .admin-btn:hover::after {
            opacity: 1;
            animation: rotateDot 2s linear infinite;
        }

        .admin-btn .admin-icon {
            width: 20px;
            height: 20px;
            position: relative;
            z-index: 1002;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-btn .admin-icon svg {
            width: 100%;
            height: 100%;
            fill: white;
        }

        .admin-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞ */
        .admin-btn[data-tooltip]:hover .admin-tooltip {
            opacity: 1;
            transition-delay: 0.3s;
        }

        .admin-tooltip {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #000000;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: normal;
            min-width: max-content;
            max-width: 200px;
            word-wrap: break-word;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10001;
            width: auto;
            height: auto;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –±–æ—Ä–¥–µ—Ä–∞ */
        @keyframes rotateBorder {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –∑–æ–ª–æ—Ç–æ–π —Ç–æ—á–∫–∏ –ø–æ –∫—Ä—É–≥—É */
        @keyframes rotateDot {
            0% {
                transform: rotate(0deg) translateX(-50%) translateY(-20px);
            }
            100% {
                transform: rotate(360deg) translateX(-50%) translateY(-20px);
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
        @keyframes themeTogglePulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ç–µ–º—ã */
        @keyframes themeIconRotate {
            0% {
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
            50% {
                transform: rotate(180deg) scale(0.5);
                opacity: 0.3;
            }
            100% {
                transform: rotate(360deg) scale(1);
                opacity: 1;
            }
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–æ—Ñ–∏–ª—å, –≤—ã—Ö–æ–¥ –∏ –∞–¥–º–∏–Ω) */
        .profile-btn,
        .logout-btn,
        .admin-btn,
        a.admin-btn,
        .companies-bottom-btn,
        .archive-btn {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #2c2c2c;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            overflow: visible;
            pointer-events: auto !important;
        }
        
        /* –û–±—â–∏–µ hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
        .profile-btn:hover:not(.animating),
        .logout-btn:hover:not(.animating),
        .admin-btn:hover:not(.animating),
        a.admin-btn:hover:not(.animating),
        .companies-bottom-btn:hover:not(.animating),
        .archive-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        /* –ó–æ–ª–æ—Ç–∞—è —Ç–æ—á–∫–∞, –≤—Ä–∞—â–∞—é—â–∞—è—Å—è –ø–æ –∫—Ä—É–≥—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .profile-btn::after,
        .logout-btn::after,
        .admin-btn::after,
        a.admin-btn::after,
        .companies-bottom-btn::after,
        .archive-btn::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            top: 50%;
            left: 50%;
            transform: rotate(0deg) translateY(-20px) translateX(-50%);
            transform-origin: center center;
            opacity: 0;
            z-index: 1001;
            transition: opacity 0.3s ease;
        }

        /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç—É—é —Ç–æ—á–∫—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –∞–Ω–∏–º–∞—Ü–∏—é */
        .profile-btn:hover::after,
        .logout-btn:hover::after,
        .admin-btn:hover::after,
        a.admin-btn:hover::after,
        .companies-bottom-btn:hover::after,
        .archive-btn:hover::after {
            opacity: 1 !important;
            animation: rotateDot 2s linear infinite !important;
        }

        .profile-btn {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            top: 30px;
            right: 80px;
            opacity: 0;
            transform: scale(0.8);
        }

        .profile-btn.show {
            animation: fadeInScale 0.4s ease forwards;
        }

        .profile-btn .profile-icon-head {
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 8px;
            z-index: 1002;
        }

        /* –ì–ª–∞–∑–∞ –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-btn .profile-icon-head::before,
        .profile-btn .profile-icon-head::after {
            content: '';
            position: absolute;
            width: 2.5px;
            height: 2.5px;
            background: #42a5f5;
            border-radius: 50%;
            top: 5.5px;
        }

        .profile-btn .profile-icon-head::before {
            left: 4.5px;
        }

        .profile-btn .profile-icon-head::after {
            right: 4.5px;
        }

        /* –†–æ—Ç –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-icon-mouth {
            position: absolute;
            width: 7px;
            height: 3.5px;
            border: 2px solid #42a5f5;
            border-top: none;
            border-radius: 0 0 7px 7px;
            top: 17px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1003;
            background: transparent;
        }

        .profile-btn .profile-icon-shoulders {
            position: absolute;
            width: 22px;
            height: 12px;
            background: white;
            border-radius: 12px 12px 0 0;
            bottom: 6px;
            z-index: 1002;
        }

        .profile-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        .companies-bottom-btn {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            top: 80px;
            right: 80px;
            opacity: 0;
            transform: scale(0.8);
            display: flex !important;
            visibility: visible !important;
        }

        .companies-bottom-btn.show {
            animation: fadeInScale 0.4s ease forwards;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        @media (max-width: 1024px) {
            .companies-bottom-btn {
                opacity: 1 !important;
                transform: scale(1) !important;
                display: flex !important;
                visibility: visible !important;
                z-index: 1000 !important;
            }
        }
        
        @media (max-width: 768px) {
            .companies-bottom-btn {
                opacity: 1 !important;
                transform: scale(1) !important;
                display: flex !important;
                visibility: visible !important;
                z-index: 1000 !important;
            }
        }
        
        @media (max-width: 480px) {
            .companies-bottom-btn {
                opacity: 1 !important;
                transform: scale(1) !important;
                display: flex !important;
                visibility: visible !important;
                z-index: 1000 !important;
            }
        }

        .companies-bottom-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        /* –ò–∫–æ–Ω–∫–∞ –∑–¥–∞–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π */
        .companies-bottom-icon {
            width: 18px;
            height: 18px;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        /* –¢—Ä–∏ –∑–¥–∞–Ω–∏—è —Ä–∞–∑–Ω–æ–π –≤—ã—Å–æ—Ç—ã */
        .companies-bottom-icon::before,
        .companies-bottom-icon::after {
            content: '';
            background: white;
            border-radius: 2px 2px 0 0;
            position: absolute;
            bottom: 0;
        }

        /* –õ–µ–≤–æ–µ –∑–¥–∞–Ω–∏–µ (–Ω–∏–∑–∫–æ–µ) */
        .companies-bottom-icon::before {
            width: 4px;
            height: 10px;
            left: 2px;
        }

        /* –°—Ä–µ–¥–Ω–µ–µ –∑–¥–∞–Ω–∏–µ (–≤—ã—Å–æ–∫–æ–µ) */
        .companies-bottom-icon::after {
            width: 4px;
            height: 16px;
            left: 7px;
        }

        /* –ü—Ä–∞–≤–æ–µ –∑–¥–∞–Ω–∏–µ (—Å—Ä–µ–¥–Ω–µ–µ) */
        .companies-bottom-icon .building-right {
            position: absolute;
            width: 4px;
            height: 13px;
            background: white;
            border-radius: 2px 2px 0 0;
            right: 2px;
            bottom: 0;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π */
        .companies-bottom-btn:hover .companies-bottom-tooltip {
            opacity: 1 !important;
            transition-delay: 0.3s;
        }

        .companies-bottom-tooltip {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            border-radius: 8px;
            background: #000000;
            color: #ffffff;
            font-size: 0.75rem;
            white-space: normal;
            min-width: max-content;
            max-width: 200px;
            word-wrap: break-word;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10001;
            width: auto;
            height: auto;
        }

        .logout-btn {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            top: 30px; /* –ù–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
            right: 30px; /* –°–ø—Ä–∞–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (–∫–æ—Ç–æ—Ä–∞—è –Ω–∞ right: 80px) */
            opacity: 0;
            transform: scale(0.8);
        }

        .logout-btn.show {
            animation: fadeInScale 0.4s ease forwards;
        }

        .logout-btn .logout-icon {
            width: 12px;
            height: 12px;
            border-left: 3px solid white;
            border-top: 3px solid white;
            transform: rotate(-45deg) translateX(2px);
            z-index: 1002;
            position: absolute;
        }

        .logout-btn:hover:not(.animating) {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4) !important;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .profile-btn[data-tooltip]:hover .profile-tooltip,
        .logout-btn[data-tooltip]:hover .logout-tooltip,
        .admin-btn[data-tooltip]:hover .admin-tooltip,
        a.admin-btn[data-tooltip]:hover .admin-tooltip,
        .companies-bottom-btn[data-tooltip]:hover .companies-bottom-tooltip,
        .archive-btn[data-tooltip]:hover .archive-tooltip {
            opacity: 1 !important;
            transition-delay: 0.3s;
        }

        .profile-tooltip {
            position: absolute;
            right: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            background: #000000;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: normal;
            min-width: max-content;
            max-width: 200px;
            word-wrap: break-word;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10001;
            width: auto;
            height: auto;
        }

        .logout-tooltip {
            position: absolute;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            background: #000000;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: normal;
            min-width: max-content;
            max-width: 200px;
            word-wrap: break-word;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10001;
            width: auto;
            height: auto;
        }

        .header h1 {
            color: #1565c0;
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #64b5f6;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .companies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* –ë–ª–æ–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ç–∏–ø–∞–º –≥—Ä–∞—Ñ–∏–∫–æ–≤ */
        .chart-type-section {
            margin-bottom: 40px;
        }

        .chart-type-section:last-child {
            margin-bottom: 0;
        }

        .chart-type-header {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-border);
        }

        .company-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(100, 181, 246, 0.3);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s ease, border-color 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: visible;
        }

        /* –ó–µ–ª–µ–Ω—ã–π –±–æ—Ä–¥–µ—Ä - –≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã */
        .company-card.all-completed {
            border: 3px solid #4caf50;
            box-shadow: 0 10px 40px rgba(76, 175, 80, 0.3);
        }

        .company-card.all-completed:hover {
            box-shadow: 0 15px 50px rgba(76, 175, 80, 0.4);
        }

        /* –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π –±–æ—Ä–¥–µ—Ä - –µ—Å—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ */
        .company-card.has-overdue {
            border: 3px solid #b71c1c;
            box-shadow: 0 10px 40px rgba(183, 28, 28, 0.3);
        }

        .company-card.has-overdue:hover {
            box-shadow: 0 15px 50px rgba(183, 28, 28, 0.4);
        }

        .company-card.animating {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .company-card::before,
        .company-card::after {
            content: '';
            position: absolute;
            background: linear-gradient(90deg, #42a5f5, #2196f3, #64b5f6);
            opacity: 0;
            z-index: 1;
            pointer-events: none;
            border-radius: 20px;
        }

        /* –õ–µ–≤–∞—è –ø–æ–ª–æ—Å–∞: –æ—Ç –≤–µ—Ä—Ö–∞ –≤–ª–µ–≤–æ –∏ –≤–Ω–∏–∑ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –Ω–∏–∑–∞ */
        .company-card::before {
            top: 0;
            left: 50%;
            width: 0;
            height: 3px;
            transform: translateX(-50%);
            animation: borderLeftFlow 1.2s ease-out forwards;
            animation-play-state: paused;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–æ–ª–æ—Å–∞: –æ—Ç –≤–µ—Ä—Ö–∞ –≤–ø—Ä–∞–≤–æ –∏ –≤–Ω–∏–∑ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –Ω–∏–∑–∞ */
        .company-card::after {
            top: 0;
            right: 50%;
            width: 0;
            height: 3px;
            transform: translateX(50%);
            animation: borderRightFlow 1.2s ease-out forwards;
            animation-play-state: paused;
        }

        @keyframes borderLeftFlow {
            0% {
                top: 0;
                left: 50%;
                width: 0;
                height: 3px;
                opacity: 1;
                transform: translateX(-50%);
                border-radius: 20px 0 0 0;
            }
            20% {
                left: 0;
                width: 50%;
                height: 3px;
                transform: translateX(0);
            }
            40% {
                left: 0;
                top: 0;
                width: 3px;
                height: 100%;
            }
            60% {
                left: 0;
                top: 100%;
                width: 3px;
                height: 0;
            }
            80% {
                left: 0;
                top: 100%;
                width: 50%;
                height: 3px;
            }
            90% {
                left: 50%;
                top: 100%;
                width: 0;
                height: 3px;
                opacity: 1;
                transform: translateX(-50%);
                border-radius: 0 0 0 20px;
            }
            100% {
                left: 50%;
                top: 100%;
                width: 0;
                height: 5px;
                opacity: 1;
                transform: translateX(-50%);
                border-radius: 0 0 0 20px;
                box-shadow: 0 0 25px rgba(100, 181, 246, 1), 0 0 50px rgba(66, 165, 245, 1), 0 0 75px rgba(33, 150, 243, 0.8);
                filter: blur(2px);
            }
        }

        @keyframes borderRightFlow {
            0% {
                top: 0;
                right: 50%;
                width: 0;
                height: 3px;
                opacity: 1;
                transform: translateX(50%);
                border-radius: 0 20px 0 0;
            }
            20% {
                right: 0;
                width: 50%;
                height: 3px;
                transform: translateX(0);
            }
            40% {
                right: 0;
                top: 0;
                width: 3px;
                height: 100%;
            }
            60% {
                right: 0;
                top: 100%;
                width: 3px;
                height: 0;
            }
            80% {
                right: 0;
                top: 100%;
                width: 50%;
                height: 3px;
            }
            90% {
                right: 50%;
                top: 100%;
                width: 0;
                height: 3px;
                opacity: 1;
                transform: translateX(50%);
                border-radius: 0 0 20px 0;
            }
            100% {
                right: 50%;
                top: 100%;
                width: 0;
                height: 5px;
                opacity: 1;
                transform: translateX(50%);
                border-radius: 0 0 20px 0;
                box-shadow: 0 0 25px rgba(100, 181, 246, 1), 0 0 50px rgba(66, 165, 245, 1), 0 0 75px rgba(33, 150, 243, 0.8);
                filter: blur(2px);
            }
        }

        .company-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(33, 150, 243, 0.3);
            border-color: #2196f3 !important;
            border-width: 3px !important;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s ease, border-color 0.3s ease, border-width 0.3s ease;
        }

        .company-card:hover::before,
        .company-card:hover::after {
            animation-play-state: running;
        }

        /* –ö–ª–∞—Å—Å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–∞–∂–µ –ø–æ—Å–ª–µ —É—Ö–æ–¥–∞ –∫—É—Ä—Å–æ—Ä–∞ */
        .company-card.animating-border::before,
        .company-card.animating-border::after {
            animation-play-state: running !important;
        }

        /* –ö–ª–∞—Å—Å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–∞–∂–µ –ø–æ—Å–ª–µ —É—Ö–æ–¥–∞ –∫—É—Ä—Å–æ—Ä–∞ */
        .company-card.animating-border::before,
        .company-card.animating-border::after {
            animation-play-state: running !important;
        }

        /* Drag and Drop —Å—Ç–∏–ª–∏ */
        .company-card.draggable {
            cursor: grab;
        }

        .company-card.draggable:active {
            cursor: grabbing;
        }

        .company-card.dragging {
            transform: scale(0.95) !important;
            box-shadow: 0 20px 60px rgba(33, 150, 243, 0.5) !important;
            z-index: 1000 !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            pointer-events: none;
        }

        .company-card.drag-over {
            border: 2px dashed #42a5f5;
            background: rgba(66, 165, 245, 0.1);
            transform: translateY(-10px);
        }

        .company-card .company-logo {
            width: 100%;
            height: 150px;
            object-fit: contain;
            border-radius: 12px;
            margin-bottom: 15px;
            background: rgba(100, 181, 246, 0.1);
            padding: 10px;
        }

        .company-card .company-logo-placeholder {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, rgba(100, 181, 246, 0.2) 0%, rgba(66, 165, 245, 0.1) 100%);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64b5f6;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .company-card h3 {
            color: #1565c0;
            font-size: 1.4rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .company-card .company-object-name {
            color: #64b5f6;
            font-size: 0.95rem;
            font-weight: 500;
            margin: 8px 0 5px 0;
            line-height: 1.4;
        }

        .company-card .company-id {
            color: #64b5f6;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .company-card .company-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .company-card .company-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
        .company-card .copy-company-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            border: 2px solid #2c2c2c;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 10;
            opacity: 0.8;
        }

        .company-card .copy-company-btn:hover:not(.animating) {
            opacity: 1;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4);
        }

        .company-card .copy-company-btn::before {
            content: '';
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='9' y='9' width='13' height='13' rx='2' ry='2'%3E%3C/rect%3E%3Cpath d='M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1'%3E%3C/path%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: block;
        }

        /* –ó–æ–ª–æ—Ç–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ */
        .company-card .copy-company-btn::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            z-index: 11;
            transition: opacity 0.3s ease;
        }

        .company-card .copy-company-btn:hover::after {
            opacity: 1;
            animation: rotateDot 2s linear infinite;
        }

        .company-card .copy-company-btn[data-tooltip]:hover .copy-company-tooltip {
            opacity: 1;
            visibility: visible;
            transition-delay: 1s;
        }

        .company-card .copy-company-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #000000;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 10001;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
        .company-card .statistics-company-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            border: 2px solid #2c2c2c;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 10;
            opacity: 0.8;
        }

        .company-card .statistics-company-btn:hover:not(.animating) {
            opacity: 1;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4);
        }

        .company-card .statistics-company-btn::before {
            content: '';
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='20' x2='18' y2='10'%3E%3C/line%3E%3Cline x1='12' y1='20' x2='12' y2='4'%3E%3C/line%3E%3Cline x1='6' y1='20' x2='6' y2='14'%3E%3C/line%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: block;
            pointer-events: none;
        }

        /* –ó–æ–ª–æ—Ç–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏ */
        .company-card .statistics-company-btn::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            z-index: 11;
            transition: opacity 0.3s ease;
        }

        .company-card .statistics-company-btn:hover::after {
            opacity: 1;
            animation: rotateDot 2s linear infinite;
        }

        .company-card .statistics-company-btn[data-tooltip]:hover .statistics-company-tooltip {
            opacity: 1;
            visibility: visible;
            transition-delay: 1s;
        }

        .company-card .statistics-company-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #000000;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 10001;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 83, 80, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 83, 80, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 167, 38, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 167, 38, 0.4);
        }

        .btn-archive {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: white;
            border: none;
        }

        .btn-archive:hover {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            border: none;
        }

        .btn-cancel:hover {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }

        .btn-link {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .add-company-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(33, 150, 243, 0.2);
            border: 2px dashed rgba(100, 181, 246, 0.5);
            transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .add-company-card:hover {
            border-color: #42a5f5;
            background: rgba(255, 255, 255, 1);
            transform: translateY(-5px);
        }

        .add-company-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 2rem;
            color: white;
            font-weight: 300;
        }

        .add-company-card h3 {
            color: #1565c0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal {
            display: none !important;
            position: fixed;
            z-index: -1;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: transparent;
            backdrop-filter: none;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
        }

        .modal.show {
            display: flex !important;
            z-index: 10000;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ */
        .delete-modal {
            display: none !important;
            position: fixed;
            z-index: -1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            backdrop-filter: none;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
        }

        .delete-modal.show {
            display: flex !important;
            z-index: 10001;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
        }

        .delete-modal-content {
            background-color: white;
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            position: relative;
        }

        .delete-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .delete-modal-header h2 {
            color: #1565c0;
            font-size: 1.6rem;
            font-weight: 700;
            margin: 0;
        }

        .delete-modal-close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            line-height: 1;
            transition: color 0.3s ease;
        }

        .delete-modal-close:hover {
            color: #1565c0;
        }

        .delete-modal-content p {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            white-space: pre-line;
        }

        .delete-modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ) */
        #restoreCompanyModal .delete-modal-header h2 {
            color: #2196f3;
        }

        #restoreCompanyModal .delete-modal-content p {
            color: #2196f3;
            font-weight: 500;
        }

        #restoreCompanyModal .btn-danger:hover {
            background: linear-gradient(135deg, #1976d2, #1565c0) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4) !important;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e8e8e8;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: calc(100vh - 40px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            margin: auto;
            position: relative;
            align-self: center;
            overflow-y: auto;
            flex-shrink: 0;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE –∏ Edge */
        }

        .modal-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h2 {
            color: #1565c0;
            font-size: 1.6rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: #999;
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: #1565c0;
        }

        .modal-header-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .statistics-export-pdf-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .statistics-export-pdf-btn:hover {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .statistics-export-pdf-btn:active {
            transform: translateY(0);
        }

        .statistics-export-pdf-btn .pdf-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        }

        .statistics-export-pdf-btn .pdf-icon svg {
            width: 100%;
            height: 100%;
            color: white;
        }

        .statistics-export-pdf-btn .pdf-text {
            font-size: 0.9rem;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .statistics-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            max-height: calc(100vh - 40px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            margin: auto;
            position: relative;
            align-self: center;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .statistics-card {
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #2196f3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .statistics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .statistics-card.progress {
            border-left-color: #2196f3;
        }

        .statistics-card.in-progress {
            border-left-color: #ff9800;
        }

        .statistics-card.completed {
            border-left-color: #4caf50;
        }

        .statistics-card.overdue {
            border-left-color: #f44336;
        }

        .statistics-card.deadline {
            border-left-color: #ff9800;
        }

        .statistics-card-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .statistics-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1565c0;
            margin-bottom: 10px;
        }

        .statistics-card.overdue .statistics-card-value {
            color: #f44336;
        }

        .statistics-card.completed .statistics-card-value {
            color: #4caf50;
        }

        .statistics-card.in-progress .statistics-card-value {
            color: #ff9800;
        }

        .statistics-progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(33, 150, 243, 0.1);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .statistics-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196f3 0%, #1976d2 100%);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .statistics-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .statistics-badge.danger {
            background: rgba(244, 67, 54, 0.1);
            color: #d32f2f;
        }

        .statistics-badge.warning {
            background: rgba(255, 152, 0, 0.1);
            color: #f57c00;
        }

        .statistics-badge.info {
            background: rgba(33, 150, 243, 0.1);
            color: #1976d2;
        }

        .statistics-deadlines {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .statistics-deadlines h3 {
            color: #1565c0;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .deadline-item {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #ff9800;
        }

        .deadline-item.danger {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .deadline-item.warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }

        .deadline-item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .deadline-item-text {
            font-size: 0.9rem;
            color: #666;
        }

        .statistics-loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #1565c0;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(100, 181, 246, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input[type="file"] {
            padding: 10px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input[type="file"]:hover {
            border-color: #42a5f5;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #42a5f5;
            box-shadow: 0 0 0 4px rgba(66, 165, 245, 0.15);
        }

        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(100, 181, 246, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            color: var(--color-text);
            cursor: pointer;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group select:focus {
            outline: none;
            border-color: #42a5f5;
            box-shadow: 0 0 0 4px rgba(66, 165, 245, 0.15);
        }

        .form-group select:disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        .form-group small {
            display: block;
            color: #999;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10002;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 0;
            display: none;
            font-weight: 500;
            min-width: 300px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: rgba(129, 199, 132, 0.2);
            color: #2e7d32;
            border: 1px solid rgba(129, 199, 132, 0.5);
        }

        .message.error {
            background: rgba(239, 83, 80, 0.2);
            color: #c62828;
            border: 1px solid rgba(239, 83, 80, 0.5);
        }

        .message.info {
            background: rgba(33, 150, 243, 0.2);
            color: #1565c0;
            border: 1px solid rgba(33, 150, 243, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 60px 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(100, 181, 246, 0.3);
        }

        .empty-state p {
            color: #90caf9;
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 1024px) {
            .companies-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
            }

            .header {
                padding: 35px 30px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .company-card {
                padding: 25px;
            }

            /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö */
            .profile-btn,
            .logout-btn,
            .admin-btn,
            .companies-bottom-btn,
            .archive-btn {
                width: 40px;
                height: 40px;
            }

            .theme-toggle-btn {
                top: 25px !important;
                left: 25px !important;
            }

            .admin-btn {
                top: 25px;
                left: 75px !important;
            }

            .profile-btn {
                top: 25px;
                right: 25px !important;
            }

            .archive-btn {
                top: 77px; /* 25px (top –ø–µ—Ä–≤–æ–π) + 40px (–≤—ã—Å–æ—Ç–∞ –ø–µ—Ä–≤–æ–π) + 12px (–æ—Ç—Å—Ç—É–ø) = 77px */
                right: 25px !important;
            }

            .logout-btn {
                top: 25px; /* –ù–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
                right: 65px !important; /* –°–ø—Ä–∞–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (25px + 40px —à–∏—Ä–∏–Ω–∞) */
            }

            .companies-bottom-btn {
                top: 77px; /* 25px (top –≤—ã—Ö–æ–¥–∞) + 40px (–≤—ã—Å–æ—Ç–∞ –≤—ã—Ö–æ–¥–∞) + 12px (–æ—Ç—Å—Ç—É–ø) = 77px */
                right: 65px !important; /* –¢–∞ –∂–µ –ø–æ–∑–∏—Ü–∏—è –ø–æ right, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
                opacity: 1 !important;
                transform: scale(1) !important;
                display: flex !important;
                visibility: visible !important;
                z-index: 1000 !important;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .container {
                max-width: 100%;
            }

            .companies-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header {
                padding: 30px 25px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 1rem;
            }

            .company-card {
                padding: 25px;
                border-radius: 15px;
            }

            .company-card .copy-company-btn {
                width: 32px;
                height: 32px;
                top: 12px;
                right: 12px;
            }

            .company-card .copy-company-btn::before {
                width: 18px;
                height: 18px;
            }

            .company-card .statistics-company-btn {
                width: 32px;
                height: 32px;
                top: 12px;
                left: 12px;
            }

            .company-card .statistics-company-btn::before {
                width: 18px;
                height: 18px;
            }

            .company-card h3 {
                font-size: 1.3rem;
            }

            .company-id {
                font-size: 0.85rem;
            }

            .company-actions {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                padding: 12px;
                font-size: 0.9rem;
                min-height: 44px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è touch –Ω–∞ iOS */
                touch-action: manipulation; /* –£–ª—É—á—à–∞–µ—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –Ω–∞ touch */
            }

            .add-company-card {
                padding: 25px;
                min-height: 180px;
            }

            .add-company-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .profile-btn,
            .logout-btn,
            .admin-btn,
            .companies-bottom-btn,
            .archive-btn {
                width: 38px;
                height: 38px;
            }

            .theme-toggle-btn {
                top: 15px !important;
                left: 15px !important;
            }

            .admin-btn {
                top: 15px;
                left: 65px !important;
            }

            .profile-btn {
                top: 15px;
                right: 15px !important;
            }

            .archive-btn {
                top: 65px; /* 15px (top –ø–µ—Ä–≤–æ–π) + 38px (–≤—ã—Å–æ—Ç–∞ –ø–µ—Ä–≤–æ–π) + 12px (–æ—Ç—Å—Ç—É–ø) = 65px */
                right: 15px !important;
            }

            .logout-btn {
                top: 15px; /* –ù–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
                right: 53px !important; /* –°–ø—Ä–∞–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (15px + 38px —à–∏—Ä–∏–Ω–∞) */
            }

            .companies-bottom-btn {
                top: 65px; /* 15px (top –≤—ã—Ö–æ–¥–∞) + 38px (–≤—ã—Å–æ—Ç–∞ –≤—ã—Ö–æ–¥–∞) + 12px (–æ—Ç—Å—Ç—É–ø) = 65px */
                right: 53px !important; /* –¢–∞ –∂–µ –ø–æ–∑–∏—Ü–∏—è –ø–æ right, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
                opacity: 1 !important;
                transform: scale(1) !important;
                display: flex !important;
                visibility: visible !important;
                z-index: 1000 !important;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 25px 20px;
                border-radius: 12px;
            }

            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 6px;
            }

            .header p {
                font-size: 0.9rem;
            }

            .company-card {
                padding: 20px;
                border-radius: 12px;
            }

            .company-card .copy-company-btn {
                width: 30px;
                height: 30px;
                top: 10px;
                right: 10px;
            }

            .company-card .copy-company-btn::before {
                width: 16px;
                height: 16px;
            }

            .company-card h3 {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .company-id {
                font-size: 0.8rem;
                margin-bottom: 15px;
            }

            .company-logo {
                max-width: 120px;
                max-height: 90px;
                margin-bottom: 15px;
            }

            .company-logo-placeholder {
                width: 120px;
                height: 90px;
                font-size: 0.75rem;
            }

            .btn {
                padding: 10px;
                font-size: 0.85rem;
                min-height: 44px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è touch –Ω–∞ iOS */
                touch-action: manipulation; /* –£–ª—É—á—à–∞–µ—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –Ω–∞ touch */
            }

            .add-company-card {
                padding: 20px;
                min-height: 160px;
            }

            .add-company-icon {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
                margin-bottom: 12px;
            }

            .add-company-card h3 {
                font-size: 1rem;
            }

            /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
            .profile-btn,
            .logout-btn,
            .admin-btn,
            .companies-bottom-btn,
            .archive-btn {
                width: 35px;
                height: 35px;
            }

            .theme-toggle-btn {
                top: 12px !important;
                left: 12px !important;
            }

            .admin-btn {
                top: 12px;
                left: 57px !important;
            }

            .profile-btn {
                top: 12px;
                right: 12px !important;
            }

            .archive-btn {
                top: 59px; /* 12px (top –ø–µ—Ä–≤–æ–π) + 35px (–≤—ã—Å–æ—Ç–∞ –ø–µ—Ä–≤–æ–π) + 12px (–æ—Ç—Å—Ç—É–ø) = 59px */
                right: 12px !important;
            }

            .logout-btn {
                top: 12px; /* –ù–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
                right: 47px !important; /* –°–ø—Ä–∞–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (12px + 35px —à–∏—Ä–∏–Ω–∞) */
            }

            .companies-bottom-btn {
                top: 59px; /* 12px (top –≤—ã—Ö–æ–¥–∞) + 35px (–≤—ã—Å–æ—Ç–∞ –≤—ã—Ö–æ–¥–∞) + 12px (–æ—Ç—Å—Ç—É–ø) = 59px */
                right: 47px !important; /* –¢–∞ –∂–µ –ø–æ–∑–∏—Ü–∏—è –ø–æ right, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
                opacity: 1 !important;
                transform: scale(1) !important;
                display: flex !important;
                visibility: visible !important;
                z-index: 1000 !important;
            }

            .modal-content {
                width: 95%;
                max-width: 95%;
                padding: 25px 20px;
                margin: auto;
                max-height: calc(100vh - 40px);
            }

            .modal-header h2 {
                font-size: 1.3rem;
            }

            .form-group {
                margin-bottom: 18px;
            }

            .form-group input,
            .form-group select {
                padding: 12px 14px;
                font-size: 16px; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
            }

            .delete-modal-content {
                padding: 25px 20px;
                width: 90%;
            }

            .delete-modal-header h2 {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 360px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .company-card {
                padding: 15px;
            }

            .company-card h3 {
                font-size: 1.1rem;
            }
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-modal {
            display: none;
            position: fixed;
            z-index: -1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            backdrop-filter: none;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
        }

        .profile-modal.show {
            display: flex !important;
            z-index: 10002 !important;
            background-color: rgba(0, 0, 0, 0.5) !important;
            backdrop-filter: blur(5px) !important;
            animation: fadeIn 0.3s ease;
            align-items: flex-start;
            justify-content: center;
            padding-top: 10vh;
            visibility: visible !important;
            opacity: 1 !important;
            pointer-events: auto !important;
        }

        @media (max-width: 768px) {
            .profile-modal.show {
                padding-top: 5vh;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .profile-modal.show {
                padding-top: 2vh;
                padding-left: 5px;
                padding-right: 5px;
            }
        }

        .profile-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            position: relative;
            margin-top: 10vh;
            cursor: default;
        }

        .profile-modal-header {
            cursor: move;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .profile-modal-header h2 {
            color: #1565c0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .profile-modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: #999;
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .profile-modal-close:hover {
            background: #f5f5f5;
            color: #333;
        }

        .profile-form-group {
            margin-bottom: 25px;
        }

        .profile-form-group label {
            display: block;
            color: #1565c0;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .profile-form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(100, 181, 246, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            color: #333;
            transition: all 0.3s ease;
            background: rgba(100, 181, 246, 0.05);
            box-sizing: border-box;
        }

        .profile-form-group input:focus {
            outline: none;
            border-color: #42a5f5;
            box-shadow: 0 0 0 4px rgba(66, 165, 245, 0.15);
            background: white;
        }

        .profile-form-group input::placeholder {
            color: #90caf9;
        }

        .profile-form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .profile-form-actions .btn {
            flex: 1;
            padding: 14px 20px;
            font-size: 1rem;
        }

        .profile-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-size: 0.9rem;
        }

        .profile-message.success {
            background: rgba(129, 199, 132, 0.2);
            color: #2e7d32;
            border: 1px solid rgba(129, 199, 132, 0.5);
        }

        .profile-message.error {
            background: rgba(239, 83, 80, 0.2);
            color: #c62828;
            border: 1px solid rgba(239, 83, 80, 0.5);
        }

        .profile-message.show {
            display: block;
        }

        @media (max-width: 480px) {
            .profile-modal-content {
                width: 98%;
                max-width: 98%;
                padding: 15px 12px;
            }

            .profile-modal-header h2 {
                font-size: 1.1rem;
            }

            .profile-form-group input {
                padding: 10px;
                font-size: 16px;
            }
        }

        /* –§—É—Ç—Ç–µ—Ä */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(100, 181, 246, 0.3);
            padding: 15px 20px;
            text-align: center;
            color: #64b5f6;
            font-size: 0.85rem;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(33, 150, 243, 0.1);
        }

        .footer p {
            margin: 0;
        }

        @media (max-width: 768px) {
            .footer {
                font-size: 0.75rem;
                padding: 12px 15px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞—Ä—Ö–∏–≤–∞ */
        .archive-container {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .archive-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .archive-container.hide {
            opacity: 0;
            transform: translateY(100%);
        }

        #companiesContainer {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        #companiesContainer.hide {
            opacity: 0;
            transform: translateY(100%);
        }

        #companiesContainer.show {
            opacity: 1;
            transform: translateY(0);
        }

        #companiesContainer.slide-from-top {
            opacity: 0;
            transform: translateY(-100%);
        }

        .archive-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 40px;
            padding: 25px 30px;
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.15), rgba(123, 31, 162, 0.1));
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.2);
            border: 2px solid rgba(156, 39, 176, 0.3);
        }

        .archive-header h2 {
            margin: 0 0 10px 0;
            color: #7b1fa2;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .archive-header h2::before {
            content: 'üì¶';
            font-size: 2rem;
        }

        .archive-header-subtitle {
            color: #666;
            font-size: 1rem;
            font-weight: 400;
            margin: 0;
            line-height: 1.5;
        }

        .archive-header .btn {
            padding: 0;
            font-size: 0;
            font-weight: 600;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            border: 2px solid #2c2c2c;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
            position: relative;
        }

        .archive-header .btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4);
        }

        /* –ó–æ–ª–æ—Ç–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤ –∞—Ä—Ö–∏–≤–µ */
        .archive-header .btn::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -20px);
            opacity: 0;
            z-index: 1001;
            transition: opacity 0.3s ease;
        }

        .archive-header .btn:hover::after {
            opacity: 1;
            animation: rotateDot 2s linear infinite;
        }

        /* –ò–∫–æ–Ω–∫–∞ —Å–µ—Ç–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤ –∞—Ä—Ö–∏–≤–µ (4 –∫–≤–∞–¥—Ä–∞—Ç–∞ –≤ —Å–µ—Ç–∫–µ) */
        .archive-companies-icon {
            width: 18px;
            height: 18px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='7' height='7'%3E%3C/rect%3E%3Crect x='14' y='3' width='7' height='7'%3E%3C/rect%3E%3Crect x='14' y='14' width='7' height='7'%3E%3C/rect%3E%3Crect x='3' y='14' width='7' height='7'%3E%3C/rect%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤ –∞—Ä—Ö–∏–≤–µ */
        .archive-header .btn:hover .archive-companies-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
            transition-delay: 1s;
        }

        .archive-companies-tooltip {
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            border-radius: 8px;
            background: #000000;
            color: #ffffff;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1002;
        }

        .archive-empty-state {
            text-align: center;
            padding: 80px 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(33, 150, 243, 0.15);
            border: 2px dashed rgba(156, 39, 176, 0.3);
            margin-top: 40px;
        }

        .archive-empty-state-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .archive-empty-state h3 {
            color: #7b1fa2;
            font-size: 1.5rem;
            margin: 0 0 15px 0;
            font-weight: 600;
        }

        .archive-empty-state p {
            color: #666;
            font-size: 1.1rem;
            margin: 0;
            line-height: 1.6;
        }

        /* –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ */
        .first-visit-tooltip {
            position: fixed;
            background: #000000;
            color: #ffffff;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            line-height: 1.5;
            max-width: 300px;
            z-index: -1;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            display: none;
            transform: scale(0.9);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .first-visit-tooltip.show {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
            z-index: 100000;
            visibility: visible;
            display: block;
        }

        .first-visit-tooltip::before {
            content: '?';
            position: absolute;
            top: -8px;
            left: 12px;
            width: 24px;
            height: 24px;
            background: #2196f3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.4);
        }

        .first-visit-tooltip .tooltip-close {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            line-height: 1;
            transition: background 0.2s;
        }

        .first-visit-tooltip .tooltip-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .first-visit-tooltip .tooltip-next {
            margin-top: 10px;
            padding: 6px 12px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background 0.2s;
        }

        .first-visit-tooltip .tooltip-next:hover {
            background: #1976d2;
        }

        /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –≤–æ –≤—Ä–µ–º—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
        .first-visit-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 99998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }
        
        .first-visit-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: none; /* –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º */
        }
        
        .first-visit-highlight {
            position: fixed;
            border: 3px solid #2196f3;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5), 0 0 20px rgba(33, 150, 243, 0.8);
            z-index: 99999;
            pointer-events: none;
            transition: all 0.3s ease;
            display: none;
            opacity: 0;
            visibility: hidden;
        }
        
        .first-visit-highlight.active {
            display: block;
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–¥–ø–∏—Å—å DeadLinePro –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
    <div style="position: fixed; top: 20px; right: 20px; z-index: 9999; font-size: 32px; font-weight: 600; color: rgba(33, 150, 243, 0.5); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; pointer-events: none; user-select: none;">DeadLinePro</div>
    <div class="firefly" id="companies-firefly-1"></div>
    <div class="firefly" id="companies-firefly-2"></div>
    <div class="firefly" id="companies-firefly-3"></div>
    <div class="firefly" id="companies-firefly-4"></div>
    <div class="firefly" id="companies-firefly-5"></div>
    <div class="firefly" id="companies-firefly-6"></div>
    <div class="firefly" id="companies-firefly-7"></div>
    <div class="firefly" id="companies-firefly-8"></div>
    <div class="firefly" id="companies-firefly-9"></div>
    <div class="firefly" id="companies-firefly-10"></div>
    <div class="firefly" id="companies-firefly-11"></div>
    <div class="firefly" id="companies-firefly-12"></div>
    
    <!-- –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ -->
    <div id="firstVisitOverlay" class="first-visit-overlay"></div>
    <div id="firstVisitTooltip" class="first-visit-tooltip">
        <button class="tooltip-close" onclick="skipFirstVisitTour()">&times;</button>
        <div class="tooltip-content"></div>
        <button class="tooltip-next" onclick="nextFirstVisitStep()">–î–∞–ª–µ–µ</button>
    </div>
    <div id="firstVisitHighlight" class="first-visit-highlight"></div>
    
    <div class="container">
        <div class="header">
            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
            <button class="profile-btn" id="profileBtn" data-tooltip="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
                <span class="profile-icon-head"></span>
                <span class="profile-icon-mouth"></span>
                <span class="profile-icon-shoulders"></span>
                <span class="profile-tooltip">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</span>
            </button>
            <button class="logout-btn" id="logoutBtn" data-tooltip="–í—ã—Ö–æ–¥" onclick="logout()">
                <span class="logout-icon"></span>
                <span class="logout-tooltip">–í—ã—Ö–æ–¥</span>
            </button>
            <button class="companies-bottom-btn" id="companiesBottomBtn" data-tooltip="–ö–æ–º–ø–∞–Ω–∏–∏" onclick="hideArchive()">
                <span class="archive-companies-icon"></span>
                <span class="companies-bottom-tooltip">–ö–æ–º–ø–∞–Ω–∏–∏</span>
            </button>
            
            <button class="archive-btn" id="archiveBtn" data-tooltip="–ê—Ä—Ö–∏–≤" onclick="showArchive()" style="display: none;">
                <span class="archive-icon">üì¶</span>
                <span class="archive-tooltip">–ê—Ä—Ö–∏–≤</span>
            </button>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
            <button class="theme-toggle-btn" id="themeToggleBtn" data-tooltip="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" onclick="toggleTheme()">
                <span class="theme-tooltip">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</span>
            </button>
            <a href="admin.html" class="admin-btn" id="adminPanelLink" data-tooltip="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">
                <span class="admin-icon">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5A3.5 3.5 0 0 1 15.5 12A3.5 3.5 0 0 1 12 15.5M19.43 12.97C19.47 12.65 19.5 12.33 19.5 12C19.5 11.67 19.47 11.34 19.43 11.03L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.96 19.05 5.05L16.56 6.05C16.04 5.66 15.5 5.32 14.87 5.07L14.5 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.5 2.42L9.13 5.07C8.5 5.32 7.96 5.66 7.44 6.05L4.95 5.05C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.22 8.95 2.27 9.22 2.46 9.37L4.57 11.03C4.53 11.34 4.5 11.67 4.5 12C4.5 12.33 4.53 12.65 4.57 12.97L2.46 14.63C2.27 14.78 2.22 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.95L7.44 17.94C7.96 18.34 8.5 18.68 9.13 18.93L9.5 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.5 21.58L14.87 18.93C15.5 18.68 16.04 18.34 16.56 17.94L19.05 18.95C19.27 19.03 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.97Z"/>
                    </svg>
                </span>
                <span class="admin-tooltip">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
            </a>
            <h1 id="pageTitle">–í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏</h1>
            <p id="headerSubtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã</p>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞—Ä—Ö–∏–≤–∞ -->
        <div id="archiveContainer" class="archive-container" style="display: none;">
            <div class="archive-header">
                <h2>–ê—Ä—Ö–∏–≤ –∫–æ–º–ø–∞–Ω–∏–π</h2>
                <p class="archive-header-subtitle">–ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –∞—Ä—Ö–∏–≤–∞.</p>
            </div>
            <div id="archivedCompaniesContainer" class="companies-grid"></div>
        </div>

        <div id="message" class="message"></div>

        <div id="companiesContainer">
            <div id="companiesGrid" class="companies-grid">
                <div class="empty-state">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ -->
    <div id="editCompanyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div id="editMessage" class="message"></div>
            <form id="editForm">
                <div class="form-group">
                    <label for="editCompanyId">ID –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
                    <input type="text" id="editCompanyId" name="editCompanyId" required
                           pattern="[a-zA-Z0-9_\-]+"
                           title="–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è">
                    <small>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ URL. –ù–∞–ø—Ä–∏–º–µ—Ä: SetlTech, setlsoft, company-1</small>
                </div>
                <div class="form-group">
                    <label for="editCompanyName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
                    <input type="text" id="editCompanyName" name="editCompanyName" required 
                           placeholder='–û–û–û "–°–µ—Ç–ª–¢–µ—Ö"'>
                </div>
                <div class="form-group">
                    <label for="editCompanyObjectName">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞</label>
                    <input type="text" id="editCompanyObjectName" name="editCompanyObjectName" 
                           placeholder='–ñ–ö "–°–æ–ª–Ω–µ—á–Ω—ã–π"'>
                    <small>–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</small>
                </div>
                <div class="form-group">
                    <label for="editCompanyChartType">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ *</label>
                    <select id="editCompanyChartType" name="editCompanyChartType" required class="tasks-table-input-select" style="width: 100%; padding: 12px 16px; border: 2px solid rgba(100, 181, 246, 0.3); border-radius: 10px; font-size: 1rem;">
                        <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </select>
                    <small>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</small>
                </div>
                <div class="form-group">
                    <label for="editCompanyLogo">–õ–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏</label>
                    <input type="file" id="editCompanyLogo" name="editCompanyLogo" accept="image/png,image/jpeg,image/jpg,image/gif">
                    <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è PNG –∏–ª–∏ JPG. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 2MB</small>
                    <div id="editLogoPreview" style="margin-top: 10px; display: none;">
                        <img id="editLogoPreviewImg" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid rgba(100, 181, 246, 0.3);">
                    </div>
                    <div id="editCurrentLogo" style="margin-top: 10px;"></div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="flex: 1;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ -->
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è (—É–¥–∞–ª–∏—Ç—å/–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å) -->
    <div id="deleteOrArchiveModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h2>–î–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–º–ø–∞–Ω–∏–µ–π</h2>
                <span class="delete-modal-close" onclick="cancelDeleteOrArchive()">&times;</span>
            </div>
            <p id="deleteOrArchiveText">–í—ã —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏–ª–∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –∞—Ä—Ö–∏–≤?</p>
            <div class="delete-modal-actions" style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-archive" onclick="archiveCompany()" style="background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border: none;">
                    –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button class="btn btn-danger" onclick="showDeleteConfirm()" style="background: linear-gradient(135deg, #f44336, #d32f2f); color: white; border: none;">
                    –£–¥–∞–ª–∏—Ç—å
                </button>
                <button class="btn btn-cancel" onclick="cancelDeleteOrArchive()" style="background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border: none;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deleteCompanyModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h2>–£–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é?</h2>
                <span class="delete-modal-close" onclick="cancelDeleteCompany()">&times;</span>
            </div>
            <p id="deleteCompanyText">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–º–ø–∞–Ω–∏—é?</p>
            <div class="delete-modal-actions">
                <button class="btn btn-danger" onclick="confirmDeleteCompany()">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="cancelDeleteCompany()">–ù–µ—Ç</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –∞—Ä—Ö–∏–≤–∞ -->
    <div id="restoreCompanyModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h2>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é –∏–∑ –∞—Ä—Ö–∏–≤–∞?</h2>
                <span class="delete-modal-close" onclick="cancelRestoreCompany()">&times;</span>
            </div>
            <p id="restoreCompanyText" style="color: #2196f3;">‚ö†Ô∏è –í—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –≥—Ä–∞—Ñ–∏–∫ –∏–∑ –∞—Ä—Ö–∏–≤–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏. –í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
            <div class="delete-modal-actions">
                <button class="btn btn-danger" onclick="confirmRestoreCompany()" style="background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border: none; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);">–î–∞, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="cancelRestoreCompany()">–ù–µ—Ç</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é</h2>
                <button class="modal-close" onclick="closeCreateModal()">&times;</button>
            </div>
            <div id="createMessage" class="message"></div>
            <form id="createForm">
                <div class="form-group">
                    <label for="companyId">ID –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
                    <input type="text" id="companyId" name="companyId" required 
                           placeholder="SetlTech" pattern="[a-zA-Z0-9_\-]+"
                           title="–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è">
                    <small>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ URL. –ù–∞–ø—Ä–∏–º–µ—Ä: SetlTech, setlsoft, company-1</small>
                </div>
                <div class="form-group">
                    <label for="companyName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
                    <input type="text" id="companyName" name="companyName" required 
                           placeholder='–û–û–û "–°–µ—Ç–ª–¢–µ—Ö"'>
                </div>
                <div class="form-group">
                    <label for="companyObjectName">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞</label>
                    <input type="text" id="companyObjectName" name="companyObjectName" 
                           placeholder='–ñ–ö "–°–æ–ª–Ω–µ—á–Ω—ã–π"'>
                    <small>–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</small>
                </div>
                <div class="form-group">
                    <label for="companyChartType">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ *</label>
                    <select id="companyChartType" name="companyChartType" required class="tasks-table-input-select" style="width: 100%; padding: 12px 16px; border: 2px solid rgba(100, 181, 246, 0.3); border-radius: 10px; font-size: 1rem;">
                        <option value="icona">–í–Ω–µ–¥—Ä–µ–Ω–∏–µ Icona</option>
                        <option value="praktis">–í–Ω–µ–¥—Ä–µ–Ω–∏–µ Praktis ID</option>
                    </select>
                    <small>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</small>
                </div>
                <div class="form-group">
                    <label for="companyLogo">–õ–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏</label>
                    <input type="file" id="companyLogo" name="companyLogo" accept="image/png,image/jpeg,image/jpg,image/gif">
                    <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è PNG –∏–ª–∏ JPG. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 2MB</small>
                    <div id="logoPreview" style="margin-top: 10px; display: none;">
                        <img id="logoPreviewImg" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid rgba(100, 181, 246, 0.3);">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-danger" onclick="closeCreateModal()" style="flex: 1;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        –°–æ–∑–¥–∞—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h2>
                <button class="profile-modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <form id="profileForm">
                <div class="profile-form-group">
                    <label for="profileName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input type="text" id="profileName" required>
                </div>
                <div class="profile-form-group">
                    <label for="profileLogin">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="profileLogin" required>
                </div>
                <div class="profile-form-group">
                    <label for="profilePassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤):</label>
                    <input type="password" id="profilePassword" minlength="6" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å">
                </div>
                <div class="profile-form-group">
                    <label for="profilePasswordConfirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="profilePasswordConfirm" minlength="6" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å">
                </div>
                <div id="profileMessage" class="profile-message"></div>
                <div class="profile-form-actions">
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeProfileModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏ -->
    <div id="statisticsModal" class="modal">
        <div class="statistics-modal-content">
            <div class="modal-header">
                <h2 id="statisticsModalTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏</h2>
                <div class="modal-header-buttons">
                    <button class="statistics-export-pdf-btn" onclick="exportStatisticsToPDF()" title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ PDF">
                        <span class="pdf-icon">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 2C2.44772 2 2 2.44772 2 3V13C2 13.5523 2.44772 14 3 14H13C13.5523 14 14 13.5523 14 13V5.41421C14 5.149 13.8946 4.89464 13.7071 4.70711L10.2929 1.29289C10.1054 1.10536 9.851 1 9.58579 1H3ZM3 3H9V5H13V13H3V3Z" fill="currentColor"/>
                                <path d="M10 1V4H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M5 8H11M5 10H11M5 12H9" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                        </span>
                        <span class="pdf-text">PDF</span>
                    </button>
                    <button class="modal-close" onclick="closeStatisticsModal()">&times;</button>
                </div>
            </div>
            <div id="statisticsContent">
                <div class="statistics-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>
        </div>
    </div>

    <script>
        // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –¢–ï–ú–´ ==========
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            const html = document.documentElement;
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏
            if (themeToggleBtn) {
                themeToggleBtn.classList.add('animating');
                
                // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                setTimeout(() => {
                    themeToggleBtn.classList.remove('animating');
                }, 1200);
            }
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('gantt-theme', newTheme);
            
            console.log(`‚úÖ –¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞: ${newTheme}`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function initTheme() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const savedTheme = localStorage.getItem('gantt-theme');
            const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = savedTheme || systemTheme;
            
            document.documentElement.setAttribute('data-theme', theme);
            
            console.log(`‚úÖ –¢–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: ${theme}`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–º—É —Å—Ä–∞–∑—É
        initTheme();

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('gantt-theme')) {
                const theme = e.matches ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', theme);
            }
        });

        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ —Ç–µ–º—ã
        function ensureThemeToggleVisible() {
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            if (themeToggleBtn) {
                themeToggleBtn.style.display = 'flex';
                themeToggleBtn.style.visibility = 'visible';
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    themeToggleBtn.classList.add('show');
                }, 50);
            }
        }

        // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', ensureThemeToggleVisible);
        } else {
            ensureThemeToggleVisible();
        }

        // –ù–ï–ú–ï–î–õ–ï–ù–ù–û —É–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–∞
        (function() {
            function forceRemoveDarkening() {
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fade-out
                const container = document.querySelector('.container');
                if (container) {
                    container.classList.remove('fade-out');
                }
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                const modals = document.querySelectorAll('.modal, .delete-modal, .profile-modal');
                modals.forEach(modal => {
                    modal.classList.remove('show');
                    modal.style.display = 'none';
                    modal.style.visibility = 'hidden';
                    modal.style.opacity = '0';
                    modal.style.zIndex = '-1';
                    modal.style.pointerEvents = 'none';
                });
                
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
                const tooltip = document.getElementById('firstVisitTooltip');
                if (tooltip) {
                    tooltip.classList.remove('show');
                    tooltip.style.display = 'none';
                    tooltip.style.zIndex = '-1';
                    tooltip.style.opacity = '0';
                    tooltip.style.visibility = 'hidden';
                }
                
                // –£–±–∏—Ä–∞–µ–º highlight –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
                const highlight = document.getElementById('firstVisitHighlight');
                if (highlight) {
                    highlight.classList.remove('active');
                    highlight.style.display = 'none';
                    highlight.style.zIndex = '-1';
                    highlight.style.opacity = '0';
                    highlight.style.visibility = 'hidden';
                    highlight.style.boxShadow = 'none';
                }
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Å—Ä–∞–∑—É
            forceRemoveDarkening();
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', forceRemoveDarkening);
            } else {
                forceRemoveDarkening();
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –Ω–∞ —Å–ª—É—á–∞–π –ø–æ–∑–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(forceRemoveDarkening, 0);
            setTimeout(forceRemoveDarkening, 50);
            setTimeout(forceRemoveDarkening, 100);
            setTimeout(forceRemoveDarkening, 500);
        })();
        
        let currentUser = null;
        let isAdmin = false;

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadCurrentUser() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∂–∏–º–∞
            const companiesBottomBtn = document.getElementById('companiesBottomBtn');
            if (companiesBottomBtn) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–±–∏–ª—å–Ω—ã–º
                const isMobile = window.innerWidth <= 1024;
                
                companiesBottomBtn.style.display = 'flex';
                companiesBottomBtn.style.visibility = 'visible';
                companiesBottomBtn.style.opacity = isMobile ? '1' : '0';
                companiesBottomBtn.style.transform = isMobile ? 'scale(1)' : 'scale(0.8)';
                
                if (!isMobile) {
                    setTimeout(() => {
                        companiesBottomBtn.classList.add('show');
                    }, 100);
                } else {
                    // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ–º –≤–∏–¥–∏–º–æ–π
                    companiesBottomBtn.classList.add('show');
                }
            }
            
            const ganttMode = localStorage.getItem('gantt-mode') || 'edit';
            const isViewMode = ganttMode === 'view';
            
            // –í —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
            if (isViewMode) {
                const profileBtn = document.getElementById('profileBtn');
                const logoutBtn = document.getElementById('logoutBtn');
                const adminPanelLink = document.getElementById('adminPanelLink');
                
                if (profileBtn) {
                    profileBtn.style.display = 'none';
                }
                if (logoutBtn) {
                    logoutBtn.style.display = 'none';
                }
                if (adminPanelLink) {
                    adminPanelLink.style.display = 'none';
                }
                
                // –ö–Ω–æ–ø–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞, –¥–∞–∂–µ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                const companiesBottomBtn = document.getElementById('companiesBottomBtn');
                if (companiesBottomBtn) {
                    const isMobile = window.innerWidth <= 1024;
                    companiesBottomBtn.style.display = 'flex';
                    companiesBottomBtn.style.visibility = 'visible';
                    companiesBottomBtn.style.opacity = '1';
                    companiesBottomBtn.style.transform = 'scale(1)';
                    companiesBottomBtn.classList.add('show');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                const subtitle = document.getElementById('headerSubtitle');
                if (subtitle) {
                    subtitle.textContent = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞.';
                }
                
                return; // –í—ã—Ö–æ–¥–∏–º, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            }
            
            const userStr = localStorage.getItem('gantt-user');
            if (userStr) {
                try {
                    currentUser = JSON.parse(userStr);
                    isAdmin = currentUser.role === 'admin';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞
                    const companiesBottomBtn = document.getElementById('companiesBottomBtn');
                    if (companiesBottomBtn) {
                        const isMobile = window.innerWidth <= 1024;
                        companiesBottomBtn.style.display = 'flex';
                        companiesBottomBtn.style.visibility = 'visible';
                        companiesBottomBtn.style.opacity = isMobile ? '1' : '0';
                        companiesBottomBtn.style.transform = isMobile ? 'scale(1)' : 'scale(0.8)';
                        
                        if (!isMobile) {
                            setTimeout(() => {
                                companiesBottomBtn.classList.add('show');
                            }, 350);
                        } else {
                            // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ–º –≤–∏–¥–∏–º–æ–π
                            companiesBottomBtn.classList.add('show');
                        }
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞—Ä—Ö–∏–≤–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
                    const archiveBtn = document.getElementById('archiveBtn');
                    if (archiveBtn) {
                        archiveBtn.style.display = isAdmin ? 'flex' : 'none';
                        if (isAdmin) {
                            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∞—Ä—Ö–∏–≤–∞
                            setTimeout(() => {
                                archiveBtn.classList.add('show');
                            }, 350);
                        }
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
                    const adminPanelLink = document.getElementById('adminPanelLink');
                    if (adminPanelLink) {
                        adminPanelLink.style.display = isAdmin ? 'flex' : 'none';
                        if (isAdmin) {
                            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞
                            setTimeout(() => {
                                adminPanelLink.classList.add('show');
                            }, 300);
                        }
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    const subtitle = document.getElementById('headerSubtitle');
                    if (subtitle) {
                        if (isAdmin) {
                            subtitle.textContent = `–ü—Ä–∏–≤–µ—Ç, ${currentUser.name}! –í—ã–±–µ—Ä–∏ –∫–æ–º–ø–∞–Ω–∏—é.`;
                        } else {
                            subtitle.textContent = `–ü—Ä–∏–≤–µ—Ç, ${currentUser.name}! –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é.`;
                        }
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                }
            }
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (!currentUser) {
                window.location.href = 'auth.html';
                return;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'success') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type} show`;
            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 3000);
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
        async function loadCompanies() {
            try {
                const ganttMode = localStorage.getItem('gantt-mode') || 'edit';
                const isViewMode = ganttMode === 'view';
                
                const response = await fetch('/api/companies');
                const allCompanies = await response.json() || [];
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ –¥–æ—Å—Ç—É–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                let availableCompanies = [];
                
                // –í —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏
                if (isViewMode) {
                    availableCompanies = allCompanies;
                } else if (isAdmin) {
                    // –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏
                    availableCompanies = allCompanies;
                } else if (currentUser) {
                    // –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–æ–º–ø–∞–Ω–∏–∏
                    const userCompanies = currentUser.companies || [];
                    availableCompanies = allCompanies.filter(c => userCompanies.includes(c.id));
                } else {
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –Ω–µ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–ø–∞–Ω–∏–∏
                    availableCompanies = [];
                }
                
                renderCompanies(availableCompanies, allCompanies);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π', 'error');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è)
        async function loadCompanyInfo(companyId) {
            try {
                const response = await fetch(`/api/company-info?company=${companyId}`);
                if (response.ok) {
                    const data = await response.json();
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–µ—Å—å –æ–±—ä–µ–∫—Ç —Å name –∏ logoData
                    if (data) {
                        return data;
                    }
                }
            } catch (e) {
                console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ ${companyId}:`, e);
            }
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á –∫–æ–º–ø–∞–Ω–∏–∏
        async function checkCompanyTasksStatus(companyId) {
            try {
                const response = await fetch(`/api/gantt-state?company=${encodeURIComponent(companyId)}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.tasks && Array.isArray(data.tasks) && data.tasks.length > 0) {
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        
                        let allCompleted = true;
                        let hasOverdue = false;
                        
                        for (const task of data.tasks) {
                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á–∏-—ç—Ç–∞–ø—ã (—Å–≤–µ—Ä–Ω—É—Ç—ã–µ —ç—Ç–∞–ø—ã)
                            if (task.isStageRow) continue;
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
                            let endDate = null;
                            if (task.endDate) {
                                if (typeof task.endDate === 'string') {
                                    endDate = new Date(task.endDate);
                                } else if (task.endDate instanceof Date) {
                                    endDate = new Date(task.endDate);
                                } else if (task.endDate.getTime) {
                                    // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç Date
                                    endDate = new Date(task.endDate.getTime());
                                }
                                if (endDate && !isNaN(endDate.getTime())) {
                                    endDate.setHours(0, 0, 0, 0);
                                } else {
                                    endDate = null;
                                }
                            }
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å 'pending', 'in-progress', 'completed')
                            const taskStatus = task.status || 'pending';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º dateStatuses –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–∞—Ç
                            const dateStatuses = task.dateStatuses || {};
                            let taskFullyCompleted = false;
                            
                            // –ï—Å–ª–∏ –µ—Å—Ç—å dateStatuses, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –¥–∞—Ç—ã
                            if (Object.keys(dateStatuses).length > 0) {
                                let allDatesCompleted = true;
                                let hasOverdueDate = false;
                                
                                for (const [dateStr, status] of Object.entries(dateStatuses)) {
                                    const date = new Date(dateStr);
                                    if (!isNaN(date.getTime())) {
                                        date.setHours(0, 0, 0, 0);
                                        
                                        // –ï—Å–ª–∏ –¥–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ –∏ —Å—Ç–∞—Ç—É—Å –Ω–µ 'completed'
                                        if (date < today && status !== 'completed') {
                                            hasOverdueDate = true;
                                        }
                                        
                                        // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –¥–∞—Ç–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                                        if (status !== 'completed') {
                                            allDatesCompleted = false;
                                        }
                                    }
                                }
                                
                                taskFullyCompleted = allDatesCompleted;
                                if (hasOverdueDate) {
                                    hasOverdue = true;
                                }
                            } else {
                                // –ï—Å–ª–∏ –Ω–µ—Ç dateStatuses, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
                                taskFullyCompleted = (taskStatus === 'completed');
                            }
                            
                            // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                            if (!taskFullyCompleted) {
                                allCompleted = false;
                                
                                // –ï—Å–ª–∏ –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–æ—à–ª–∞ –∏ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –æ–Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞
                                if (endDate && endDate < today) {
                                    hasOverdue = true;
                                }
                            }
                        }
                        
                        // –ï—Å–ª–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
                        if (allCompleted) {
                            return 'all-completed';
                        }
                        
                        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
                        if (hasOverdue) {
                            return 'has-overdue';
                        }
                    }
                }
            } catch (e) {
                console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á –∫–æ–º–ø–∞–Ω–∏–∏ ${companyId}:`, e);
            }
            return null;
        }

        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
        async function renderCompanies(companies, allCompanies = []) {
            const container = document.getElementById('companiesContainer');
            const ganttMode = localStorage.getItem('gantt-mode') || 'edit';
            const isViewMode = ganttMode === 'view';
            
            if (companies.length === 0) {
                if (isViewMode) {
                    container.innerHTML = `
                        <div class="companies-grid">
                            <div class="empty-state">
                                <p>–ö–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
                            </div>
                        </div>
                    `;
                } else if (isAdmin) {
                    container.innerHTML = `
                        <div class="companies-grid">
                            <div class="empty-state">
                                <p>–ö–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é.</p>
                            </div>
                            <div class="add-company-card" onclick="return openCreateModal(event)">
                                <div class="add-company-icon">+</div>
                                <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é</h3>
                            </div>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="companies-grid">
                            <div class="empty-state">
                                <p>–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–∏ –∫ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
                            </div>
                        </div>
                    `;
                }
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö (–ª–æ–≥–æ—Ç–∏–ø—ã, –Ω–∞–∑–≤–∞–Ω–∏—è –∏ —Ç–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤) –∏ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
            const companiesWithInfo = await Promise.all(
                companies.map(async (company) => {
                    const [companyInfo, taskStatus] = await Promise.all([
                        loadCompanyInfo(company.id),
                        checkCompanyTasksStatus(company.id)
                    ]);
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ company-info, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –∏–∑ companies.json
                    const companyName = companyInfo && companyInfo.name ? companyInfo.name : company.name;
                    const objectName = companyInfo && companyInfo.objectName ? companyInfo.objectName : null;
                    const logoData = companyInfo && companyInfo.logoData ? companyInfo.logoData : null;
                    const chartType = companyInfo && companyInfo.chartType ? companyInfo.chartType : 'icona';
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π containerName, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    const containerName = companyInfo && companyInfo.containerName ? companyInfo.containerName : null;
                    return { ...company, name: companyName, objectName, logoData, chartType, containerName, taskStatus };
                })
            );

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º
            const companiesByContainer = {};
            companiesWithInfo.forEach(company => {
                let containerName = company.containerName;
                
                // –ï—Å–ª–∏ containerName –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ company-info, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ chartTypesList
                if (!containerName) {
                    const chartType = company.chartType || 'icona';
                    // –ù–∞—Ö–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –≥—Ä–∞—Ñ–∏–∫–∞
                    const chartTypeInfo = window.chartTypesList?.find(ct => ct.id === chartType);
                    if (chartTypeInfo && chartTypeInfo.containerName) {
                        containerName = chartTypeInfo.containerName;
                    } else {
                        // Fallback –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
                        containerName = chartType === 'icona' ? 'Icona' : (chartType === 'praktis' ? 'Praktis ID' : '–î—Ä—É–≥–∏–µ');
                    }
                }
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ containerName –Ω–µ –ø—É—Å—Ç–æ–π
                if (!containerName || containerName.trim() === '') {
                    containerName = '–î—Ä—É–≥–∏–µ';
                }
                
                if (!companiesByContainer[containerName]) {
                    companiesByContainer[containerName] = [];
                }
                companiesByContainer[containerName].push(company);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
            window.chartTypesList = window.chartTypesList || [];

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏
            const renderCompanyCard = (company) => {
                const logoHtml = company.logoData 
                    ? `<img src="${company.logoData}" alt="${company.name}" class="company-logo">`
                    : `<div class="company-logo-placeholder">–ù–µ—Ç –ª–æ–≥–æ—Ç–∏–ø–∞</div>`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ ID –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ HTML
                const safeCompanyId = company.id.replace(/"/g, '&quot;');
                const safeCompanyName = company.name.replace(/"/g, '&quot;');
                const safeCompanyIdForJs = company.id.replace(/'/g, "\\'");
                
                // –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ (–≤–∫–ª—é—á–∞—è "–£–¥–∞–ª–∏—Ç—å"), –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: —Ç–æ–ª—å–∫–æ "–û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫" –∏ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É"
                // –í —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∞–∂–µ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
                let actionsHtml = '';
                if (isAdmin && !isViewMode) {
                    // –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª—é—á–∞—è "–£–¥–∞–ª–∏—Ç—å"
                    actionsHtml = `
                        <button class="btn btn-primary btn-open-company" data-company-id="${safeCompanyId}" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫
                        </button>
                        <button class="btn btn-primary btn-edit-company" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
                        </button>
                        <button class="btn btn-primary btn-copy-link" data-company-id="${safeCompanyId}" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                        </button>
                        <button class="btn btn-primary btn-delete-company" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    `;
                } else if (isAdmin && isViewMode) {
                    // –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: –±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–£–¥–∞–ª–∏—Ç—å"
                    actionsHtml = `
                        <button class="btn btn-primary btn-open-company" data-company-id="${safeCompanyId}" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫
                        </button>
                        <button class="btn btn-primary btn-edit-company" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
                        </button>
                        <button class="btn btn-primary btn-copy-link" data-company-id="${safeCompanyId}" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                        </button>
                    `;
                } else {
                    // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: —Ç–æ–ª—å–∫–æ –û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                    actionsHtml = `
                        <button class="btn btn-primary btn-open-company" data-company-id="${safeCompanyId}" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫
                        </button>
                        <button class="btn btn-primary btn-copy-link" data-company-id="${safeCompanyId}" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                        </button>
                    `;
                }
                
                // –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)
                const copyButtonHtml = isAdmin ? `
                    <button class="copy-company-btn" data-company-id="${safeCompanyId}" data-tooltip="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é" draggable="false">
                        <span class="copy-company-tooltip">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</span>
                    </button>
                ` : '';
                
                // –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö (—Å–ª–µ–≤–∞ –≤–≤–µ—Ä—Ö—É)
                const statisticsButtonHtml = `
                    <button class="statistics-company-btn" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}" data-tooltip="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏" draggable="false" onmousedown="event.stopPropagation();" ondragstart="event.preventDefault(); return false;">
                        <span class="statistics-company-tooltip">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏</span>
                    </button>
                `;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á
                const statusClass = company.taskStatus || '';
                
                return `
                <div class="company-card ${isAdmin ? 'draggable' : ''} ${statusClass}" ${isAdmin ? '' : `data-company-id="${safeCompanyId}"`} ${isAdmin ? `draggable="true" data-company-id="${safeCompanyId}"` : ''}>
                    ${statisticsButtonHtml}
                    ${copyButtonHtml}
                    ${logoHtml}
                    <h3>${company.name}</h3>
                    ${company.objectName ? `<div class="company-object-name">${company.objectName}</div>` : ''}
                    <div class="company-id">ID: ${company.id}</div>
                    <div class="company-actions">
                        ${actionsHtml}
                    </div>
                </div>
            `;
            };

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML –±–ª–æ–∫–∞ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏
            const renderCompanySection = (companies, sectionTitle) => {
                if (companies.length === 0) return '';
                
                const companiesHtml = companies.map(company => renderCompanyCard(company)).join('');
                
                return `
                    <div class="chart-type-section">
                        <h2 class="chart-type-header">${sectionTitle}</h2>
                        <div class="companies-grid">
                            ${companiesHtml}
                        </div>
                    </div>
                `;
            };

            // –°–æ–±–∏—Ä–∞–µ–º HTML —Å –¥–≤—É–º—è –±–ª–æ–∫–∞–º–∏
            let html = '';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º
            const containerNames = Object.keys(companiesByContainer).sort();
            containerNames.forEach(containerName => {
                html += renderCompanySection(companiesByContainer[containerName], containerName);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ)
            if (isAdmin && containerNames.length > 0) {
                html += `
                    <div class="chart-type-section">
                        <div class="companies-grid">
                            <div class="add-company-card" onclick="return openCreateModal(event)">
                                <div class="add-company-icon">+</div>
                                <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é</h3>
                            </div>
                        </div>
                    </div>
                `;
            }

            // –ï—Å–ª–∏ –æ–±–∞ –±–ª–æ–∫–∞ –ø—É—Å—Ç—ã–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (!html) {
                if (isAdmin) {
                    html = `
                        <div class="companies-grid">
                            <div class="empty-state">
                                <p>–ö–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é.</p>
                            </div>
                            <div class="add-company-card" onclick="return openCreateModal(event)">
                                <div class="add-company-icon">+</div>
                                <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é</h3>
                            </div>
                        </div>
                    `;
                } else {
                    html = `
                        <div class="companies-grid">
                            <div class="empty-state">
                                <p>–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–∏ –∫ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
                            </div>
                        </div>
                    `;
                }
            }

            container.innerHTML = html;
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –Ω–∞—á–∞–ª–æ drag –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö - –î–û –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
            container.querySelectorAll('.btn-edit-company, .btn-delete-company, .statistics-company-btn, .copy-company-btn').forEach(btn => {
                // –ë–ª–æ–∫–∏—Ä—É–µ–º drag –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
                btn.setAttribute('draggable', 'false');
                btn.addEventListener('mousedown', function(e) {
                    e.stopPropagation();
                    wasDragStarted = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ drag
                }, true);
                btn.addEventListener('dragstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    wasDragStarted = false;
                    return false;
                }, true);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π
            container.querySelectorAll('.company-card').forEach(card => {
                let completedAnimations = 0;
                let animationEndHandler = null;
                let animationTimeout = null;
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
                const cleanupAnimation = function() {
                    card.classList.remove('animating-border');
                    if (animationEndHandler) {
                        card.removeEventListener('animationend', animationEndHandler);
                        animationEndHandler = null;
                    }
                    if (animationTimeout) {
                        clearTimeout(animationTimeout);
                        animationTimeout = null;
                    }
                    completedAnimations = 0;
                };
                
                // –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                card.addEventListener('mouseenter', function() {
                    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∞–Ω–∏–º–∞—Ü–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                    cleanupAnimation();
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ–π
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                            card.classList.add('animating-border');
                            
                            // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                            animationEndHandler = function(e) {
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω—É–∂–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                                if (e.animationName === 'borderLeftFlow' || e.animationName === 'borderRightFlow') {
                                    completedAnimations++;
                                    
                                    // –ö–æ–≥–¥–∞ –æ–±–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å, —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å
                                    if (completedAnimations >= 2) {
                                        cleanupAnimation();
                                    }
                                }
                            };
                            
                            card.addEventListener('animationend', animationEndHandler);
                            
                            // –ó–∞–ø–∞—Å–Ω–æ–π —Ç–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ animationend –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
                            // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ 1.2 —Å–µ–∫—É–Ω–¥—ã, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å
                            animationTimeout = setTimeout(function() {
                                cleanupAnimation();
                            }, 1500);
                        });
                    });
                });
                
                // –ü—Ä–∏ —É—Ö–æ–¥–µ –∫—É—Ä—Å–æ—Ä–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é - –ø–æ–∑–≤–æ–ª—è–µ–º –µ–π –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
                card.addEventListener('mouseleave', function() {
                    // –ù–µ —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å —Å—Ä–∞–∑—É - –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                    // –ö–ª–∞—Å—Å animating-border –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±–µ–∏—Ö –∞–Ω–∏–º–∞—Ü–∏–π
                });
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            setupCompanyButtons();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag and drop –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–º–ø–∞–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
            if (isAdmin) {
                setupDragAndDrop();
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π - –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        let companyButtonsHandler = null;
        let archivedCompanyButtonsHandler = null;
        
        function setupCompanyButtons() {
            const container = document.getElementById('companiesContainer');
            const archivedContainer = document.getElementById('archivedCompaniesContainer');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            if (container) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                if (companyButtonsHandler) {
                    container.removeEventListener('click', companyButtonsHandler);
                }
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            if (archivedContainer) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                if (archivedCompanyButtonsHandler) {
                    archivedContainer.removeEventListener('click', archivedCompanyButtonsHandler);
                }
            }
            
            if (!container && !archivedContainer) return;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
            companyButtonsHandler = function(e) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –ø—Ä–æ–∏–∑–æ—à–µ–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                if (!container.contains(e.target) && !e.target.closest('#companiesContainer')) {
                    return;
                }
                
                // –ï—Å–ª–∏ —Ç—É—Ä –∞–∫—Ç–∏–≤–µ–Ω, –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∫–æ–º–ø–∞–Ω–∏–∏
                if (firstVisitActive) {
                    // console.log('üõë –¢—É—Ä –∞–∫—Ç–∏–≤–µ–Ω, –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç—É—Ä –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É');
                    endFirstVisitTour();
                }
                
                console.log('Click detected on:', e.target, e.target.className, e.target.closest('button'));
                
                const editBtn = e.target.closest('.btn-edit-company');
                if (editBtn) {
                    e.stopPropagation();
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    const companyId = editBtn.getAttribute('data-company-id');
                    const companyName = editBtn.getAttribute('data-company-name');
                    console.log('Edit button clicked:', companyId, companyName);
                    if (companyId && companyName) {
                        const editFn = typeof editCompany === 'function' ? editCompany : (typeof window.editCompany === 'function' ? window.editCompany : null);
                        if (editFn) {
                            editFn(companyId, companyName);
                        } else {
                            console.error('editCompany function not available');
                        }
                    }
                    return;
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
                const openBtn = e.target.closest('.btn-open-company');
                if (openBtn) {
                    e.stopPropagation();
                    const companyId = openBtn.getAttribute('data-company-id');
                    if (companyId) {
                        openCompany(companyId);
                    }
                    return;
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
                const copyBtn = e.target.closest('.btn-copy-link');
                if (copyBtn) {
                    e.stopPropagation();
                    const companyId = copyBtn.getAttribute('data-company-id');
                    if (companyId) {
                        copyCompanyLink(companyId);
                    }
                    return;
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
                const deleteBtn = e.target.closest('.btn-delete-company');
                if (deleteBtn) {
                    e.stopPropagation();
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    const companyId = deleteBtn.getAttribute('data-company-id');
                    const companyName = deleteBtn.getAttribute('data-company-name');
                    console.log('Delete button clicked:', companyId, companyName);
                    if (companyId && companyName) {
                        const deleteFn = typeof deleteCompany === 'function' ? deleteCompany : (typeof window.deleteCompany === 'function' ? window.deleteCompany : null);
                        if (deleteFn) {
                            deleteFn(companyId, companyName);
                        } else {
                            console.error('deleteCompany function not available');
                        }
                    }
                    return;
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const statisticsBtn = e.target.closest('.statistics-company-btn');
                if (statisticsBtn) {
                    e.stopPropagation();
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    const companyId = statisticsBtn.getAttribute('data-company-id');
                    const companyName = statisticsBtn.getAttribute('data-company-name');
                    console.log('Statistics button clicked:', companyId, companyName);
                    if (companyId) {
                        // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                        let statsFn = null;
                        if (typeof showCompanyStatistics === 'function') {
                            statsFn = showCompanyStatistics;
                        } else if (typeof window.showCompanyStatistics === 'function') {
                            statsFn = window.showCompanyStatistics;
                        } else {
                            console.error('showCompanyStatistics function not available', {
                                showCompanyStatistics: typeof showCompanyStatistics,
                                windowShowCompanyStatistics: typeof window.showCompanyStatistics
                            });
                            showMessage('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                            return;
                        }
                        try {
                            statsFn(companyId, companyName || '');
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ showCompanyStatistics:', error);
                            showMessage('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                        }
                    } else {
                        console.error('companyId not found for statistics button');
                        showMessage('–û—à–∏–±–∫–∞: ID –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    }
                    return;
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
                const copyCompanyBtn = e.target.closest('.copy-company-btn');
                if (copyCompanyBtn) {
                    e.stopPropagation();
                    const companyId = copyCompanyBtn.getAttribute('data-company-id');
                    if (companyId) {
                        copyCompany(companyId);
                    }
                    return;
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–¥–ª—è –≤—Å–µ—Ö, –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ drag)
                const card = e.target.closest('.company-card');
                if (card) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –Ω–µ –Ω–∞ –∫–Ω–æ–ø–∫–µ
                    const isButton = e.target.closest('button');
                    
                    // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –±—ã–ª drag –∏–ª–∏ –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ
                    if (!isButton) {
                        // –ï—Å–ª–∏ –±—ã–ª drag, –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                        if (wasDragStarted) {
                            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
                            setTimeout(() => {
                                wasDragStarted = false;
                            }, 100);
                            return;
                        }
                        
                        const companyId = card.getAttribute('data-company-id');
                        if (companyId) {
                            openCompany(companyId);
                        }
                    }
                }
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π bubbling, –Ω–æ —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
            if (container) {
                container.addEventListener('click', companyButtonsHandler, false);
            }
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π, –Ω–æ –±–µ–∑ drag&drop)
            if (archivedContainer) {
                archivedCompanyButtonsHandler = function(e) {
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    const statisticsBtn = e.target.closest('.statistics-company-btn');
                    if (statisticsBtn) {
                        e.stopPropagation();
                        e.preventDefault();
                        const companyId = statisticsBtn.getAttribute('data-company-id');
                        const companyName = statisticsBtn.getAttribute('data-company-name');
                        console.log('Archived statistics button clicked:', companyId, companyName);
                        if (companyId) {
                            showCompanyStatistics(companyId, companyName || '');
                        }
                        return;
                    }
                };
                
                archivedContainer.addEventListener('click', archivedCompanyButtonsHandler, false);
            }
            
            console.log('setupCompanyButtons: handlers attached', {
                container: !!container,
                archivedContainer: !!archivedContainer,
                editCompany: typeof editCompany,
                windowEditCompany: typeof window.editCompany,
                deleteCompany: typeof deleteCompany,
                windowDeleteCompany: typeof window.deleteCompany,
                showCompanyStatistics: typeof showCompanyStatistics,
                windowShowCompanyStatistics: typeof window.showCompanyStatistics
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ drag and drop –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–º–ø–∞–Ω–∏–π
        function setupDragAndDrop() {
            const container = document.getElementById('companiesContainer');
            if (!container) return;

            let draggedElement = null;
            let draggedOverElement = null;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            container.addEventListener('dragstart', (e) => {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                if (e.target.closest('button') || e.target.closest('a') || e.target.closest('input')) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    wasDragStarted = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥, –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ –∫–Ω–æ–ø–∫–µ
                    return false;
                }
                
                const card = e.target.closest('.company-card.draggable');
                if (!card) {
                    e.preventDefault();
                    return false;
                }

                draggedElement = card;
                wasDragStarted = true; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —á—Ç–æ –Ω–∞—á–∞–ª–æ—Å—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                card.classList.add('dragging');
                isDragging = true; // –ü–∞—É–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–≤–µ—Ç–ª—è—á–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', card.outerHTML);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            container.addEventListener('dragend', (e) => {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                }
                
                isDragging = false; // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–≤–µ—Ç–ª—è—á–∫–æ–≤
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ drag —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –∫–ª–∏–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ø–æ—Å–ª–µ drag
                setTimeout(() => {
                    wasDragStarted = false;
                }, 200);
                
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å drag-over —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const allCards = container.querySelectorAll('.company-card.drag-over');
                allCards.forEach(card => card.classList.remove('drag-over'));
            });
            

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –Ω–∞–¥ —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å throttling –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            let lastDragOverTime = 0;
            const dragOverThrottle = 16; // ~60fps
            
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';

                const now = performance.now();
                if (now - lastDragOverTime < dragOverThrottle) {
                    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                }
                lastDragOverTime = now;

                const card = e.target.closest('.company-card.draggable');
                if (!card || card === draggedElement) return;

                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å drag-over —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è
                if (draggedOverElement && draggedOverElement !== card) {
                    draggedOverElement.classList.remove('drag-over');
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è
                if (draggedOverElement !== card) {
                    draggedOverElement = card;
                    card.classList.add('drag-over');
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞
            container.addEventListener('dragleave', (e) => {
                const card = e.target.closest('.company-card.draggable');
                if (card && card !== draggedElement) {
                    card.classList.remove('drag-over');
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
            container.addEventListener('drop', async (e) => {
                e.preventDefault();
                e.stopPropagation();

                const targetCard = e.target.closest('.company-card.draggable');
                if (!targetCard || !draggedElement || targetCard === draggedElement) {
                    return;
                }

                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã
                targetCard.classList.remove('drag-over');
                draggedElement.classList.remove('dragging');

                // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (grid)
                const sourceGrid = draggedElement.closest('.companies-grid');
                const targetGrid = targetCard.closest('.companies-grid');

                // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ grid (–æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞)
                if (sourceGrid !== targetGrid) {
                    draggedElement = null;
                    return;
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const allCards = Array.from(targetGrid.querySelectorAll('.company-card.draggable'));
                const draggedIndex = allCards.indexOf(draggedElement);
                const targetIndex = allCards.indexOf(targetCard);

                if (draggedIndex === -1 || targetIndex === -1) {
                    draggedElement = null;
                    return;
                }

                // FLIP-—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                // First: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ (–î–û –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ DOM)
                const firstPositions = new Map();
                allCards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    firstPositions.set(card, {
                        x: rect.left,
                        y: rect.top
                    });
                });

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ (–ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º) –ü–ï–†–ï–î –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –≤ DOM
                const draggedCurrentRect = draggedElement.getBoundingClientRect();
                const draggedCurrentPosition = {
                    x: draggedCurrentRect.left,
                    y: draggedCurrentRect.top
                };
                
                // Last: –ø–µ—Ä–µ–º–µ—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ DOM
                if (draggedIndex < targetIndex) {
                    targetGrid.insertBefore(draggedElement, targetCard.nextSibling);
                } else {
                    targetGrid.insertBefore(draggedElement, targetCard);
                }

                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å dragging
                draggedElement.classList.remove('dragging');
                
                // Invert: –≤—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º transform –¥–ª—è –í–°–ï–• –∫–∞—Ä—Ç–æ—á–µ–∫
                const newCards = Array.from(targetGrid.querySelectorAll('.company-card.draggable'));
                const cardsToAnimate = [];
                
                newCards.forEach((card, newIndex) => {
                    const oldIndex = allCards.indexOf(card);
                    const lastRect = card.getBoundingClientRect();
                    
                    let deltaX, deltaY;
                    
                    if (card === draggedElement) {
                        // –î–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é (–ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º)
                        deltaX = draggedCurrentPosition.x - lastRect.left;
                        deltaY = draggedCurrentPosition.y - lastRect.top;
                    } else {
                        // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                        if (firstPositions.has(card)) {
                            const first = firstPositions.get(card);
                            deltaX = first.x - lastRect.left;
                            deltaY = first.y - lastRect.top;
                        } else {
                            return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
                        }
                    }
                    
                    // –ê–Ω–∏–º–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ
                    if (Math.abs(deltaX) > 1 || Math.abs(deltaY) > 1) {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π transform –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                        card.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
                        card.style.transition = 'none';
                        cardsToAnimate.push(card);
                    }
                });

                // Play: –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫ –Ω–æ–≤—ã–º –ø–æ–∑–∏—Ü–∏—è–º
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        cardsToAnimate.forEach(card => {
                            card.classList.add('animating');
                            card.style.transform = '';
                            card.style.transition = '';
                            
                            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                            const handleTransitionEnd = (e) => {
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏–º–µ–Ω–Ω–æ –¥–ª—è transform
                                if (!e.propertyName || e.propertyName === 'transform') {
                                    card.classList.remove('animating');
                                    card.style.transform = '';
                                    card.removeEventListener('transitionend', handleTransitionEnd);
                                }
                            };
                            card.addEventListener('transitionend', handleTransitionEnd);
                        });
                    });
                });

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫
                await saveCompaniesOrder();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏
                mouseDownPosition = null;
                mouseDownCard = null;
                draggedElement = null;
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function saveCompaniesOrder() {
            try {
                const container = document.getElementById('companiesContainer');
                if (!container) return;

                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const allGrids = container.querySelectorAll('.companies-grid');
                const companyIds = [];

                allGrids.forEach(grid => {
                    const cards = grid.querySelectorAll('.company-card.draggable');
                    cards.forEach(card => {
                        const companyId = card.getAttribute('data-company-id');
                        if (companyId) {
                            companyIds.push(companyId);
                        }
                    });
                });

                if (companyIds.length === 0) return;

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('/api/companies/order', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ companyIds })
                });

                const result = await response.json();
                if (!result.ok) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π:', result.error);
                    showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π:', error);
                showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π', 'error');
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏
        async function openCompany(companyId) {
            // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤, –≤–∫–ª—é—á–∞—è Praktis ID
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ (–¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º)
            try {
                const companyInfo = await loadCompanyInfo(companyId);
                const chartType = companyInfo && companyInfo.chartType ? companyInfo.chartType : 'icona';
                console.log('üìä –û—Ç–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Ç–∏–ø–∞:', chartType);
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏:', e);
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –æ–±—ã—á–Ω—ã–º –≥—Ä–∞—Ñ–∏–∫–æ–º, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–ø–∞–Ω–∏—é
            localStorage.setItem('gantt-company', companyId);
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥—Ä–∞—Ñ–∏–∫–∞ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è
            window.location.href = `implementation_schedule.html?company=${companyId}`;
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        async function copyCompanyLink(companyId) {
            try {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω
                const baseUrl = window.location.origin;
                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (—Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
                const link = `${baseUrl}/auth.html?company=${companyId}`;
                
                // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                await navigator.clipboard.writeText(link);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                showMessage(`–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: ${link}`, 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏:', error);
                
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                try {
                    const baseUrl = window.location.origin;
                    const link = `${baseUrl}/auth.html?company=${companyId}`;
                    
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π textarea –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                    const textarea = document.createElement('textarea');
                    textarea.value = link;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = '0';
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    showMessage(`–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: ${link}`, 'success');
                } catch (fallbackError) {
                    console.error('–û—à–∏–±–∫–∞ fallback –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', fallbackError);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –∏–ª–∏ alert
                    const baseUrl = window.location.origin;
                    const link = `${baseUrl}/auth.html?company=${companyId}`;
                    alert(`–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—Ä—É—á–Ω—É—é:\n\n${link}`);
                }
            }
        }

        let companyToEdit = null;
        let companyToDelete = null;

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        async function editCompany(companyId, companyName) {
            console.log('editCompany called with:', companyId, companyName);
            if (!isAdmin) {
                showMessage('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                return;
            }

            companyToEdit = { id: companyId };
            const modal = document.getElementById('editCompanyModal');
            const messageEl = document.getElementById('editMessage');
            const idInput = document.getElementById('editCompanyId');
            const nameInput = document.getElementById('editCompanyName');
            const chartTypeInput = document.getElementById('editCompanyChartType');
            const logoInput = document.getElementById('editCompanyLogo');
            const preview = document.getElementById('editLogoPreview');
            const previewImg = document.getElementById('editLogoPreviewImg');
            const currentLogoDiv = document.getElementById('editCurrentLogo');

            console.log('Elements found:', {
                modal: !!modal,
                idInput: !!idInput,
                nameInput: !!nameInput,
                chartTypeInput: !!chartTypeInput
            });

            if (!modal || !idInput || !nameInput || !chartTypeInput) {
                console.error('Missing required elements for editCompany modal!', {
                    modal: !!modal,
                    idInput: !!idInput,
                    nameInput: !!nameInput,
                    chartTypeInput: !!chartTypeInput
                });
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            updateChartTypeSelects();

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏
            idInput.value = companyId;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø, –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∏ —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
            const objectNameInput = document.getElementById('editCompanyObjectName');
            try {
                const companyInfo = await loadCompanyInfo(companyId);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ company-info, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
                if (companyInfo && companyInfo.name) {
                    nameInput.value = companyInfo.name;
                } else {
                    nameInput.value = companyName;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                if (objectNameInput && companyInfo && companyInfo.objectName) {
                    objectNameInput.value = companyInfo.objectName;
                } else if (objectNameInput) {
                    objectNameInput.value = '';
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
                if (companyInfo && companyInfo.chartType) {
                    chartTypeInput.value = companyInfo.chartType;
                } else {
                    chartTypeInput.value = 'icona'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
                }
                
                if (companyInfo && companyInfo.logoData) {
                    currentLogoDiv.innerHTML = `
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø:</p>
                        <img src="${companyInfo.logoData}" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid rgba(100, 181, 246, 0.3);">
                    `;
                } else {
                    currentLogoDiv.innerHTML = '<p style="color: #999; font-size: 0.9rem;">–õ–æ–≥–æ—Ç–∏–ø –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</p>';
                }
            } catch (e) {
                currentLogoDiv.innerHTML = '<p style="color: #999; font-size: 0.9rem;">–õ–æ–≥–æ—Ç–∏–ø –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</p>';
                chartTypeInput.value = 'icona'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–≤–æ–≥–æ –ª–æ–≥–æ—Ç–∏–ø–∞
            if (preview) preview.style.display = 'none';
            if (previewImg) previewImg.src = '';
            if (logoInput) logoInput.value = '';
            if (messageEl) messageEl.classList.remove('show');

            console.log('Opening editCompany modal');
            modal.classList.add('show');
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º inline —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.zIndex = '10000';
            modal.style.pointerEvents = 'auto';
            console.log('Modal classList after add:', modal.classList.toString());
            console.log('Modal styles:', {
                display: modal.style.display,
                visibility: modal.style.visibility,
                opacity: modal.style.opacity,
                zIndex: modal.style.zIndex
            });
        }

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.editCompany = editCompany;
        // –¢–∞–∫–∂–µ –¥–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–π —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        if (typeof window !== 'undefined') {
            window.editCompany = editCompany;
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function closeEditModal() {
            const modal = document.getElementById('editCompanyModal');
            if (modal) {
                modal.classList.remove('show');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º inline —Å—Ç–∏–ª–∏
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                modal.style.pointerEvents = 'none';
            }
            companyToEdit = null;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!companyToEdit || !isAdmin) {
                return;
            }

            const oldCompanyId = companyToEdit.id;
            const newCompanyId = document.getElementById('editCompanyId').value.trim();
            const companyName = document.getElementById('editCompanyName').value.trim();
            const objectName = document.getElementById('editCompanyObjectName') ? document.getElementById('editCompanyObjectName').value.trim() : '';
            const chartType = document.getElementById('editCompanyChartType').value;
            const logoFile = document.getElementById('editCompanyLogo').files[0];
            const messageEl = document.getElementById('editMessage');

            if (!newCompanyId || !companyName || !chartType) {
                messageEl.textContent = 'ID, –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã';
                messageEl.className = 'message error show';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ ID
            if (!/^[a-zA-Z0-9_-]+$/.test(newCompanyId)) {
                messageEl.textContent = 'ID –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è';
                messageEl.className = 'message error show';
                return;
            }

            try {
                // –ï—Å–ª–∏ ID –∏–∑–º–µ–Ω–∏–ª—Å—è, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–Ω–∏—é —á–µ—Ä–µ–∑ PUT API
                if (newCompanyId !== oldCompanyId) {
                    const updateUrl = `/api/companies/${encodeURIComponent(oldCompanyId)}`;
                    console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ID –∫–æ–º–ø–∞–Ω–∏–∏:', { oldId: oldCompanyId, newId: newCompanyId, url: updateUrl });
                    
                    const updateResponse = await fetch(updateUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            id: newCompanyId,
                            name: companyName
                        })
                    });

                    if (!updateResponse.ok) {
                        const errorText = await updateResponse.text();
                        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞:', updateResponse.status, errorText);
                        throw new Error(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ID –∫–æ–º–ø–∞–Ω–∏–∏: ${updateResponse.status} ${updateResponse.statusText}`);
                    }

                    const updateResult = await updateResponse.json();
                    if (!updateResult.ok) {
                        throw new Error(updateResult.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ID –∫–æ–º–ø–∞–Ω–∏–∏');
                    }
                    console.log('‚úÖ ID –∫–æ–º–ø–∞–Ω–∏–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –ª–æ–≥–æ—Ç–∏–ø)
                let logoData = null;
                
                // –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–æ–≤—ã–π –ª–æ–≥–æ—Ç–∏–ø, —Å–∂–∏–º–∞–µ–º –µ–≥–æ
                if (logoFile) {
                    logoData = await compressImage(logoFile);
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø
                    const currentCompanyInfo = await loadCompanyInfo(newCompanyId !== oldCompanyId ? oldCompanyId : newCompanyId);
                    if (currentCompanyInfo && currentCompanyInfo.logoData) {
                        logoData = currentCompanyInfo.logoData;
                    }
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π ID, –µ—Å–ª–∏ –æ–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è)
                // –ü–æ–ª—É—á–∞–µ–º containerName –∏–∑ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞
                let containerName = null;
                try {
                    const chartTypesResponse = await fetch('/api/chart-types');
                    if (chartTypesResponse.ok) {
                        const chartTypes = await chartTypesResponse.json();
                        const chartTypeInfo = chartTypes.find(ct => ct.id === chartType);
                        if (chartTypeInfo) {
                            containerName = chartTypeInfo.containerName;
                        } else {
                            // Fallback –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
                            containerName = chartType === 'icona' ? 'Icona' : (chartType === 'praktis' ? 'Praktis ID' : null);
                        }
                    }
                } catch (err) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è containerName:', err);
                    // Fallback –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
                    containerName = chartType === 'icona' ? 'Icona' : (chartType === 'praktis' ? 'Praktis ID' : null);
                }
                
                const infoResponse = await fetch(`/api/company-info?company=${newCompanyId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: companyName,
                        objectName: objectName || null,
                        logoData: logoData,
                        chartType: chartType,
                        containerName: containerName
                    })
                });

                if (!infoResponse.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏–∏');
                }

                // –ï—Å–ª–∏ ID –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, –Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ PUT API
                if (newCompanyId === oldCompanyId) {
                    const updateUrl = `/api/companies/${encodeURIComponent(oldCompanyId)}`;
                    console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', { id: oldCompanyId, name: companyName, url: updateUrl });
                    
                    const updateResponse = await fetch(updateUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: companyName
                        })
                    });

                    if (!updateResponse.ok) {
                        const errorText = await updateResponse.text();
                        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞:', updateResponse.status, errorText);
                        throw new Error(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏: ${updateResponse.status} ${updateResponse.statusText}`);
                    }

                    const updateResult = await updateResponse.json();
                    if (!updateResult.ok) {
                        throw new Error(updateResult.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏');
                    }
                    console.log('‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
                }

                messageEl.textContent = '–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
                messageEl.className = 'message success show';
                
                setTimeout(() => {
                    closeEditModal();
                    loadCompanies();
                }, 1000);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:', error);
                messageEl.textContent = error.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π';
                messageEl.className = 'message error show';
            }
        });

        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ—Ç–∏–ø–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
        document.getElementById('editCompanyLogo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('editLogoPreview');
            const previewImg = document.getElementById('editLogoPreviewImg');
            
            if (file) {
                if (!file.type.match('image.*')) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                    e.target.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                if (file.size > 2 * 1024 * 1024) {
                    alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 2MB');
                    e.target.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        });

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è (—É–¥–∞–ª–∏—Ç—å/–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å) - —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        function deleteCompany(companyId, companyName) {
            console.log('deleteCompany called with:', companyId, companyName);
            if (!isAdmin) {
                showMessage('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                return;
            }

            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ companyName –Ω–µ undefined
            companyToDelete = { 
                id: companyId || '', 
                name: companyName || companyId || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è' 
            };
            console.log('deleteCompany: companyToDelete set to:', companyToDelete);
            
            const modal = document.getElementById('deleteOrArchiveModal');
            const textEl = document.getElementById('deleteOrArchiveText');
            
            console.log('Delete modal elements found:', {
                modal: !!modal,
                textEl: !!textEl
            });
            
            if (!modal) {
                console.error('deleteOrArchiveModal not found!');
                return;
            }
            
            if (textEl) {
                textEl.textContent = `–í—ã —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏–ª–∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –∞—Ä—Ö–∏–≤?`;
            }
            
            console.log('Opening deleteOrArchiveModal');
            modal.classList.add('show');
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º inline —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.zIndex = '10001';
            modal.style.pointerEvents = 'auto';
            console.log('Modal classList after add:', modal.classList.toString());
            console.log('Modal styles:', {
                display: modal.style.display,
                visibility: modal.style.visibility,
                opacity: modal.style.opacity,
                zIndex: modal.style.zIndex
            });
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è
        function cancelDeleteOrArchive() {
            console.log('cancelDeleteOrArchive called, companyToDelete before reset:', companyToDelete);
            const modal = document.getElementById('deleteOrArchiveModal');
            if (modal) {
                modal.classList.remove('show');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º inline —Å—Ç–∏–ª–∏
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                modal.style.pointerEvents = 'none';
            }
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º companyToDelete —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ (–Ω–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é —É–¥–∞–ª–µ–Ω–∏—è)
            companyToDelete = null;
            console.log('cancelDeleteOrArchive: companyToDelete reset to null');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
        function showDeleteConfirm() {
            console.log('showDeleteConfirm called, companyToDelete:', companyToDelete);
            if (!companyToDelete) {
                console.error('companyToDelete is null or undefined in showDeleteConfirm');
                console.error('Stack trace:', new Error().stack);
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const savedCompanyToDelete = {
                id: companyToDelete.id,
                name: companyToDelete.name || companyToDelete.id || '—ç—Ç—É –∫–æ–º–ø–∞–Ω–∏—é'
            };
            console.log('showDeleteConfirm: savedCompanyToDelete:', savedCompanyToDelete);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ name, –µ—Å–ª–∏ –Ω–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º id
            const companyName = savedCompanyToDelete.name;
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–æ –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º companyToDelete
            const deleteOrArchiveModal = document.getElementById('deleteOrArchiveModal');
            if (deleteOrArchiveModal) {
                deleteOrArchiveModal.classList.remove('show');
                deleteOrArchiveModal.style.display = 'none';
                deleteOrArchiveModal.style.visibility = 'hidden';
                deleteOrArchiveModal.style.opacity = '0';
                deleteOrArchiveModal.style.zIndex = '-1';
                deleteOrArchiveModal.style.pointerEvents = 'none';
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º companyToDelete —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            companyToDelete = savedCompanyToDelete;
            console.log('companyToDelete restored after closing deleteOrArchiveModal:', companyToDelete);
            console.log('showDeleteConfirm: companyToDelete after restore:', JSON.stringify(companyToDelete));
            
            const modal = document.getElementById('deleteCompanyModal');
            const textEl = document.getElementById('deleteCompanyText');
            
            if (textEl) {
                textEl.textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é "${companyName}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–æ.`;
            }
            
            if (modal) {
                modal.classList.add('show');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º inline —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.zIndex = '10001';
                modal.style.pointerEvents = 'auto';
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.showDeleteConfirm = showDeleteConfirm;

        // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
        async function archiveCompany() {
            console.log('archiveCompany called, companyToDelete:', companyToDelete);
            if (!companyToDelete) {
                console.error('companyToDelete is null, cannot archive');
                return;
            }

            const { id: companyId, name: companyName } = companyToDelete;
            console.log('Archiving company:', { id: companyId, name: companyName });

            try {
                const url = `/api/companies/${encodeURIComponent(companyId)}/archive`;
                console.log('Sending POST request to:', url);
                console.log('Company ID:', companyId);
                console.log('Company ID encoded:', encodeURIComponent(companyId));
                
                const response = await fetch(url, {
                    method: 'POST'
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ OK, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å JSON —Å –æ—à–∏–±–∫–æ–π
                    let errorData;
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        try {
                            errorData = await response.json();
                            console.error('Error response data:', errorData);
                        } catch (jsonError) {
                            console.error('Failed to parse error response as JSON:', jsonError);
                            errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
                        }
                    } else {
                        const text = await response.text();
                        console.error('Server returned non-JSON response:', text.substring(0, 200));
                        errorData = { error: `HTTP ${response.status}: ${response.statusText}`, message: text.substring(0, 100) };
                    }
                    
                    console.error('Archive failed:', errorData.error || errorData.message || 'Unknown error');
                    const errorMessage = errorData.message || errorData.error || `–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (HTTP ${response.status})`;
                    showMessage(errorMessage, 'error');
                    cancelDeleteOrArchive();
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON:', text.substring(0, 200));
                    showMessage('–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è: —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞', 'error');
                    cancelDeleteOrArchive();
                    return;
                }

                const result = await response.json();
                console.log('Response result:', result);

                if (result.ok) {
                    showMessage('–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ –∞—Ä—Ö–∏–≤', 'success');
                    cancelDeleteOrArchive();
                    loadCompanies();
                } else {
                    console.error('Archive failed:', result.error);
                    showMessage(result.error || result.message || '–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                    cancelDeleteOrArchive();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', error);
                console.error('Error type:', error.constructor.name);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                showMessage('–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                cancelDeleteOrArchive();
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.archiveCompany = archiveCompany;

        // –ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏–≤
        async function showArchive() {
            const companiesContainer = document.getElementById('companiesContainer');
            const archiveContainer = document.getElementById('archiveContainer');
            const pageTitle = document.getElementById('pageTitle');
            const companiesBottomBtn = document.getElementById('companiesBottomBtn');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π
            if (companiesContainer) {
                companiesContainer.classList.add('hide');
                setTimeout(() => {
                    companiesContainer.style.display = 'none';
                    companiesContainer.classList.remove('hide');
                }, 500);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∞—Ä—Ö–∏–≤–∞
            if (archiveContainer) {
                archiveContainer.style.display = 'block';
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    archiveContainer.classList.add('show');
                }, 50);
            }
            
            if (pageTitle) pageTitle.textContent = '–ê—Ä—Ö–∏–≤ –∫–æ–º–ø–∞–Ω–∏–π';
            // –ö–Ω–æ–ø–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞
            if (companiesBottomBtn) {
                const isMobile = window.innerWidth <= 1024;
                companiesBottomBtn.style.display = 'flex';
                companiesBottomBtn.style.visibility = 'visible';
                companiesBottomBtn.style.opacity = '1';
                companiesBottomBtn.style.transform = 'scale(1)';
                companiesBottomBtn.classList.add('show');
            }
            
            await loadArchivedCompanies();
        }

        // –°–∫—Ä—ã—Ç—å –∞—Ä—Ö–∏–≤
        function hideArchive() {
            const companiesContainer = document.getElementById('companiesContainer');
            const archiveContainer = document.getElementById('archiveContainer');
            const pageTitle = document.getElementById('pageTitle');
            const companiesBottomBtn = document.getElementById('companiesBottomBtn');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –∞—Ä—Ö–∏–≤–∞ (—É–µ–∑–∂–∞–µ—Ç –≤–Ω–∏–∑)
            if (archiveContainer) {
                archiveContainer.classList.remove('show');
                archiveContainer.classList.add('hide');
                setTimeout(() => {
                    archiveContainer.style.display = 'none';
                    archiveContainer.classList.remove('hide');
                }, 500);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π (–ø—Ä–∏–µ–∑–∂–∞–µ—Ç —Å–≤–µ—Ä—Ö—É)
            if (companiesContainer) {
                companiesContainer.style.display = 'block';
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–≤–µ—Ä—Ö—É)
                companiesContainer.classList.remove('show', 'hide');
                companiesContainer.classList.add('slide-from-top');
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    companiesContainer.classList.remove('slide-from-top');
                    companiesContainer.classList.add('show');
                }, 50);
            }
            
            if (pageTitle) pageTitle.textContent = '–í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏';
            // –ö–Ω–æ–ø–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞, –Ω–µ —Å–∫—Ä—ã–≤–∞–µ–º –µ—ë
            if (companiesBottomBtn) {
                const isMobile = window.innerWidth <= 1024;
                companiesBottomBtn.style.display = 'flex';
                companiesBottomBtn.style.visibility = 'visible';
                companiesBottomBtn.style.opacity = '1';
                companiesBottomBtn.style.transform = 'scale(1)';
                companiesBottomBtn.classList.add('show');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
        async function loadArchivedCompanies() {
            try {
                const response = await fetch('/api/companies/archived');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON:', text.substring(0, 100));
                    renderArchivedCompanies([]);
                    return;
                }
                
                const result = await response.json();
                
                if (result.ok && result.companies) {
                    renderArchivedCompanies(result.companies);
                } else {
                    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π –∞—Ä—Ö–∏–≤
                    renderArchivedCompanies([]);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–∞:', error);
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π –∞—Ä—Ö–∏–≤
                renderArchivedCompanies([]);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
        function renderArchivedCompanies(companies) {
            const container = document.getElementById('archivedCompaniesContainer');
            if (!container) return;

            if (companies.length === 0) {
                container.innerHTML = `
                    <div class="archive-empty-state">
                        <div class="archive-empty-state-icon">üì¶</div>
                        <h3>–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</h3>
                        <p>–í –∞—Ä—Ö–∏–≤–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–ø–∞–Ω–∏–π.<br>–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = companies.map(company => {
                const safeCompanyId = company.id.replace(/"/g, '&quot;');
                const safeCompanyName = company.name.replace(/"/g, '&quot;');
                const safeCompanyIdForJs = company.id.replace(/'/g, "\\'");
                const archivedDate = company.archivedAt ? new Date(company.archivedAt).toLocaleDateString('ru-RU') : '';

                // –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
                const statisticsButtonHtml = `
                    <button class="statistics-company-btn" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}" data-tooltip="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏" draggable="false">
                        <span class="statistics-company-tooltip">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏</span>
                    </button>
                `;

                return `
                    <div class="company-card">
                        ${statisticsButtonHtml}
                        <div class="company-info">
                            ${company.logoData ? `<img src="${company.logoData}" alt="${safeCompanyName}" class="company-logo">` : ''}
                            <div class="company-details">
                                <h3>${safeCompanyName}</h3>
                                <p class="company-id">ID: ${company.id}</p>
                                ${archivedDate ? `<p class="archived-date">–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ: ${archivedDate}</p>` : ''}
                            </div>
                        </div>
                        <div class="company-actions">
                            <button class="btn btn-primary btn-restore-company" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}">
                                –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button class="btn btn-danger btn-delete-archived" data-company-id="${safeCompanyId}" data-company-name="${safeCompanyName}">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            container.querySelectorAll('.btn-restore-company').forEach((btn, index) => {
                console.log(`Setting up restore handler for archived company button ${index}:`, {
                    companyId: btn.getAttribute('data-company-id'),
                    companyName: btn.getAttribute('data-company-name'),
                    element: btn
                });
                
                btn.addEventListener('click', (e) => {
                    console.log('Restore archived company button clicked!', e);
                    e.stopPropagation();
                    e.preventDefault();
                    const companyId = btn.getAttribute('data-company-id');
                    const companyName = btn.getAttribute('data-company-name');
                    console.log('Button clicked - companyId:', companyId, 'companyName:', companyName);
                    console.log('showRestoreConfirm function exists:', typeof showRestoreConfirm);
                    
                    if (typeof showRestoreConfirm === 'function') {
                        showRestoreConfirm(companyId, companyName);
                    } else if (typeof window.showRestoreConfirm === 'function') {
                        console.log('Calling window.showRestoreConfirm');
                        window.showRestoreConfirm(companyId, companyName);
                    } else {
                        console.error('showRestoreConfirm is not a function!');
                        showMessage('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    }
                });
                
                btn.style.cursor = 'pointer';
                console.log(`Restore handler attached to button ${index}`);
            });

            container.querySelectorAll('.btn-delete-archived').forEach((btn, index) => {
                console.log(`Setting up delete handler for archived company button ${index}:`, {
                    companyId: btn.getAttribute('data-company-id'),
                    companyName: btn.getAttribute('data-company-name'),
                    element: btn
                });
                
                btn.addEventListener('click', (e) => {
                    console.log('Delete archived company button clicked!', e);
                    e.stopPropagation();
                    e.preventDefault();
                    const companyId = btn.getAttribute('data-company-id');
                    const companyName = btn.getAttribute('data-company-name');
                    console.log('Button clicked - companyId:', companyId, 'companyName:', companyName);
                    console.log('deleteArchivedCompany function exists:', typeof deleteArchivedCompany);
                    
                    if (typeof deleteArchivedCompany === 'function') {
                        deleteArchivedCompany(companyId, companyName);
                    } else {
                        console.error('deleteArchivedCompany is not a function!', typeof deleteArchivedCompany);
                        // –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å —á–µ—Ä–µ–∑ window
                        if (typeof window.deleteArchivedCompany === 'function') {
                            console.log('Calling window.deleteArchivedCompany');
                            window.deleteArchivedCompany(companyId, companyName);
                        } else {
                            console.error('window.deleteArchivedCompany is also not a function!');
                            showMessage('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        }
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω–¥–∏–∫–∞—Ü–∏—é, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                btn.style.cursor = 'pointer';
                console.log(`Delete handler attached to button ${index}`);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä—è–º—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
            container.querySelectorAll('.statistics-company-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    const companyId = this.getAttribute('data-company-id');
                    const companyName = this.getAttribute('data-company-name');
                    // console.log('Archived statistics direct handler:', companyId, companyName);
                    if (companyId) {
                        showCompanyStatistics(companyId, companyName || '');
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—ã—à–µ
            // –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ–º setupCompanyButtons –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            setupCompanyButtons();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
        let currentRestoreCompanyId = null;
        let currentRestoreCompanyName = null;

        function showRestoreConfirm(companyId, companyName) {
            currentRestoreCompanyId = companyId;
            currentRestoreCompanyName = companyName;
            const modal = document.getElementById('restoreCompanyModal');
            const textElement = document.getElementById('restoreCompanyText');
            if (textElement) {
                textElement.textContent = `‚ö†Ô∏è –í—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –≥—Ä–∞—Ñ–∏–∫ –∏–∑ –∞—Ä—Ö–∏–≤–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏ "${companyName}". –í—ã —É–≤–µ—Ä–µ–Ω—ã?`;
                textElement.style.color = '#2196f3';
            }
            if (modal) {
                modal.classList.add('show');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º inline —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.zIndex = '10001';
                modal.style.pointerEvents = 'auto';
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.showRestoreConfirm = showRestoreConfirm;

        function cancelRestoreCompany() {
            const modal = document.getElementById('restoreCompanyModal');
            if (modal) {
                modal.classList.remove('show');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º inline —Å—Ç–∏–ª–∏
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                modal.style.pointerEvents = 'none';
            }
            currentRestoreCompanyId = null;
            currentRestoreCompanyName = null;
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.cancelRestoreCompany = cancelRestoreCompany;

        async function confirmRestoreCompany() {
            if (!currentRestoreCompanyId) {
                return;
            }

            const companyId = currentRestoreCompanyId;
            const companyName = currentRestoreCompanyName;

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            cancelRestoreCompany();

            // –í—ã–ø–æ–ª–Ω—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
            await restoreCompany(companyId, companyName);
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é –∏–∑ –∞—Ä—Ö–∏–≤–∞
        async function restoreCompany(companyId, companyName) {
            console.log('restoreCompany called with:', companyId, companyName);
            
            try {
                const url = `/api/companies/${encodeURIComponent(companyId)}/restore`;
                console.log('Sending POST request to:', url);
                console.log('Company ID:', companyId);
                console.log('Company ID encoded:', encodeURIComponent(companyId));
                
                const response = await fetch(url, {
                    method: 'POST'
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ OK, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å JSON —Å –æ—à–∏–±–∫–æ–π
                    let errorData;
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        try {
                            errorData = await response.json();
                            console.error('Error response data:', errorData);
                        } catch (jsonError) {
                            console.error('Failed to parse error response as JSON:', jsonError);
                            errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
                        }
                    } else {
                        const text = await response.text();
                        console.error('Server returned non-JSON response:', text.substring(0, 200));
                        errorData = { error: `HTTP ${response.status}: ${response.statusText}`, message: text.substring(0, 100) };
                    }
                    
                    console.error('Restore failed:', errorData.error || errorData.message || 'Unknown error');
                    const errorMessage = errorData.message || errorData.error || `–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (HTTP ${response.status})`;
                    showMessage(errorMessage, 'error');
                    return;
                }

                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON:', text.substring(0, 200));
                    showMessage('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞', 'error');
                    return;
                }

                const result = await response.json();
                console.log('Response result:', result);

                if (result.ok) {
                    showMessage('–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                    await loadArchivedCompanies();
                    loadCompanies(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫
                } else {
                    console.error('Restore failed:', result.error);
                    showMessage(result.error || result.message || '–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', error);
                console.error('Error type:', error.constructor.name);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                showMessage('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.restoreCompany = restoreCompany;

        // –£–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é –∏–∑ –∞—Ä—Ö–∏–≤–∞
        function deleteArchivedCompany(companyId, companyName) {
            console.log('deleteArchivedCompany called with:', companyId, companyName);
            companyToDelete = { id: companyId, name: companyName };
            console.log('deleteArchivedCompany: companyToDelete set to:', companyToDelete);
            
            const modal = document.getElementById('deleteCompanyModal');
            const textEl = document.getElementById('deleteCompanyText');
            
            if (!modal) {
                console.error('deleteCompanyModal not found!');
                return;
            }
            
            if (textEl) {
                textEl.textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é "${companyName}" –∏–∑ –∞—Ä—Ö–∏–≤–∞?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–æ.`;
            }
            
            console.log('Opening deleteCompanyModal for archived company');
            modal.classList.add('show');
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º inline —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.zIndex = '10001';
            modal.style.pointerEvents = 'auto';
            console.log('Modal opened successfully');
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.deleteCompany = deleteCompany;
        window.deleteArchivedCompany = deleteArchivedCompany;

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        function cancelDeleteCompany() {
            console.log('cancelDeleteCompany called, companyToDelete before reset:', companyToDelete);
            const modal = document.getElementById('deleteCompanyModal');
            if (modal) {
                modal.classList.remove('show');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º inline —Å—Ç–∏–ª–∏
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                modal.style.pointerEvents = 'none';
            }
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º companyToDelete —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ (–Ω–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏)
            // –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏ companyToDelete –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω –≤ confirmDeleteCompany
            companyToDelete = null;
            console.log('cancelDeleteCompany: companyToDelete reset to null');
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        async function confirmDeleteCompany() {
            console.log('confirmDeleteCompany called, companyToDelete:', companyToDelete);
            console.log('confirmDeleteCompany: typeof companyToDelete:', typeof companyToDelete);
            console.log('confirmDeleteCompany: companyToDelete value:', JSON.stringify(companyToDelete));
            
            if (!companyToDelete) {
                console.error('companyToDelete is null, cannot delete');
                console.error('Stack trace:', new Error().stack);
                showMessage('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É.', 'error');
                cancelDeleteCompany();
                return;
            }

            const companyId = companyToDelete.id;
            const companyName = companyToDelete.name || companyToDelete.id || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è';
            
            console.log('Deleting company:', { id: companyId, name: companyName });
            
            if (!companyId) {
                console.error('companyId is missing');
                showMessage('–û—à–∏–±–∫–∞: ID –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                cancelDeleteCompany();
                return;
            }

            try {
                const url = `/api/companies/${encodeURIComponent(companyId)}`;
                console.log('Sending DELETE request to:', url);
                console.log('Company ID:', companyId);
                console.log('Company ID encoded:', encodeURIComponent(companyId));
                
                const response = await fetch(url, {
                    method: 'DELETE'
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ OK, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å JSON —Å –æ—à–∏–±–∫–æ–π
                    let errorData;
                    try {
                        errorData = await response.json();
                        console.error('Error response data:', errorData);
                    } catch (jsonError) {
                        console.error('Failed to parse error response as JSON:', jsonError);
                        errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
                    }
                    
                    console.error('Delete failed:', errorData.error || errorData.message || 'Unknown error');
                    const errorMessage = errorData.message || errorData.error || `–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (HTTP ${response.status})`;
                    showMessage(errorMessage, 'error');
                    cancelDeleteCompany();
                    return;
                }

                const result = await response.json();
                console.log('Response result:', result);

                if (result.ok) {
                    showMessage('–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞', 'success');
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º companyToDelete –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
                    const deletedCompanyId = companyToDelete.id;
                    companyToDelete = null;
                    console.log('Company deleted successfully:', deletedCompanyId);
                    cancelDeleteCompany();
                    // –ï—Å–ª–∏ –º—ã –≤ –∞—Ä—Ö–∏–≤–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –∞—Ä—Ö–∏–≤, –∏–Ω–∞—á–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
                    const archiveContainer = document.getElementById('archiveContainer');
                    if (archiveContainer && archiveContainer.style.display !== 'none') {
                        await loadArchivedCompanies();
                    } else {
                        loadCompanies();
                    }
                } else {
                    console.error('Delete failed:', result.error);
                    showMessage(result.error || result.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                    cancelDeleteCompany();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', error);
                console.error('Error type:', error.constructor.name);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                cancelDeleteCompany();
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.confirmDeleteCompany = confirmDeleteCompany;

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
        function openCreateModal(event) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            updateChartTypeSelects();
            if (!isAdmin) {
                showMessage('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                return false;
            }
            const modal = document.getElementById('createModal');
            if (!modal) {
                console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                return false;
            }
            const modalContent = modal.querySelector('.modal-content');
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.classList.add('show');
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.pointerEvents = 'auto';
            modal.style.zIndex = '10000';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫ –Ω–∞—á–∞–ª—É
            modal.scrollTop = 0;
            if (modalContent) {
                modalContent.scrollTop = 0;
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
            setTimeout(() => {
                modal.scrollTop = 0;
                if (modalContent) {
                    modalContent.scrollTop = 0;
                }
            }, 50);
            
            document.getElementById('createForm').reset();
            document.getElementById('createMessage').classList.remove('show');
            document.getElementById('logoPreview').style.display = 'none';
            document.getElementById('logoPreviewImg').src = '';
            
            return false;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function compressImage(file, maxWidth = 800, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64 —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º
                        const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressedDataUrl);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ—Ç–∏–ø–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
        document.getElementById('companyLogo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('logoPreview');
            const previewImg = document.getElementById('logoPreviewImg');
            
            if (file) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                if (!file.type.match('image.*')) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                    e.target.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (2MB)
                if (file.size > 2 * 1024 * 1024) {
                    alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 2MB');
                    e.target.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        });

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è
        function closeCreateModal() {
            document.getElementById('createModal').classList.remove('show');
        }

        // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
        document.getElementById('createForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const companyId = document.getElementById('companyId').value.trim();
            const companyName = document.getElementById('companyName').value.trim();
            const objectName = document.getElementById('companyObjectName') ? document.getElementById('companyObjectName').value.trim() : '';
            const chartType = document.getElementById('companyChartType').value;
            const logoFile = document.getElementById('companyLogo').files[0];
            const messageEl = document.getElementById('createMessage');

            if (!companyId || !companyName || !chartType) {
                messageEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                messageEl.className = 'message error show';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ ID
            if (!/^[a-zA-Z0-9_-]+$/.test(companyId)) {
                messageEl.textContent = 'ID –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è';
                messageEl.className = 'message error show';
                return;
            }

            try {
                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userStr = localStorage.getItem('gantt-user');
                let userName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                if (userStr) {
                    try {
                        const user = JSON.parse(userStr);
                        userName = user.name || user.login || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    } catch (e) {
                        console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    }
                }
                
                // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –∫–æ–º–ø–∞–Ω–∏—é
                // –£–±–∏—Ä–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ X-User-Name, —Ç–∞–∫ –∫–∞–∫ userName –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
                // –ó–∞–≥–æ–ª–æ–≤–∫–∏ HTTP –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ ASCII —Å–∏–º–≤–æ–ª—ã, –∞ userName –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü—É
                const response = await fetch('/api/companies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: companyId,
                        name: companyName,
                        userName: userName
                    })
                });

                const result = await response.json();

                if (!result.ok) {
                    messageEl.textContent = result.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏';
                    messageEl.className = 'message error show';
                    return;
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –ª–æ–≥–æ—Ç–∏–ø)
                let logoData = null;
                if (logoFile) {
                    // –°–∂–∏–º–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                    logoData = await compressImage(logoFile);
                }
                
                // –ü–æ–ª—É—á–∞–µ–º containerName –∏–∑ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞
                let containerName = null;
                try {
                    const chartTypesResponse = await fetch('/api/chart-types');
                    if (chartTypesResponse.ok) {
                        const chartTypes = await chartTypesResponse.json();
                        const chartTypeInfo = chartTypes.find(ct => ct.id === chartType);
                        if (chartTypeInfo) {
                            containerName = chartTypeInfo.containerName;
                        } else {
                            // Fallback –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
                            containerName = chartType === 'icona' ? 'Icona' : (chartType === 'praktis' ? 'Praktis ID' : null);
                        }
                    }
                } catch (err) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è containerName:', err);
                    // Fallback –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
                    containerName = chartType === 'icona' ? 'Icona' : (chartType === 'praktis' ? 'Praktis ID' : null);
                }
                
                try {
                    const infoResponse = await fetch(`/api/company-info?company=${companyId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: companyName,
                            objectName: objectName || null,
                            logoData: logoData,
                            chartType: chartType,
                            containerName: containerName
                        })
                    });
                    if (!infoResponse.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏–∏');
                    }
                } catch (err) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏:', err);
                    messageEl.textContent = '–ö–æ–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é';
                    messageEl.className = 'message error show';
                    setTimeout(() => {
                        closeCreateModal();
                        loadCompanies();
                    }, 2000);
                    return;
                }

                messageEl.textContent = '–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞';
                messageEl.className = 'message success show';
                setTimeout(() => {
                    closeCreateModal();
                    loadCompanies();
                }, 1000);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', error);
                messageEl.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É';
                messageEl.className = 'message error show';
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.getElementById('createModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateModal();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.getElementById('editCompanyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.getElementById('deleteCompanyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                console.log('Click outside deleteCompanyModal, companyToDelete before cancel:', companyToDelete);
                cancelDeleteCompany();
            }
        });

        document.getElementById('deleteOrArchiveModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelDeleteOrArchive();
            }
        });



        // ========== –°–í–ï–¢–õ–Ø–ß–ö–ò ==========
        let fireflyAnimationIds = [];
        const fireflies = [];
        let mouseX = 0;
        let mouseY = 0;
        let isDragging = false; // –§–ª–∞–≥ –¥–ª—è –ø–∞—É–∑—ã –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–≤–µ—Ç–ª—è—á–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è drag and drop
        let wasDragStarted = false; // –§–ª–∞–≥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±—ã–ª –ª–∏ drag (–¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–ª–∏–∫–∞ –∏ drag)

        function initFireflies() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–≤–µ—Ç–ª—è—á–∫–æ–≤
            for (let i = 1; i <= 12; i++) {
                const firefly = document.getElementById(`companies-firefly-${i}`);
                if (!firefly) continue;

                const fireflyData = {
                    element: firefly,
                    x: 0,
                    y: 0,
                    vx: 0,
                    vy: 0,
                    id: i
                };

                // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è - —Å–ª—É—á–∞–π–Ω–∞—è –≤–Ω—É—Ç—Ä–∏ —ç–∫—Ä–∞–Ω–∞
                fireflyData.x = Math.random() * (window.innerWidth - 20) + 10;
                fireflyData.y = Math.random() * (window.innerHeight - 20) + 10;
                
                // –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (—Ä–∞–∑–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ)
                fireflyData.vx = (Math.random() - 0.5) * 2;
                fireflyData.vy = (Math.random() - 0.5) * 2;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ transform3d –¥–ª—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è
                fireflyData.element.style.transform = `translate3d(${fireflyData.x}px, ${fireflyData.y}px, 0)`;

                fireflies.push(fireflyData);
            }

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ –¥–ª—è —Å–≤–µ—Ç–ª—è—á–∫–æ–≤ —Å throttling
            let lastMouseUpdate = 0;
            const mouseUpdateThrottle = 50; // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 50ms
            
            function updateMousePosition(clientX, clientY) {
                const now = Date.now();
                if (now - lastMouseUpdate >= mouseUpdateThrottle) {
                    mouseX = clientX;
                    mouseY = clientY;
                    lastMouseUpdate = now;
                }
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –¥–ª—è —Å–≤–µ—Ç–ª—è—á–∫–æ–≤ —Å throttling
            document.addEventListener('mousemove', function(e) {
                updateMousePosition(e.clientX, e.clientY);
            }, { passive: true });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ touch —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–≤–µ—Ç–ª—è—á–∫–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 0) {
                    updateMousePosition(e.touches[0].clientX, e.touches[0].clientY);
                }
            }, { passive: true });

            document.addEventListener('touchmove', function(e) {
                if (e.touches.length > 0) {
                    updateMousePosition(e.touches[0].clientX, e.touches[0].clientY);
                }
            }, { passive: true });

            // –ü–∞—É–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –≤–∏–¥–Ω–∞
            let isPageVisible = true;
            document.addEventListener('visibilitychange', () => {
                isPageVisible = !document.hidden;
            });

            function animateFireflies() {
                if (fireflies.length === 0) {
                    fireflyAnimationIds.forEach(id => cancelAnimationFrame(id));
                    fireflyAnimationIds = [];
                    return;
                }

                // –ü–∞—É–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏, –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –≤–∏–¥–Ω–∞ –∏–ª–∏ –∏–¥–µ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                if (!isPageVisible || isDragging) {
                    const animationId = requestAnimationFrame(animateFireflies);
                    fireflyAnimationIds = [animationId];
                    return;
                }

                const fireflySize = 8;
                const speed = 1.5;
                const bounceDamping = 0.8;
                const escapeSpeed = 3;
                const escapeRadius = 100;

                fireflies.forEach(firefly => {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ –∫—É—Ä—Å–æ—Ä–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ - –∏–∑–±–µ–≥–∞–µ–º sqrt)
                    const dx = mouseX - firefly.x;
                    const dy = mouseY - firefly.y;
                    const distanceSquared = dx * dx + dy * dy;
                    const escapeRadiusSquared = escapeRadius * escapeRadius;
                    const isMouseNear = distanceSquared < escapeRadiusSquared;

                    // –£–±–µ–≥–∞–Ω–∏–µ –æ—Ç –∫—É—Ä—Å–æ—Ä–∞
                    if (isMouseNear) {
                        const dist = Math.sqrt(distanceSquared);
                        if (dist > 0) {
                            firefly.vx = (dx / dist) * escapeSpeed;
                            firefly.vy = (dy / dist) * escapeSpeed;
                        }
                    } else {
                        // –û–±—ã—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —Å –Ω–µ–±–æ–ª—å—à–∏–º —Å–ª—É—á–∞–π–Ω—ã–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º (—Ä–µ–∂–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
                        if (Math.random() > 0.7) { // –¢–æ–ª—å–∫–æ –≤ 30% —Å–ª—É—á–∞–µ–≤
                            firefly.vx += (Math.random() - 0.5) * 0.1;
                            firefly.vy += (Math.random() - 0.5) * 0.1;
                        }
                        
                        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
                        const speedSquared = firefly.vx * firefly.vx + firefly.vy * firefly.vy;
                        const maxSpeed = 3;
                        if (speedSquared > maxSpeed * maxSpeed) {
                            const currentSpeed = Math.sqrt(speedSquared);
                            firefly.vx = (firefly.vx / currentSpeed) * maxSpeed;
                            firefly.vy = (firefly.vy / currentSpeed) * maxSpeed;
                        }
                    }

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                    firefly.x += firefly.vx * speed;
                    firefly.y += firefly.vy * speed;

                    // –û—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω
                    if (firefly.x <= fireflySize) {
                        firefly.x = fireflySize;
                        firefly.vx = Math.abs(firefly.vx) * bounceDamping;
                    } else if (firefly.x >= window.innerWidth - fireflySize) {
                        firefly.x = window.innerWidth - fireflySize;
                        firefly.vx = -Math.abs(firefly.vx) * bounceDamping;
                    }

                    if (firefly.y <= fireflySize) {
                        firefly.y = fireflySize;
                        firefly.vy = Math.abs(firefly.vy) * bounceDamping;
                    } else if (firefly.y >= window.innerHeight - fireflySize) {
                        firefly.y = window.innerHeight - fireflySize;
                        firefly.vy = -Math.abs(firefly.vy) * bounceDamping;
                    }

                    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ transform –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    if (firefly.element) {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º will-change –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ CSS)
                        firefly.element.style.transform = `translate3d(${firefly.x}px, ${firefly.y}px, 0)`;
                    }
                });

                const animationId = requestAnimationFrame(animateFireflies);
                fireflyAnimationIds = [animationId];
            }

            // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            animateFireflies();
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        async function loadChartTypes() {
            try {
                const response = await fetch('/api/chart-types');
                if (response.ok) {
                    window.chartTypesList = await response.json() || [];
                    updateChartTypeSelects();
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤');
                    window.chartTypesList = [];
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤:', error);
                window.chartTypesList = [];
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function updateChartTypeSelects() {
            const createSelect = document.getElementById('companyChartType');
            const editSelect = document.getElementById('editCompanyChartType');
            
            const chartTypes = window.chartTypesList || [];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
            if (createSelect) {
                createSelect.innerHTML = chartTypes.map(ct => 
                    `<option value="${ct.id}">${ct.chartTypeName}</option>`
                ).join('');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
            if (editSelect) {
                const currentValue = editSelect.value;
                editSelect.innerHTML = chartTypes.map(ct => 
                    `<option value="${ct.id}">${ct.chartTypeName}</option>`
                ).join('');
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
                if (currentValue) {
                    editSelect.value = currentValue;
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

        // –§—É–Ω–∫—Ü–∏—è setupTooltips —É–¥–∞–ª–µ–Ω–∞ - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π CSS –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫

        // ========== –°–ò–°–¢–ï–ú–ê –ü–û–î–°–ö–ê–ó–û–ö –î–õ–Ø –ü–ï–†–í–û–ì–û –í–•–û–î–ê ==========
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function isFirstLogin() {
            const userStr = localStorage.getItem('gantt-user');
            if (!userStr) return false;
            
            try {
                const user = JSON.parse(userStr);
                const login = user.login || user.Login;
                if (!login) return false;
                
                const firstLoginKey = `firstLogin-companies-${login}`;
                const hasLoggedIn = localStorage.getItem(firstLoginKey);
                
                // –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–¥–µ—Å—å - —É—Å—Ç–∞–Ω–æ–≤–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –ø–µ—Ä–≤–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏
                return !hasLoggedIn;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞:', e);
                return false;
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –ø–µ—Ä–≤–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏)
        function setFirstLoginFlag() {
            const userStr = localStorage.getItem('gantt-user');
            if (!userStr) return;
            
            try {
                const user = JSON.parse(userStr);
                const login = user.login || user.Login;
                if (!login) return;
                
                const firstLoginKey = `firstLogin-companies-${login}`;
                localStorage.setItem(firstLoginKey, 'true');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞:', e);
            }
        }

        // –®–∞–≥–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
        const firstVisitSteps = [
            {
                element: '#profileBtn',
                text: '–î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞–∂–º–∏—Ç–µ —Å—é–¥–∞',
                position: 'left'
            },
            {
                element: '#logoutBtn',
                text: '–î–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∂–º—ë–º —Å—é–¥–∞',
                position: 'left'
            },
            {
                element: '#companiesBottomBtn',
                text: '–ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É –∫–æ–º–ø–∞–Ω–∏–π –∏–∑ –∞—Ä—Ö–∏–≤–∞',
                position: 'left'
            },
            {
                element: '.company-card',
                text: '–ß—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –≥—Ä–∞—Ñ–∏–∫ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–ª–∏—Ç–∫—É –∏–ª–∏ "–û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫"',
                position: 'bottom',
                selector: 'first'
            },
            {
                element: '.btn-copy-link',
                text: '–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≥—Ä–∞—Ñ–∏–∫–æ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, —Ç–æ –æ–Ω —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞',
                position: 'top',
                selector: 'first'
            },
            {
                element: '.statistics-company-btn',
                text: '–≠—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ä–æ–∫–æ–≤ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è',
                position: 'right',
                selector: 'first'
            }
        ];

        let currentFirstVisitStep = 0;
        let firstVisitActive = false;

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
        function showFirstVisitStep(stepIndex) {
            if (stepIndex >= firstVisitSteps.length) {
                endFirstVisitTour();
                return;
            }

            const step = firstVisitSteps[stepIndex];
            console.log(`üìå –®–∞–≥ ${stepIndex + 1}/${firstVisitSteps.length}:`, step.element, step.text);
            let element = null;

            // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const isDynamicElement = step.element.includes('company-card') || step.element.includes('btn-') || step.element.includes('copy-link') || step.element.includes('statistics-company');
            
            if (isDynamicElement) {
                // –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∂–¥–µ–º –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏
                const maxAttempts = 10;
                let attempts = 0;
                const findElement = () => {
                    if (step.element.startsWith('.')) {
                        const elements = document.querySelectorAll(step.element);
                        if (step.selector === 'first') {
                            element = elements.length > 0 ? elements[0] : null;
                        } else {
                            element = elements.length > 0 ? elements[0] : null;
                        }
                    } else {
                        element = document.querySelector(step.element);
                    }
                    
                    if (!element && attempts < maxAttempts) {
                        attempts++;
                        setTimeout(findElement, 300);
                        return;
                    }
                    
                    if (!element) {
                        // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥
                        setTimeout(() => showFirstVisitStep(stepIndex + 1), 500);
                        return;
                    }
                    
                    showStepTooltip(stepIndex, step, element);
                };
                findElement();
                return;
            } else {
                // –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è, –≤—ã—Ö–æ–¥–∞)
                if (step.element.startsWith('.')) {
                    const elements = document.querySelectorAll(step.element);
                    element = elements.length > 0 ? elements[0] : null;
                } else {
                    element = document.querySelector(step.element);
                }

                if (!element) {
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥
                    console.log(`‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç ${step.element} –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥`);
                    setTimeout(() => showFirstVisitStep(stepIndex + 1), 500);
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞)
                const style = window.getComputedStyle(element);
                const isVisible = style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0';
                
                // –î–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë, –µ—Å–ª–∏ –æ–Ω–∞ —Å–∫—Ä—ã—Ç–∞
                if (step.element === '#companiesBottomBtn' && !isVisible) {
                    console.log('üëÅÔ∏è –í—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏');
                    element.style.display = 'flex';
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –ø–æ—Å–ª–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
                    element.dataset.originalDisplay = 'none';
                }
                
                if (!isVisible && step.element !== '#companiesBottomBtn') {
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å–∫—Ä—ã—Ç (–∏ —ç—Ç–æ –Ω–µ –∫–Ω–æ–ø–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥
                    console.log(`‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç ${step.element} —Å–∫—Ä—ã—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥`);
                    setTimeout(() => showFirstVisitStep(stepIndex + 1), 500);
                    return;
                }
                
                showStepTooltip(stepIndex, step, element);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        function showStepTooltip(stepIndex, step, element) {
            console.log(`‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è —à–∞–≥–∞ ${stepIndex + 1}:`, step.element, element);

            firstVisitActive = true;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –ø–µ—Ä–≤–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏
            // –î–µ–ª–∞–µ–º —ç—Ç–æ —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä–æ–µ—Ç —Ç—É—Ä, —Ñ–ª–∞–≥ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
            if (stepIndex === 0) {
                console.log('üèÅ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞');
                setFirstLoginFlag();
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
                const userStr = localStorage.getItem('gantt-user');
                if (userStr) {
                    try {
                        const user = JSON.parse(userStr);
                        const login = user.login || user.Login;
                        if (login) {
                            const firstLoginKey = `firstLogin-companies-${login}`;
                            const flag = localStorage.getItem(firstLoginKey);
                            console.log('‚úÖ –§–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', flag, '–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', login);
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞:', e);
                    }
                }
            }
            
            const tooltip = document.getElementById('firstVisitTooltip');
            const highlight = document.getElementById('firstVisitHighlight');
            const overlay = document.getElementById('firstVisitOverlay');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (!tooltip) {
                console.error('‚ùå Tooltip –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            const content = tooltip.querySelector('.tooltip-content');
            const nextBtn = tooltip.querySelector('.tooltip-next');
            
            if (!content || !nextBtn) {
                console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã tooltip –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!', { content: !!content, nextBtn: !!nextBtn });
                return;
            }

            console.log('üìù –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏:', step.text);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç
            content.textContent = step.text;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–∞–ª–µ–µ" –∏–ª–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
            if (stepIndex === firstVisitSteps.length - 1) {
                nextBtn.textContent = '–ó–∞–≤–µ—Ä—à–∏—Ç—å';
            } else {
                nextBtn.textContent = '–î–∞–ª–µ–µ';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
            if (overlay) {
                overlay.classList.add('show');
                console.log('üåë –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –ø–æ–∫–∞–∑–∞–Ω–æ');
            }

            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
            if (highlight && element) {
                const rect = element.getBoundingClientRect();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∏–º –∏ –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä—ã
                if (rect.width > 0 && rect.height > 0) {
                    highlight.style.left = (rect.left - 3) + 'px';
                    highlight.style.top = (rect.top - 3) + 'px';
                    highlight.style.width = (rect.width + 6) + 'px';
                    highlight.style.height = (rect.height + 6) + 'px';
                    highlight.style.display = 'block';
                    highlight.style.opacity = '1';
                    highlight.style.visibility = 'visible';
                    highlight.style.zIndex = '99999';
                    highlight.classList.add('active');
                    console.log('‚ú® Highlight –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω:', {
                        left: rect.left,
                        top: rect.top,
                        width: rect.width,
                        height: rect.height,
                        element: step.element
                    });
                } else {
                    console.warn('‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏–º–µ–µ—Ç –Ω—É–ª–µ–≤–æ–π —Ä–∞–∑–º–µ—Ä:', step.element, rect);
                }
            } else {
                console.warn('‚ö†Ô∏è Highlight –∏–ª–∏ element –Ω–µ –Ω–∞–π–¥–µ–Ω:', { highlight: !!highlight, element: !!element });
            }

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            const rect = element.getBoundingClientRect();
            const spacing = 15;
            
            // –í—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º tooltip –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
            tooltip.style.display = 'block';
            tooltip.style.visibility = 'visible';
            tooltip.style.opacity = '0';
            tooltip.style.left = '-9999px';
            tooltip.style.top = '-9999px';
            tooltip.classList.add('show');
            
            // –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∞–¥—Ä–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
            setTimeout(() => {
                const tooltipRect = tooltip.getBoundingClientRect();
                let tooltipLeft, tooltipTop;

                console.log('üìê –†–∞–∑–º–µ—Ä—ã tooltip:', tooltipRect.width, tooltipRect.height);
                console.log('üìê –ü–æ–∑–∏—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞:', rect);

                switch (step.position) {
                    case 'left':
                        tooltipLeft = rect.left - tooltipRect.width - spacing;
                        tooltipTop = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
                        break;
                    case 'right':
                        tooltipLeft = rect.right + spacing;
                        tooltipTop = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
                        break;
                    case 'top':
                        tooltipLeft = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                        tooltipTop = rect.top - tooltipRect.height - spacing;
                        break;
                    case 'bottom':
                    default:
                        tooltipLeft = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                        tooltipTop = rect.bottom + spacing;
                        break;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
                if (tooltipLeft < 10) tooltipLeft = 10;
                if (tooltipLeft + tooltipRect.width > window.innerWidth - 10) {
                    tooltipLeft = window.innerWidth - tooltipRect.width - 10;
                }
                if (tooltipTop < 10) tooltipTop = 10;
                if (tooltipTop + tooltipRect.height > window.innerHeight - 10) {
                    tooltipTop = window.innerHeight - tooltipRect.height - 10;
                }

                tooltip.style.left = tooltipLeft + 'px';
                tooltip.style.top = tooltipTop + 'px';
                tooltip.style.opacity = '1';
                tooltip.style.zIndex = '100000';
                tooltip.style.display = 'block';
                tooltip.style.visibility = 'visible';
                tooltip.classList.add('show');
                
                console.log('üìç Tooltip –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω:', tooltipLeft, tooltipTop);
                console.log('‚úÖ Tooltip –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω');
                console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ tooltip:', {
                    display: tooltip.style.display,
                    visibility: tooltip.style.visibility,
                    opacity: tooltip.style.opacity,
                    zIndex: tooltip.style.zIndex,
                    hasShow: tooltip.classList.contains('show'),
                    left: tooltip.style.left,
                    top: tooltip.style.top
                });

                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ –∑–æ–Ω—É –≤–∏–¥–∏–º–æ—Å—Ç–∏
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 50);
        }

        // –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
        function nextFirstVisitStep() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π —à–∞–≥ –ø–æ—Å–ª–µ–¥–Ω–∏–º
            if (currentFirstVisitStep >= firstVisitSteps.length - 1) {
                // –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç—É—Ä
                endFirstVisitTour();
                return;
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–∞
            const companiesBtn = document.getElementById('companiesBottomBtn');
            if (companiesBtn && companiesBtn.dataset.originalDisplay) {
                companiesBtn.style.display = companiesBtn.dataset.originalDisplay;
                delete companiesBtn.dataset.originalDisplay;
            }
            
            currentFirstVisitStep++;
            const tooltip = document.getElementById('firstVisitTooltip');
            const highlight = document.getElementById('firstVisitHighlight');
            const overlay = document.getElementById('firstVisitOverlay');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç—É—Ä–∞
            if (tooltip) {
                tooltip.classList.remove('show');
                tooltip.style.display = 'none';
                tooltip.style.opacity = '0';
                tooltip.style.visibility = 'hidden';
            }
            if (highlight) {
                highlight.classList.remove('active');
                highlight.style.display = 'none';
            }
            if (overlay) {
                overlay.classList.remove('show');
            }
            
            setTimeout(() => {
                showFirstVisitStep(currentFirstVisitStep);
            }, 300);
        }

        // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç—É—Ä
        function skipFirstVisitTour() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ —Ç—É—Ä–∞
            setFirstLoginFlag();
            endFirstVisitTour();
        }

        // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—É—Ä
        function endFirstVisitTour() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç—É—Ä–∞ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
            setFirstLoginFlag();
            
            firstVisitActive = false;
            currentFirstVisitStep = 0;
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–∞
            const companiesBtn = document.getElementById('companiesBottomBtn');
            if (companiesBtn && companiesBtn.dataset.originalDisplay) {
                companiesBtn.style.display = companiesBtn.dataset.originalDisplay;
                delete companiesBtn.dataset.originalDisplay;
            }
            
            const tooltip = document.getElementById('firstVisitTooltip');
            const highlight = document.getElementById('firstVisitHighlight');
            const overlay = document.getElementById('firstVisitOverlay');
            
            // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç—É—Ä–∞
            if (tooltip) {
                tooltip.classList.remove('show');
                tooltip.style.display = 'none';
                tooltip.style.opacity = '0';
                tooltip.style.visibility = 'hidden';
                tooltip.style.zIndex = '-1';
            }
            if (highlight) {
                highlight.classList.remove('active');
                highlight.style.display = 'none';
                highlight.style.opacity = '0';
                highlight.style.visibility = 'hidden';
                highlight.style.zIndex = '-1';
                highlight.style.boxShadow = 'none';
            }
            if (overlay) {
                overlay.classList.remove('show');
                overlay.style.opacity = '0';
                overlay.style.visibility = 'hidden';
            }
            
            console.log('‚úÖ –¢—É—Ä –∑–∞–≤–µ—Ä—à–µ–Ω, –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–∫—Ä—ã—Ç—ã');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥—Å–∫–∞–∑–æ–∫
        function initFirstVisitTour() {
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ —Ñ–ª–∞–≥ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä
            const userStr = localStorage.getItem('gantt-user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    const login = user.login || user.Login;
                    if (login) {
                        const firstLoginKey = `firstLogin-companies-${login}`;
                        const hasLoggedIn = localStorage.getItem(firstLoginKey);
                        if (hasLoggedIn === 'true') {
                            console.log('‚úÖ –§–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ç—É—Ä –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è');
                            return;
                        }
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–ª–∞–≥–∞:', e);
                }
            }
            
            const isFirst = isFirstLogin();
            
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞:', isFirst);
            console.log('üîç –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', localStorage.getItem('gantt-user'));
            
            if (isFirst) {
                console.log('‚úÖ –≠—Ç–æ –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏');
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–¥—Å–∫–∞–∑–æ–∫
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º
                let checkAttempts = 0;
                const maxCheckAttempts = 30; // –ú–∞–∫—Å–∏–º—É–º 9 —Å–µ–∫—É–Ω–¥ (30 * 300ms)
                
                const checkElements = () => {
                    checkAttempts++;
                    const profileBtn = document.getElementById('profileBtn');
                    const logoutBtn = document.getElementById('logoutBtn');
                    const companyCards = document.querySelectorAll('.company-card');
                    
                    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–ø–æ–ø—ã—Ç–∫–∞ ' + checkAttempts + '):', {
                        profileBtn: !!profileBtn,
                        logoutBtn: !!logoutBtn,
                        companyCards: companyCards.length
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∏ –≤—ã—Ö–æ–¥–∞)
                    // –î–ª—è –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö —à–∞–≥–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω—É–∂–Ω—ã
                    const basicElementsReady = profileBtn && logoutBtn;
                    
                    if (basicElementsReady) {
                        // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
                        console.log('‚úÖ –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ —á–µ—Ä–µ–∑ 500ms');
                        setTimeout(() => {
                            console.log('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —à–∞–≥ –ø–æ–¥—Å–∫–∞–∑–æ–∫');
                            showFirstVisitStep(0);
                        }, 500);
                    } else if (checkAttempts < maxCheckAttempts) {
                        // –≠–ª–µ–º–µ–Ω—Ç—ã –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ
                        setTimeout(checkElements, 300);
                    } else {
                        console.warn('‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫, –Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏');
                        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–∞–∂–µ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        setTimeout(() => {
                            showFirstVisitStep(0);
                        }, 500);
                    }
                };
                
                // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
                setTimeout(checkElements, 500);
            } else {
                console.log('‚ùå –≠—Ç–æ –Ω–µ –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥, –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–ª–∞–≥–∞ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        window.resetFirstLoginCompanies = function() {
            const userStr = localStorage.getItem('gantt-user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    const login = user.login || user.Login;
                    if (login) {
                        const firstLoginKey = `firstLogin-companies-${login}`;
                        localStorage.removeItem(firstLoginKey);
                        console.log('‚úÖ –§–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ —Å–±—Ä–æ—à–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', login);
                        console.log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏');
                        return true;
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ —Ñ–ª–∞–≥–∞ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞:', e);
                }
            }
            return false;
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        window.forceShowFirstVisitTour = function() {
            console.log('üöÄ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫');
            currentFirstVisitStep = 0;
            firstVisitActive = false;
            showFirstVisitStep(0);
        };

        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fade-out –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ (–¥–æ DOMContentLoaded)
        (function() {
            function removeDarkening() {
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fade-out
                const container = document.querySelector('.container');
                if (container) {
                    container.classList.remove('fade-out');
                }
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
                const modals = document.querySelectorAll('.modal, .delete-modal, .profile-modal');
                modals.forEach(modal => {
                    modal.classList.remove('show');
                    modal.style.display = 'none';
                    modal.style.visibility = 'hidden';
                    modal.style.opacity = '0';
                    modal.style.zIndex = '-1';
                });
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Å—Ä–∞–∑—É
            removeDarkening();
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', removeDarkening);
            } else {
                removeDarkening();
            }
            
            // –¢–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ
            setTimeout(removeDarkening, 100);
            setTimeout(removeDarkening, 500);
        })();

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–û–§–ò–õ–Ø ==========
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ DOMContentLoaded, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        let isProfileModalDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let initialPosition = { x: 0, y: 0 };

        function initProfileModalDrag() {
            const modal = document.getElementById('profileModal');
            const modalContent = modal?.querySelector('.profile-modal-content');
            const modalHeader = modal?.querySelector('.profile-modal-header');
            
            if (!modalContent || !modalHeader) return;

            modalHeader.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('profile-modal-close')) {
                    return; // –ù–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
                }
                
                isProfileModalDragging = true;
                const rect = modalContent.getBoundingClientRect();
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –∫–ª–∏–∫–∞ –¥–æ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞ –æ–∫–Ω–∞
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –æ–∫–Ω–∞
                initialPosition.x = rect.left;
                initialPosition.y = rect.top;
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ fixed –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                modalContent.style.position = 'fixed';
                modalContent.style.left = rect.left + 'px';
                modalContent.style.top = rect.top + 'px';
                modalContent.style.margin = '0';
                modalContent.style.transition = 'none';
                
                e.preventDefault();
            });

            document.addEventListener('mousemove', function(e) {
                if (!isProfileModalDragging) return;
                
                const modalContent = document.querySelector('.profile-modal-content');
                if (!modalContent) return;

                // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é —Ç–∞–∫, —á—Ç–æ–±—ã —Ç–æ—á–∫–∞ –∫–ª–∏–∫–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                let newX = e.clientX - dragOffset.x;
                let newY = e.clientY - dragOffset.y;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                const maxX = window.innerWidth - modalContent.offsetWidth;
                const maxY = window.innerHeight - modalContent.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                modalContent.style.left = newX + 'px';
                modalContent.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', function() {
                if (isProfileModalDragging) {
                    isProfileModalDragging = false;
                    const modalContent = document.querySelector('.profile-modal-content');
                    if (modalContent) {
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º transition –¥–ª—è –ø–ª–∞–≤–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π
                        modalContent.style.transition = '';
                        // –û—Å—Ç–∞–≤–ª—è–µ–º position: fixed, —á—Ç–æ–±—ã –æ–∫–Ω–æ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ –º–µ—Å—Ç–µ
                    }
                }
            });
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        function openProfileModal() {
            console.log('üöÄ openProfileModal –≤—ã–∑–≤–∞–Ω–∞');
            const modal = document.getElementById('profileModal');
            const modalContent = modal?.querySelector('.profile-modal-content');
            const nameInput = document.getElementById('profileName');
            const loginInput = document.getElementById('profileLogin');
            
            console.log('üîç –ü–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', {
                modal: !!modal,
                modalElement: modal,
                modalContent: !!modalContent,
                nameInput: !!nameInput,
                loginInput: !!loginInput,
                currentUser: !!currentUser
            });
            
            // –ï—Å–ª–∏ currentUser –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ
            if (!currentUser) {
                console.log('üì• currentUser –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º...');
                loadCurrentUser();
            }
            
            if (!modal) {
                console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                return;
            }
            
            if (!nameInput || !loginInput) {
                console.error('‚ùå –ü–æ–ª—è —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            console.log('‚úÖ –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω
            if (currentUser) {
                nameInput.value = currentUser.name || '';
                loginInput.value = currentUser.login || '';
            } else {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ localStorage
                const userStr = localStorage.getItem('gantt-user');
                if (userStr) {
                    try {
                        const user = JSON.parse(userStr);
                        nameInput.value = user.name || '';
                        loginInput.value = user.login || '';
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    }
                }
            }
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –ø–∞—Ä–æ–ª–µ–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
            const passwordInput = document.getElementById('profilePassword');
            const passwordConfirmInput = document.getElementById('profilePasswordConfirm');
            const messageEl = document.getElementById('profileMessage');
            
            if (passwordInput) passwordInput.value = '';
            if (passwordConfirmInput) passwordConfirmInput.value = '';
            if (messageEl) {
                messageEl.classList.remove('show');
                messageEl.textContent = '';
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            if (modalContent) {
                modalContent.style.position = '';
                modalContent.style.left = '';
                modalContent.style.top = '';
                modalContent.style.margin = '';
                modalContent.style.transform = '';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            console.log('üëÅÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
            
            // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å show
            modal.classList.add('show');
            
            // –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ JavaScript —Å !important —á–µ—Ä–µ–∑ setProperty
            modal.style.setProperty('display', 'flex', 'important');
            modal.style.setProperty('visibility', 'visible', 'important');
            modal.style.setProperty('opacity', '1', 'important');
            modal.style.setProperty('pointer-events', 'auto', 'important');
            modal.style.setProperty('z-index', '10002', 'important');
            modal.style.setProperty('background-color', 'rgba(0, 0, 0, 0.5)', 'important');
            
            // –ü–æ–ª—É—á–∞–µ–º computed —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            const computedStyle = window.getComputedStyle(modal);
            const rect = modal.getBoundingClientRect();
            
            console.log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ:', {
                hasShowClass: modal.classList.contains('show'),
                inlineStyles: {
                    display: modal.style.display,
                    visibility: modal.style.visibility,
                    opacity: modal.style.opacity,
                    pointerEvents: modal.style.pointerEvents,
                    zIndex: modal.style.zIndex
                },
                computedStyles: {
                    display: computedStyle.display,
                    visibility: computedStyle.visibility,
                    opacity: computedStyle.opacity,
                    pointerEvents: computedStyle.pointerEvents,
                    zIndex: computedStyle.zIndex,
                    position: computedStyle.position,
                    width: computedStyle.width,
                    height: computedStyle.height
                },
                boundingRect: {
                    top: rect.top,
                    left: rect.left,
                    width: rect.width,
                    height: rect.height,
                    visible: rect.width > 0 && rect.height > 0
                },
                isInViewport: rect.top >= 0 && rect.left >= 0 && rect.width > 0 && rect.height > 0
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–æ –ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
            setTimeout(() => {
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const elementAtCenter = document.elementFromPoint(centerX, centerY);
                const computedStyleAfter = window.getComputedStyle(modal);
                const rectAfter = modal.getBoundingClientRect();
                
                console.log('üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 100ms –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è:', {
                    element: elementAtCenter,
                    isModal: elementAtCenter === modal || modal.contains(elementAtCenter),
                    elementTag: elementAtCenter?.tagName,
                    elementClass: elementAtCenter?.className,
                    elementId: elementAtCenter?.id,
                    modalStillOpen: modal.classList.contains('show'),
                    computedDisplay: computedStyleAfter.display,
                    computedVisibility: computedStyleAfter.visibility,
                    computedOpacity: computedStyleAfter.opacity,
                    computedZIndex: computedStyleAfter.zIndex,
                    boundingRect: {
                        top: rectAfter.top,
                        left: rectAfter.left,
                        width: rectAfter.width,
                        height: rectAfter.height,
                        visible: rectAfter.width > 0 && rectAfter.height > 0
                    }
                });
            }, 100);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 500ms - –Ω–µ –∑–∞–∫—Ä—ã–ª–æ—Å—å –ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            setTimeout(() => {
                const stillOpen = modal.classList.contains('show');
                const computedStyle = window.getComputedStyle(modal);
                console.log('‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 500ms –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è:', {
                    stillOpen: stillOpen,
                    computedDisplay: computedStyle.display,
                    computedVisibility: computedStyle.visibility,
                    computedOpacity: computedStyle.opacity,
                    hasShowClass: modal.classList.contains('show'),
                    inlineDisplay: modal.style.display,
                    inlineVisibility: modal.style.visibility
                });
                
                if (!stillOpen || computedStyle.display === 'none') {
                    console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –µ–≥–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å.');
                }
            }, 500);
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ —Å—Ä–∞–∑—É
        window.openProfileModal = openProfileModal;

        window.addEventListener('DOMContentLoaded', async function() {
            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fade-out –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–∞ —Å–ª—É—á–∞–π –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥)
            const container = document.querySelector('.container');
            if (container) {
                container.classList.remove('fade-out');
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
            console.log('üîÑ DOMContentLoaded: –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
            const modals = document.querySelectorAll('.modal, .delete-modal, .profile-modal');
            modals.forEach(modal => {
                if (modal.id === 'profileModal') {
                    console.log('üîÑ –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                }
                modal.classList.remove('show');
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const companiesContainer = document.getElementById('companiesContainer');
            const archiveContainer = document.getElementById('archiveContainer');
            
            if (companiesContainer) {
                companiesContainer.style.display = 'block';
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å show –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    companiesContainer.classList.add('show');
                }, 50);
            }
            
            if (archiveContainer) {
                archiveContainer.style.display = 'none';
                archiveContainer.classList.remove('show');
            }
            
            loadCurrentUser();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–π
            await loadChartTypes();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–ø–∞–Ω–∏–∏, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            const ganttMode = localStorage.getItem('gantt-mode') || 'edit';
            const isViewMode = ganttMode === 'view';
            
            if (currentUser || isViewMode) {
                loadCompanies();
            }
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setupCompanyButtons();
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            initFireflies();
            // –ü–æ–¥—Å–∫–∞–∑–∫–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–æ–π CSS, –±–µ–∑ JavaScript
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π
            function updateCompaniesButtonVisibility() {
                const companiesBottomBtn = document.getElementById('companiesBottomBtn');
                if (companiesBottomBtn) {
                    const isMobile = window.innerWidth <= 1024;
                    if (isMobile) {
                        companiesBottomBtn.style.display = 'flex';
                        companiesBottomBtn.style.visibility = 'visible';
                        companiesBottomBtn.style.opacity = '1';
                        companiesBottomBtn.style.transform = 'scale(1)';
                        companiesBottomBtn.classList.add('show');
                    }
                }
            }
            
            // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateCompaniesButtonVisibility();
            
            // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', updateCompaniesButtonVisibility);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
            const profileBtn = document.getElementById('profileBtn');
            console.log('üîç –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', {
                profileBtn: !!profileBtn,
                profileBtnElement: profileBtn,
                computedStyle: profileBtn ? window.getComputedStyle(profileBtn) : null
            });
            if (profileBtn) {
                console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞–π–¥–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞');
                profileBtn.addEventListener('click', function(e) {
                    console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø—Ä–æ—Ñ–∏–ª—è:', {
                        event: e,
                        target: e.target,
                        currentTarget: e.currentTarget,
                        button: profileBtn,
                        isProfileModalOpen: document.getElementById('profileModal')?.classList.contains('show')
                    });
                    e.preventDefault();
                    e.stopPropagation();
                    openProfileModal();
                });
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ñ–∏–ª—è');
            } else {
                console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
            
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', saveProfile);
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            initProfileModalDrag();

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                profileModal.addEventListener('click', function(e) {
                    if (e.target === profileModal && !isProfileModalDragging) {
                        closeProfileModal();
                    }
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ñ–∏–ª—è –µ—â–µ —Ä–∞–∑ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                const profileBtnCheck = document.getElementById('profileBtn');
                if (profileBtnCheck) {
                    const rect = profileBtnCheck.getBoundingClientRect();
                    const computedStyle = window.getComputedStyle(profileBtnCheck);
                    console.log('üîç –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', {
                        exists: !!profileBtnCheck,
                        visible: rect.width > 0 && rect.height > 0,
                        position: {
                            top: rect.top,
                            left: rect.left,
                            right: rect.right,
                            bottom: rect.bottom,
                            width: rect.width,
                            height: rect.height
                        },
                        styles: {
                            display: computedStyle.display,
                            visibility: computedStyle.visibility,
                            opacity: computedStyle.opacity,
                            pointerEvents: computedStyle.pointerEvents,
                            zIndex: computedStyle.zIndex,
                            position: computedStyle.position
                        },
                        hasClickHandler: profileBtnCheck.onclick !== null || profileBtnCheck.getAttribute('onclick') !== null
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞ –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
                    const elementAtPoint = document.elementFromPoint(rect.left + rect.width / 2, rect.top + rect.height / 2);
                    console.log('üéØ –≠–ª–µ–º–µ–Ω—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–Ω–æ–ø–∫–∏:', {
                        element: elementAtPoint,
                        isButton: elementAtPoint === profileBtnCheck,
                        elementTag: elementAtPoint?.tagName,
                        elementClass: elementAtPoint?.className
                    });
                }
            }, 500);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            setTimeout(() => {
                const themeBtn = document.getElementById('themeToggleBtn');
                const adminBtn = document.getElementById('adminPanelLink');
                const profileBtnForAnimation = document.getElementById('profileBtn');
                const logoutBtn = document.getElementById('logoutBtn');
                
                if (themeBtn) {
                    setTimeout(() => themeBtn.classList.add('show'), 100);
                }
                if (profileBtnForAnimation) {
                    setTimeout(() => {
                        profileBtnForAnimation.classList.add('show');
                        console.log('‚ú® –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—É—á–∏–ª–∞ –∫–ª–∞—Å—Å show:', {
                            hasShowClass: profileBtnForAnimation.classList.contains('show'),
                            computedStyle: {
                                display: window.getComputedStyle(profileBtnForAnimation).display,
                                visibility: window.getComputedStyle(profileBtnForAnimation).visibility,
                                opacity: window.getComputedStyle(profileBtnForAnimation).opacity,
                                pointerEvents: window.getComputedStyle(profileBtnForAnimation).pointerEvents,
                                zIndex: window.getComputedStyle(profileBtnForAnimation).zIndex,
                                position: window.getComputedStyle(profileBtnForAnimation).position,
                                top: window.getComputedStyle(profileBtnForAnimation).top,
                                right: window.getComputedStyle(profileBtnForAnimation).right
                            },
                            isClickable: profileBtnForAnimation.style.pointerEvents !== 'none'
                        });
                    }, 200);
                } else {
                    console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏');
                }
                if (adminBtn && adminBtn.style.display !== 'none') {
                    setTimeout(() => adminBtn.classList.add('show'), 200);
                }
                if (logoutBtn) {
                    setTimeout(() => logoutBtn.classList.add('show'), 250);
                }
            }, 100);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–¥—Å–∫–∞–∑–æ–∫
            setTimeout(() => {
                initFirstVisitTour();
            }, 2000);
        });

        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fade-out –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥ (–∫–Ω–æ–ø–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞)
        window.addEventListener('pageshow', function(event) {
            // event.persisted = true –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –∫—ç—à–∞ (back/forward)
            const container = document.querySelector('.container');
            if (container) {
                container.classList.remove('fade-out');
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥
            const modals = document.querySelectorAll('.modal, .delete-modal, .profile-modal');
            modals.forEach(modal => {
                modal.classList.remove('show');
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
            });
        });

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–û–§–ò–õ–Ø ==========
        // (–§—É–Ω–∫—Ü–∏—è openProfileModal —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤—ã—à–µ, –ø–µ—Ä–µ–¥ DOMContentLoaded)

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        function closeProfileModal() {
            console.log('üîí closeProfileModal –≤—ã–∑–≤–∞–Ω–∞', new Error().stack);
            const modal = document.getElementById('profileModal');
            if (modal) {
                console.log('üîí –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è');
                modal.classList.remove('show');
                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–∫—Ä—ã—Ç–æ
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.pointerEvents = 'none';
                modal.style.zIndex = '-1';
                console.log('üîí –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
            } else {
                console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏');
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.closeProfileModal = closeProfileModal;

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
        async function saveProfile(event) {
            event.preventDefault();

            const newLogin = document.getElementById('profileLogin').value.trim();
            const newPassword = document.getElementById('profilePassword').value;
            const confirmPassword = document.getElementById('profilePasswordConfirm').value;
            const messageEl = document.getElementById('profileMessage');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (–µ—Å–ª–∏ –≤–≤–æ–¥–∏—Ç—Å—è)
            if (newPassword || confirmPassword) {
                if (newPassword !== confirmPassword) {
                    messageEl.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                    messageEl.className = 'profile-message error show';
                    return;
                }
                if (newPassword.length < 6) {
                    messageEl.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
                    messageEl.className = 'profile-message error show';
                    return;
                }
            }

            try {
                const response = await fetch('/api/users/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        oldLogin: currentUser.login,
                        newLogin: newLogin,
                        password: newPassword || undefined
                    })
                });

                const result = await response.json();

                if (result.ok) {
                    messageEl.textContent = '–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω';
                    messageEl.className = 'profile-message success show';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
                    currentUser.login = newLogin;
                    localStorage.setItem('gantt-user', JSON.stringify(currentUser));
                    
                    setTimeout(() => {
                        closeProfileModal();
                    }, 1500);
                } else {
                    messageEl.textContent = result.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è';
                    messageEl.className = 'profile-message error show';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
                messageEl.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É';
                messageEl.className = 'profile-message error show';
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            localStorage.removeItem('gantt-user');
            localStorage.removeItem('gantt-mode');
            localStorage.removeItem('gantt-company');
            
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            window.location.href = 'auth.html';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –ø—Ä–æ—Ñ–∏–ª—è
        const profileForm = document.getElementById('profileForm');
        if (profileForm) {
            profileForm.addEventListener('submit', saveProfile);
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        async function copyCompany(sourceCompanyId) {
            if (!isAdmin) {
                showMessage('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏', 'error');
                return;
            }

            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
                showMessage('–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏...', 'success');

                // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
                let ganttData = null;
                try {
                    const ganttResponse = await fetch(`/api/gantt-state?company=${sourceCompanyId}`);
                    if (ganttResponse.ok) {
                        ganttData = await ganttResponse.json();
                    }
                } catch (e) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞:', e);
                }

                // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –ª–æ–≥–æ—Ç–∏–ø)
                let companyInfo = null;
                try {
                    const infoResponse = await fetch(`/api/company-info?company=${sourceCompanyId}`);
                    if (infoResponse.ok) {
                        companyInfo = await infoResponse.json();
                    }
                } catch (e) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏:', e);
                }

                // 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
                const allCompaniesResponse = await fetch('/api/companies');
                let allCompanies = [];
                try {
                    const companiesData = await allCompaniesResponse.json();
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –º–∞—Å—Å–∏–≤
                    if (Array.isArray(companiesData)) {
                        allCompanies = companiesData;
                    } else if (companiesData && Array.isArray(companiesData.companies)) {
                        allCompanies = companiesData.companies;
                    }
                } catch (e) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ ID:', e);
                }
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ID
                const isIdExists = (id) => {
                    return allCompanies.some(c => c && c.id === id);
                };
                
                // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ ID
                let newCompanyId = null;
                let baseId = sourceCompanyId;
                
                // –ü—Ä–æ–±—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å "-copy" –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É ID
                if (!isIdExists(`${baseId}-copy`)) {
                    newCompanyId = `${baseId}-copy`;
                } else {
                    // –ï—Å–ª–∏ "-copy" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–±—É–µ–º —Å –Ω–æ–º–µ—Ä–æ–º
                    let copyCounter = 1;
                    while (isIdExists(`${baseId}-copy-${copyCounter}`)) {
                        copyCounter++;
                    }
                    newCompanyId = `${baseId}-copy-${copyCounter}`;
                }
                
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π ID —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã),
                // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç company-N
                if (!newCompanyId || !/^[a-zA-Z0-9_-]+$/.test(newCompanyId)) {
                    let counter = 1;
                    newCompanyId = `company-${counter}`;
                    while (isIdExists(newCompanyId)) {
                        counter++;
                        newCompanyId = `company-${counter}`;
                    }
                }
                
                console.log('–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID –¥–ª—è –∫–æ–ø–∏–∏:', {
                    sourceId: sourceCompanyId,
                    newId: newCompanyId,
                    existingCompanies: allCompanies.length
                });

                // 4. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é
                const newCompanyName = companyInfo && companyInfo.name 
                    ? `${companyInfo.name} (–∫–æ–ø–∏—è)` 
                    : `–ö–æ–º–ø–∞–Ω–∏—è (–∫–æ–ø–∏—è)`;

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ ID
                const createCompanyWithRetry = async (id, name, maxRetries = 5) => {
                    let currentId = id;
                    let attempt = 0;
                    
                    while (attempt < maxRetries) {
                        try {
                            const createResponse = await fetch('/api/companies', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    id: currentId,
                                    name: name
                                })
                            });

                            const createResult = await createResponse.json();
                            
                            if (createResult.ok) {
                                return { id: currentId, result: createResult };
                            }
                            
                            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º ID, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
                            if (createResult.error && (
                                createResult.error.includes('—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç') || 
                                createResult.error.includes('already exists') ||
                                createResponse.status === 400
                            )) {
                                attempt++;
                                console.log(`ID ${currentId} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–±—É–µ–º –Ω–æ–≤—ã–π ID (–ø–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries})`);
                                
                                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å –Ω–æ–º–µ—Ä–æ–º
                                const baseId = sourceCompanyId;
                                if (currentId.includes('-copy')) {
                                    // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å -copy, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä
                                    const match = currentId.match(/-copy-(\d+)$/);
                                    if (match) {
                                        const num = parseInt(match[1]) + 1;
                                        currentId = `${baseId}-copy-${num}`;
                                    } else {
                                        currentId = `${baseId}-copy-1`;
                                    }
                                } else if (currentId.startsWith('company-')) {
                                    // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç company-N, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä
                                    const match = currentId.match(/company-(\d+)/);
                                    const num = match ? parseInt(match[1]) + 1 : attempt;
                                    currentId = `company-${num}`;
                                } else {
                                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç company-N
                                    let counter = 1;
                                    const checkResponse = await fetch('/api/companies');
                                    const checkCompanies = await checkResponse.json() || [];
                                    const checkArray = Array.isArray(checkCompanies) ? checkCompanies : [];
                                    while (checkArray.some(c => c && c.id === `company-${counter}`)) {
                                        counter++;
                                    }
                                    currentId = `company-${counter}`;
                                }
                                
                                continue; // –ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å —Å –Ω–æ–≤—ã–º ID
                            } else {
                                // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å ID
                                throw new Error(createResult.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏');
                            }
                        } catch (error) {
                            if (attempt === maxRetries - 1) {
                                throw error;
                            }
                            attempt++;
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏
                            let counter = 1;
                            const checkResponse = await fetch('/api/companies');
                            const checkCompanies = await checkResponse.json() || [];
                            const checkArray = Array.isArray(checkCompanies) ? checkCompanies : [];
                            while (checkArray.some(c => c && c.id === `company-${counter}`)) {
                                counter++;
                            }
                            currentId = `company-${counter}`;
                        }
                    }
                    
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫');
                };
                
                const { id: finalCompanyId, result: createResult } = await createCompanyWithRetry(newCompanyId, newCompanyName);
                newCompanyId = finalCompanyId; // –û–±–Ω–æ–≤–ª—è–µ–º ID –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π

                // 5. –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é
                if (ganttData) {
                    try {
                        await fetch(`/api/gantt-state?company=${encodeURIComponent(newCompanyId)}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(ganttData)
                        });
                    } catch (e) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞:', e);
                    }
                }

                // 6. –ö–æ–ø–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –ª–æ–≥–æ—Ç–∏–ø, —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
                if (companyInfo) {
                    try {
                        await fetch(`/api/company-info?company=${encodeURIComponent(newCompanyId)}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: newCompanyName,
                                objectName: companyInfo.objectName || null,
                                logoData: companyInfo.logoData || null,
                                chartType: companyInfo.chartType || 'icona',
                                containerName: companyInfo.containerName || null
                            })
                        });
                    } catch (e) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏:', e);
                    }
                } else {
                    // –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    try {
                        await fetch(`/api/company-info?company=${encodeURIComponent(newCompanyId)}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: newCompanyName,
                                logoData: null,
                                chartType: 'icona',
                                containerName: 'Icona'
                            })
                        });
                    } catch (e) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏:', e);
                    }
                }

                showMessage(`–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –ù–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è: ${newCompanyName} (${newCompanyId})`, 'success');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
                setTimeout(() => {
                    loadCompanies();
                }, 1000);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', error);
                showMessage('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏: ' + (error.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const profileModal = document.getElementById('profileModal');
                const editModal = document.getElementById('editCompanyModal');
                const deleteModal = document.getElementById('deleteCompanyModal');
                const deleteOrArchiveModal = document.getElementById('deleteOrArchiveModal');
                const statisticsModal = document.getElementById('statisticsModal');
                if (profileModal && profileModal.classList.contains('show')) {
                    closeProfileModal();
                } else if (editModal && editModal.classList.contains('show')) {
                    closeEditModal();
                } else if (deleteModal && deleteModal.classList.contains('show')) {
                    cancelDeleteCompany();
                } else if (deleteOrArchiveModal && deleteOrArchiveModal.classList.contains('show')) {
                    cancelDeleteOrArchive();
                } else if (statisticsModal && statisticsModal.classList.contains('show')) {
                    closeStatisticsModal();
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ –∫–ª—é—á
        function formatDateKey(date) {
            if (!date) return '';
            const d = new Date(date);
            if (isNaN(d.getTime())) return '';
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–º–ø–∞–Ω–∏–∏
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        async function showCompanyStatistics(companyId, companyName) {
            const modal = document.getElementById('statisticsModal');
            const content = document.getElementById('statisticsContent');
            const title = document.getElementById('statisticsModalTitle');
            
            if (!modal || !content) return;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º companyId –∏ companyName –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —ç–∫—Å–ø–æ—Ä—Ç–µ
            modal.dataset.companyId = companyId;
            modal.dataset.companyName = companyName || companyId;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            if (title) {
                title.textContent = `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${companyName || companyId}`;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.classList.add('show');
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º inline —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.zIndex = '10000';
            modal.style.pointerEvents = 'auto';
            content.innerHTML = '<div class="statistics-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>';
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏
                const response = await fetch(`/api/gantt-state?company=${encodeURIComponent(companyId)}`);
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞');
                }
                
                const data = await response.json();
                if (!data || !data.tasks) {
                    content.innerHTML = '<div class="statistics-loading">–ì—Ä–∞—Ñ–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏ –ø—É—Å—Ç</div>';
                    return;
                }
                
                const tasks = data.tasks || [];
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                let completedCount = 0;
                let inProgressCount = 0;
                let overdueCount = 0;
                let pendingCount = 0;
                let nextDeadline = null;
                let nextDeadlineTask = null;
                const overdueTasks = [];
                const upcomingDeadlines = [];
                
                tasks.forEach(task => {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Å —É—á–µ—Ç–æ–º –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                    let isCompleted = false;
                    let isInProgress = false;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å
                    if (task.status === 'completed') {
                        isCompleted = true;
                    } else if (task.status === 'in-progress') {
                        isInProgress = true;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å—ã –ø–æ –¥–∞—Ç–∞–º (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)
                    if (task.dateStatuses && Object.keys(task.dateStatuses).length > 0) {
                        // –ï—Å–ª–∏ –≤—Å–µ –¥–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã - –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                        if (task.dates && task.dates.length > 0) {
                            const allDatesCompleted = task.dates.every(d => {
                                const key = formatDateKey(d);
                                return task.dateStatuses[key] === 'completed';
                            });
                            if (allDatesCompleted) {
                                isCompleted = true;
                            }
                        }
                        
                        // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç—ã –≤ —Ä–∞–±–æ—Ç–µ - –∑–∞–¥–∞—á–∞ –≤ —Ä–∞–±–æ—Ç–µ
                        const hasInProgressDates = Object.values(task.dateStatuses).some(s => s === 'in-progress');
                        if (hasInProgressDates && !isCompleted) {
                            isInProgress = true;
                        }
                    }
                    
                    // –ü–æ–¥—Å—á–µ—Ç –∑–∞–¥–∞—á
                    if (isCompleted) {
                        completedCount++;
                    } else if (isInProgress) {
                        inProgressCount++;
                    } else {
                        pendingCount++;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤
                    if (task.endDate && !isCompleted) {
                        const endDate = new Date(task.endDate);
                        endDate.setHours(0, 0, 0, 0);
                        
                        // –ó–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞
                        if (endDate < today) {
                            overdueCount++;
                            overdueTasks.push({
                                task: task.task || task.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                                daysOverdue: Math.ceil((today - endDate) / (1000 * 60 * 60 * 24))
                            });
                        }
                        
                        // –ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞
                        if (!nextDeadline || endDate < nextDeadline) {
                            nextDeadline = endDate;
                            nextDeadlineTask = task;
                        }
                        
                        // –î–µ–¥–ª–∞–π–Ω—ã –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –¥–Ω—è
                        const daysUntilDeadline = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                        if (daysUntilDeadline >= 0 && daysUntilDeadline <= 3) {
                            upcomingDeadlines.push({
                                task: task.task || task.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                                daysUntil: daysUntilDeadline,
                                date: endDate
                            });
                        }
                    }
                });
                
                // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                const totalTasks = tasks.length;
                const progressPercent = totalTasks > 0 ? Math.round((completedCount / totalTasks) * 100) : 0;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
                const formatDate = (date) => {
                    if (!date) return '-';
                    return date.toLocaleDateString('ru-RU', { year: 'numeric', month: 'short', day: 'numeric' });
                };
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º HTML —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                let html = `
                    <div class="statistics-grid">
                        <div class="statistics-card progress">
                            <div class="statistics-card-label">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                            <div class="statistics-card-value">${progressPercent}%</div>
                            <div class="statistics-progress-bar">
                                <div class="statistics-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                        <div class="statistics-card in-progress">
                            <div class="statistics-card-label">–í —Ä–∞–±–æ—Ç–µ</div>
                            <div class="statistics-card-value">${inProgressCount}</div>
                            ${inProgressCount > 0 ? `<span class="statistics-badge info">${inProgressCount} ${inProgressCount === 1 ? '–∑–∞–¥–∞—á–∞' : inProgressCount < 5 ? '–∑–∞–¥–∞—á–∏' : '–∑–∞–¥–∞—á'}</span>` : ''}
                        </div>
                        <div class="statistics-card completed">
                            <div class="statistics-card-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            <div class="statistics-card-value">${completedCount}</div>
                            ${completedCount > 0 ? `<span class="statistics-badge info">${completedCount} ${completedCount === 1 ? '–∑–∞–¥–∞—á–∞' : completedCount < 5 ? '–∑–∞–¥–∞—á–∏' : '–∑–∞–¥–∞—á'}</span>` : ''}
                        </div>
                        <div class="statistics-card overdue">
                            <div class="statistics-card-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
                            <div class="statistics-card-value">${overdueCount}</div>
                            ${overdueCount > 0 ? `<span class="statistics-badge danger">${overdueCount} ${overdueCount === 1 ? '–∑–∞–¥–∞—á–∞' : overdueCount < 5 ? '–∑–∞–¥–∞—á–∏' : '–∑–∞–¥–∞—á'}</span>` : ''}
                        </div>
                        <div class="statistics-card pending">
                            <div class="statistics-card-label">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</div>
                            <div class="statistics-card-value">${pendingCount}</div>
                            ${pendingCount > 0 ? `<span class="statistics-badge info">${pendingCount} ${pendingCount === 1 ? '–∑–∞–¥–∞—á–∞' : pendingCount < 5 ? '–∑–∞–¥–∞—á–∏' : '–∑–∞–¥–∞—á'}</span>` : ''}
                        </div>
                        <div class="statistics-card deadline">
                            <div class="statistics-card-label">–ë–ª–∏–∂–∞–π—à–∏–π –¥–µ–¥–ª–∞–π–Ω</div>
                            <div class="statistics-card-value" style="font-size: 1.2rem;">${formatDate(nextDeadline)}</div>
                            ${nextDeadline ? (() => {
                                const daysUntil = Math.ceil((nextDeadline - today) / (1000 * 60 * 60 * 24));
                                if (daysUntil < 0) {
                                    return '<span class="statistics-badge danger">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>';
                                } else if (daysUntil <= 3) {
                                    return `<span class="statistics-badge danger">–ß–µ—Ä–µ–∑ ${daysUntil} ${daysUntil === 1 ? '–¥–µ–Ω—å' : '–¥–Ω—è'}</span>`;
                                } else if (daysUntil <= 7) {
                                    return `<span class="statistics-badge warning">–ß–µ—Ä–µ–∑ ${daysUntil} ${daysUntil === 1 ? '–¥–µ–Ω—å' : '–¥–Ω–µ–π'}</span>`;
                                } else {
                                    return `<span class="statistics-badge info">–ß–µ—Ä–µ–∑ ${daysUntil} ${daysUntil === 1 ? '–¥–µ–Ω—å' : '–¥–Ω–µ–π'}</span>`;
                                }
                            })() : '<span class="statistics-badge info">–ù–µ—Ç –¥–µ–¥–ª–∞–π–Ω–æ–≤</span>'}
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö
                if (overdueTasks.length > 0 || upcomingDeadlines.length > 0) {
                    html += '<div class="statistics-deadlines">';
                    html += '<h3>‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –¥–µ–¥–ª–∞–π–Ω—ã</h3>';
                    
                    // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
                    overdueTasks.slice(0, 5).forEach(item => {
                        html += `
                            <div class="deadline-item danger">
                                <div class="deadline-item-title">üî¥ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ: ${item.task.substring(0, 60)}${item.task.length > 60 ? '...' : ''}</div>
                                <div class="deadline-item-text">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ ${item.daysOverdue} ${item.daysOverdue === 1 ? '–¥–µ–Ω—å' : item.daysOverdue < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'}</div>
                            </div>
                        `;
                    });
                    
                    // –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –¥–µ–¥–ª–∞–π–Ω—ã
                    upcomingDeadlines.slice(0, 5).forEach(item => {
                        html += `
                            <div class="deadline-item ${item.daysUntil === 0 ? 'danger' : 'warning'}">
                                <div class="deadline-item-title">${item.daysUntil === 0 ? 'üî¥ –î–µ–¥–ª–∞–π–Ω —Å–µ–≥–æ–¥–Ω—è' : 'üü† –î–µ–¥–ª–∞–π–Ω —á–µ—Ä–µ–∑ ' + item.daysUntil + ' ' + (item.daysUntil === 1 ? '–¥–µ–Ω—å' : '–¥–Ω—è')}: ${item.task.substring(0, 60)}${item.task.length > 60 ? '...' : ''}</div>
                                <div class="deadline-item-text">${formatDate(item.date)}</div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                }
                
                content.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                content.innerHTML = `<div class="statistics-loading" style="color: #f44336;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}</div>`;
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.showCompanyStatistics = showCompanyStatistics;
        
        function closeStatisticsModal() {
            const modal = document.getElementById('statisticsModal');
            if (modal) {
                modal.classList.remove('show');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º inline —Å—Ç–∏–ª–∏
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                modal.style.pointerEvents = 'none';
            }
        }

        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ html2pdf.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        let html2pdfLoaded = false;
        let html2pdfLoading = false;

        function loadHtml2Pdf() {
            return new Promise((resolve, reject) => {
                // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
                if (html2pdfLoaded && typeof html2pdf !== 'undefined') {
                    resolve();
                    return;
                }
                
                // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∂–¥—ë–º
                if (html2pdfLoading) {
                    const checkInterval = setInterval(() => {
                        if (html2pdfLoaded && typeof html2pdf !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                    return;
                }
                
                // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                html2pdfLoading = true;
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
                script.async = true;
                script.onload = () => {
                    html2pdfLoaded = true;
                    html2pdfLoading = false;
                    if (typeof html2pdf !== 'undefined') {
                        resolve();
                    } else {
                        reject(new Error('html2pdf –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è'));
                    }
                };
                script.onerror = () => {
                    html2pdfLoading = false;
                    reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å html2pdf.js. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.'));
                };
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (!html2pdfLoaded) {
                        html2pdfLoading = false;
                        script.remove();
                        reject(new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ html2pdf.js'));
                    }
                }, 10000);
                
                document.head.appendChild(script);
            });
        }

        // –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ PDF
        async function exportStatisticsToPDF() {
            const content = document.getElementById('statisticsContent');
            const title = document.getElementById('statisticsModalTitle');
            const modal = document.getElementById('statisticsModal');
            
            if (!content) {
                showMessage('–û—à–∏–±–∫–∞: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
            if (content.innerHTML.includes('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏') || content.innerHTML.includes('–û—à–∏–±–∫–∞')) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
            let companyId = null;
            let companyName = '';
            let objectName = '';
            
            if (modal) {
                companyId = modal.dataset.companyId;
                companyName = modal.dataset.companyName || '';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è objectName
                if (companyId) {
                    try {
                        const infoResponse = await fetch(`/api/company-info?company=${encodeURIComponent(companyId)}`);
                        if (infoResponse.ok) {
                            const companyInfo = await infoResponse.json();
                            if (companyInfo && companyInfo.objectName) {
                                objectName = companyInfo.objectName;
                            }
                            // –ï—Å–ª–∏ companyName –Ω–µ –±—ã–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω, –±–µ—Ä–µ–º –∏–∑ companyInfo
                            if (!companyName && companyInfo && companyInfo.name) {
                                companyName = companyInfo.name;
                            }
                        }
                    } catch (error) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞:', error);
                    }
                }
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É html2pdf.js –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
            try {
                showMessage('–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');
                await loadHtml2Pdf();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ html2pdf.js:', error);
                showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.', 'error');
                return;
            }
            
            if (typeof html2pdf === 'undefined') {
                showMessage('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ html2pdf –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.', 'error');
                return;
            }

            try {
                showMessage('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...', 'info');

                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                const exportWrapper = document.createElement('div');
                exportWrapper.style.padding = '20px';
                exportWrapper.style.paddingBottom = '40px';
                exportWrapper.style.background = '#ffffff';
                exportWrapper.style.fontFamily = window.getComputedStyle(document.body).fontFamily || 'Arial, sans-serif';
                exportWrapper.style.color = '#000';

                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                const header = document.createElement('div');
                header.style.marginBottom = '20px';
                header.style.paddingBottom = '15px';
                header.style.borderBottom = '2px solid #e0e0e0';
                
                const titleElement = document.createElement('h1');
                titleElement.textContent = title ? title.textContent : '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏';
                titleElement.style.color = '#1565c0';
                titleElement.style.fontSize = '24px';
                titleElement.style.fontWeight = '700';
                titleElement.style.margin = '0 0 10px 0';
                header.appendChild(titleElement);

                const dateElement = document.createElement('div');
                dateElement.textContent = `–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}`;
                dateElement.style.color = '#666';
                dateElement.style.fontSize = '12px';
                header.appendChild(dateElement);

                exportWrapper.appendChild(header);

                // –ö–ª–æ–Ω–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const contentClone = content.cloneNode(true);
                contentClone.style.marginTop = '20px';

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è PDF
                const style = document.createElement('style');
                style.textContent = `
                    .statistics-grid {
                        display: grid !important;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
                        gap: 15px !important;
                        margin-top: 20px !important;
                    }
                    .statistics-card {
                        background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%) !important;
                        border-radius: 12px !important;
                        padding: 15px !important;
                        border-left: 4px solid #2196f3 !important;
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
                        page-break-inside: avoid !important;
                    }
                    .statistics-card-label {
                        font-size: 14px !important;
                        color: #666 !important;
                        margin-bottom: 8px !important;
                    }
                    .statistics-card-value {
                        font-size: 28px !important;
                        font-weight: 700 !important;
                        color: #1565c0 !important;
                        margin-bottom: 10px !important;
                    }
                    .statistics-progress-bar {
                        height: 8px !important;
                        background: #e0e0e0 !important;
                        border-radius: 4px !important;
                        overflow: hidden !important;
                        margin-top: 10px !important;
                    }
                    .statistics-progress-fill {
                        height: 100% !important;
                        background: linear-gradient(90deg, #2196f3 0%, #1976d2 100%) !important;
                        transition: width 0.3s ease !important;
                    }
                    .statistics-badge {
                        display: inline-block !important;
                        padding: 4px 8px !important;
                        border-radius: 4px !important;
                        font-size: 11px !important;
                        font-weight: 600 !important;
                        margin-top: 8px !important;
                    }
                    .statistics-deadlines {
                        margin-top: 30px !important;
                        padding: 20px !important;
                        background: #f9f9f9 !important;
                        border-radius: 12px !important;
                        page-break-inside: avoid !important;
                    }
                    .statistics-deadlines h3 {
                        color: #1565c0 !important;
                        font-size: 18px !important;
                        margin-bottom: 15px !important;
                    }
                    .deadline-item {
                        padding: 12px !important;
                        margin-bottom: 10px !important;
                        border-radius: 8px !important;
                        background: white !important;
                        border-left: 4px solid #ff9800 !important;
                        page-break-inside: avoid !important;
                    }
                    .deadline-item.danger {
                        border-left-color: #f44336 !important;
                        background: #ffebee !important;
                    }
                    .deadline-item.warning {
                        border-left-color: #ff9800 !important;
                        background: #fff3e0 !important;
                    }
                    .deadline-item-title {
                        font-weight: 600 !important;
                        color: #333 !important;
                        margin-bottom: 5px !important;
                        font-size: 14px !important;
                    }
                    .deadline-item-text {
                        color: #666 !important;
                        font-size: 12px !important;
                    }
                `;
                exportWrapper.appendChild(style);
                exportWrapper.appendChild(contentClone);

                // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞_–ò–º—è–ö–æ–º–ø–∞–Ω–∏–∏_–û–±—ä–µ–∫—Ç_–î–∞—Ç–∞–í—Ä–µ–º—è.pdf
                const sanitizeFileName = (str) => {
                    if (!str) return '';
                    return str.replace(/[^a-zA-Z–ê-–Ø–∞-—è0-9\s]/g, '').replace(/\s+/g, '_').trim();
                };
                
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-'); // HH-MM-SS
                const dateTimeStr = `${dateStr}_${timeStr}`;
                
                let fileName = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è –∫–æ–º–ø–∞–Ω–∏–∏
                if (companyName) {
                    const cleanCompanyName = sanitizeFileName(companyName);
                    if (cleanCompanyName) {
                        fileName += `_${cleanCompanyName}`;
                    }
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å
                if (objectName) {
                    const cleanObjectName = sanitizeFileName(objectName);
                    if (cleanObjectName) {
                        fileName += `_${cleanObjectName}`;
                    }
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
                fileName += `_${dateTimeStr}.pdf`;
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                const opt = {
                    margin: [10, 10, 10, 10],
                    filename: fileName,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait' 
                    }
                };

                // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ PDF
                await html2pdf().set(opt).from(exportWrapper).save();
                
                showMessage('PDF –≥–æ—Ç–æ–≤!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ PDF:', error);
                showMessage('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF: ' + (error.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.showCompanyStatistics = showCompanyStatistics;
        window.closeStatisticsModal = closeStatisticsModal;
        window.exportStatisticsToPDF = exportStatisticsToPDF;
    </script>
    
    <footer class="footer">
        <p>&copy; 2025 SetlTech. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>
</body>
</html>

