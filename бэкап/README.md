## Диаграмма Ганта ICONA — модуль `implementation_schedule.html`

Этот модуль — отдельная страница с интерактивной диаграммой Ганта для планирования внедрения и обучения системе ICONA.

- **Страница авторизации**: `auth.html` — предстраница с формой входа  
- **Страница выбора компаний**: `companies.html` — выбор компании для работы (после авторизации)
- **Админ-панель**: `admin.html` — управление пользователями системы  
- **Фронтенд‑страница**: `implementation_schedule.html` — основная страница с диаграммой Ганта  
- **Бэкенд‑сервер**: `server.js` (Node + Express, API для сохранения/загрузки состояния диаграммы и управления пользователями и компаниями)

**Важно:** Модуль поддерживает **мультитенантность** — работу с несколькими компаниями. Каждая компания имеет свой отдельный график Ганта.

---

## Страница авторизации (`auth.html`)

Предстраница авторизации с красивыми визуальными эффектами перед доступом к графику Ганта.

### Особенности

- **Анимация воды** — интерактивный canvas с волнами, которые появляются при движении мыши по экрану
- **12 светлячков** — летающие белые точки, которые убегают от курсора и отскакивают от краёв экрана
- **Светлый голубой дизайн** — градиентный фон с голубыми оттенками (light blue, sky blue, light cyan)
- **Логотип в левом верхнем углу** — `logo.png` с эффектом наклона за мышкой (3D tilt effect) и голубым свечением при наведении
- **Форма авторизации** — поля для ввода логина и пароля с переключением видимости пароля
- **Два режима доступа**:
  - **Кнопка "Войти"** — режим редактирования (полный доступ ко всем функциям)
  - **Кнопка "Режим просмотра"** — режим просмотра (только просмотр и выгрузка данных)

### Анимация перехода

При нажатии любой из кнопок:
1. **Растворение экрана авторизации** — экран постепенно теряет прозрачность, размывается и увеличивается с эффектом тумана (1.2 секунды)
2. **Появление графика из тумана** — страница графика появляется с плавным появлением, размытие уменьшается, эффект тумана растворяется (1.5 секунды)

### Доступ

**На вашем сервере (после деплоя):**
```text
https://ваш-домен.com/auth.html
```
или
```text
http://ваш-домен.com:3001/auth.html
```

**На внутреннем сервере компании:**
```text
http://icona_academy.corppn.ru:3001/auth.html
```

**Для локальной разработки:**
```text
http://localhost:3001/auth.html
```

После авторизации происходит автоматический переход на `companies.html` (страницу выбора компании), где пользователь выбирает компанию для работы.

**Система авторизации:**
- Авторизация через API `/api/auth` с проверкой логина и пароля
- Пароли хранятся в зашифрованном виде (bcrypt)
- Данные пользователя сохраняются в `localStorage` после успешной авторизации
- Поддержка двух ролей: **Администратор** и **Пользователь**
- Пользователи имеют доступ только к назначенным им компаниям (поле `companies` в профиле)
- Администраторы имеют доступ ко всем компаниям

**Прямой доступ к графику (для режима просмотра):**
Если в URL указан параметр `?company=xxx`, пользователь может сразу попасть на график конкретной компании без выбора (например, для режима просмотра по прямой ссылке).

---

## Страница выбора компаний (`companies.html`)

Страница выбора компании для работы после авторизации.

### Доступ

Страница доступна только авторизованным пользователям. Неавторизованные пользователи автоматически перенаправляются на `auth.html`.

### Особенности

- **Приветствие**:
  - Для администраторов: неформальное приветствие на "ты" — "Привет, [имя]! Выбери компанию."
  - Для обычных пользователей: формальное приветствие на "вы" — "Добро пожаловать, [имя]! Выберите компанию для работы"
- **Неприметная кнопка перехода в админ-панель** (только для администраторов):
  - Расположена в правом верхнем углу header
  - Полупрозрачная кнопка с иконкой шестерёнки и текстом "Админ"
  - При наведении становится заметнее
- **Отображение доступных компаний**:
  - Администраторы видят все компании в системе
  - Обычные пользователи видят только компании, к которым у них есть доступ (поле `companies` в профиле)
- **Карточки компаний**:
  - Отображение логотипа компании (если загружен)
  - Название компании и ID
  - Кнопка "Открыть график" для перехода к графику компании
  - Кнопка "Удалить" (только для администраторов)
- **Создание компаний** (только для администраторов):
  - Кнопка "Создать новую компанию"
  - Форма создания с полями:
    - ID компании (латинские буквы, цифры, дефисы, подчеркивания)
    - Название компании
    - Логотип компании (опционально, с предпросмотром и автоматическим сжатием)
- **Модальное окно удаления компании**:
  - Красивое модальное окно подтверждения удаления (аналогично удалению задач в Ганте)
  - Закрытие по клику вне окна или по клавише Escape
- **Анимации**:
  - При загрузке страницы: появление из тумана (аналогично странице графика)
  - При переходе на график: растворение экрана с эффектом тумана

### Функции для администраторов

- ✅ Просмотр всех компаний
- ✅ Создание новых компаний
- ✅ Редактирование компаний (название и логотип)
- ✅ Загрузка логотипов компаний
- ✅ Удаление компаний (с подтверждением)

### Функции для пользователей

- ✅ Просмотр доступных компаний
- ✅ Просмотр логотипов компаний
- ✅ Открытие графиков компаний
- ❌ Создание, редактирование и удаление компаний недоступны

### API для работы с компаниями

- `GET /api/companies` — получить список всех компаний
- `POST /api/companies` — создать новую компанию
- `DELETE /api/companies/:id` — удалить компанию по ID
- `GET /api/company-info?company=xxx` — получить информацию о компании (название и логотип)
- `POST /api/company-info?company=xxx` — сохранить информацию о компании (название и логотип)
  - Тело запроса: `{ name, logoData }` (logoData — base64 строка изображения)
  - Лимит размера запроса: 10MB (для поддержки загрузки изображений)

---

## Админ-панель (`admin.html`)

Веб-интерфейс для управления пользователями системы.

### Доступ

**На вашем сервере (после деплоя):**
```text
https://ваш-домен.com/admin.html
```
или
```text
http://ваш-домен.com:3001/admin.html
```

**На внутреннем сервере компании:**
```text
http://icona_academy.corppn.ru:3001/admin.html
```

**Для локальной разработки:**
```text
http://localhost:3001/admin.html
```

**Важно:** Админ-панель доступна всем, кто знает URL. Для безопасности рекомендуется:
- Использовать HTTPS
- Добавить дополнительную защиту (например, базовую HTTP-аутентификацию на уровне веб-сервера)
- Ограничить доступ по IP-адресам (если возможно)

### Функции

- **Кнопка выхода** — переход обратно на страницу выбора компаний (`companies.html`)
  - Расположена в правом верхнем углу header
  - Оранжевая кнопка с иконкой стрелки влево и текстом "Выход"
  - При нажатии перенаправляет на страницу выбора компаний (данные авторизации сохраняются)
- **Выбор компании** — селектор для выбора компании перед управлением пользователями
- **Добавление пользователей** — регистрация новых пользователей с указанием:
  - Имени пользователя
  - Логина (уникальный)
  - Пароля (хранится в зашифрованном виде с использованием bcrypt)
  - Роли (пользователь или администратор)
  - При создании пользователя автоматически назначается доступ к выбранной компании (если выбрана)
- **Редактирование пользователей** — изменение данных существующих пользователей:
  - Изменение имени пользователя
  - Изменение роли (пользователь/администратор)
  - Изменение пароля (опционально)
  - Управление доступом к компаниям через чекбоксы
  - При выборе роли "Администратор" чекбоксы компаний автоматически отключаются (админы имеют доступ ко всем компаниям)
- **Просмотр списка пользователей** — отображение пользователей с указанием:
  - Ролей
  - Списка компаний, к которым у пользователя есть доступ
  - Фильтрация по выбранной компании
- **Удаление пользователей** — удаление пользователей из системы
- **Ссылка на управление компаниями** — переход на страницу `companies.html`

### Роли пользователей

В системе поддерживаются две роли:

- **Администратор** (`admin`) — полный доступ ко всем функциям системы:
  - Доступ ко всем компаниям
  - Создание и удаление компаний
  - Управление всеми пользователями
  - Редактирование графиков всех компаний
- **Пользователь** (`user`) — ограниченный доступ:
  - Доступ только к назначенным компаниям (поле `companies` в профиле)
  - Просмотр и редактирование графиков доступных компаний
  - Не может создавать или удалять компании

### API для работы с пользователями

- `GET /api/users` — получить список пользователей (без паролей)
  - Параметр `?company=xxx` (опционально) — фильтр по компании
- `POST /api/users` — добавить нового пользователя
  - Тело запроса: `{ name, login, password, role, companies: [] }`
  - Поле `companies` — массив ID компаний, к которым у пользователя есть доступ
- `PUT /api/users/:login` — обновить данные пользователя (для админов)
  - Тело запроса: `{ name, role, password?, companies? }`
  - Поле `password` опционально (если не указано, пароль не меняется)
  - Поле `companies` опционально (для администраторов игнорируется)
- `DELETE /api/users/:login` — удалить пользователя по логину
- `PUT /api/users/update` — обновить данные текущего пользователя (логин и/или пароль)
  - Тело запроса: `{ oldLogin, newLogin, password? }`
- `PUT /api/users/:login/companies` — обновить доступ пользователя к компаниям
  - Тело запроса: `{ companies: ["company1", "company2"] }`
- `POST /api/auth` — проверка авторизации (логин и пароль)
  - Тело запроса: `{ login, password, company }` (company опционально)
  - Проверяет доступ пользователя к компании, если указана

### Хранение данных

Все данные системы сохраняются в папке `1` (там же, где находится `server.js`):

- **`users.json`** — список всех пользователей с зашифрованными паролями и ролями
  - Создаётся автоматически при первом добавлении пользователя
  - Формат: массив объектов с полями `id`, `name`, `login`, `password` (хеш), `role`, `companies` (массив ID компаний), `createdAt`
- **`companies.json`** — список всех компаний
  - Создаётся автоматически при первом создании компании
  - Формат: массив объектов с полями `id`, `name`, `createdAt`
- **`gantt-state-{companyId}.json`** — состояние диаграммы Ганта для конкретной компании
  - Создаётся автоматически при первом сохранении графика компании
  - Формат: объект с полями `tasks`, `startDate` и другими данными графика
- **`company-info-{companyId}.json`** — информация о компании (название и логотип в base64)
  - Создаётся автоматически при первом сохранении информации о компании
  - Формат: объект с полями `name`, `logoData` (base64 строка)

**Важно:** 
- Все файлы создаются автоматически при первом использовании соответствующих функций
- Каждая компания имеет свои отдельные файлы данных (`gantt-state-{companyId}.json` и `company-info-{companyId}.json`)
- При деплое убедитесь, что эти файлы сохраняются между перезапусками сервера (используйте постоянное хранилище на платформе деплоя)
- Лимит размера запроса увеличен до 10MB для поддержки загрузки изображений логотипов

---

## Управление на странице графика

На основной странице графика (`implementation_schedule.html`) авторизованные пользователи имеют доступ к дополнительным функциям управления.

### Кнопка выхода

- **Расположение**: правый верхний угол страницы, под кнопкой редактирования профиля
- **Внешний вид**: круглая оранжевая кнопка с иконкой стрелки влево (белая)
- **Подсказка**: при наведении появляется подсказка "Выход" в стиле подсказок редактирования этапов (чёрный фон, белый текст, появляется с задержкой 1 секунда)
- **Функция**: выход из системы
  - Очищает данные авторизации из `localStorage` (`gantt-user`, `gantt-mode`, `gantt-company`)
  - Перенаправляет на страницу авторизации (`auth.html`)
- **Доступ**: только для авторизованных пользователей

### Кнопка выбора компаний

- **Расположение**: правый верхний угол страницы, слева от кнопки редактирования профиля (верхний ряд)
- **Внешний вид**: круглая зелёная кнопка с иконкой в виде квадрата с точкой
- **Функция**: переход на страницу выбора компаний (`companies.html`)
- **Доступ**: только для авторизованных пользователей
- **Навигация**:
  - Администраторы видят все компании и могут создавать новые
  - Пользователи видят только доступные им компании

### Расположение кнопок управления

Кнопки управления расположены в правом верхнем углу страницы графика:

**Верхний ряд** (top: 30px):
- Зелёная кнопка выбора компаний (right: 85px)
- Синяя кнопка редактирования профиля (right: 30px)

**Нижний ряд** (top: 85px):
- Оранжевая кнопка выхода (right: 30px) — под профилем

Такое расположение создаёт вертикальную группу справа и оставляет место для будущих кнопок.

### Окно редактирования профиля

Окно редактирования профиля доступно только для авторизованных пользователей (вошедших через страницу авторизации). Кнопка профиля отображается в правом верхнем углу страницы графика.

### Функции

- **Изменение логина** — пользователь может изменить свой логин
- **Изменение пароля** — пользователь может установить новый пароль (минимум 6 символов)
- **Подтверждение пароля** — при смене пароля требуется подтверждение
- **Валидация данных** — проверка совпадения паролей и минимальной длины пароля
- **Перетаскивание окна** — модальное окно можно перетаскивать за заголовок

### Интерфейс

- Кнопка профиля — круглая кнопка с иконкой профиля в правом верхнем углу страницы
- Модальное окно — всплывающее окно с формой редактирования профиля
- Сообщения об ошибках/успехе — отображение статуса операций обновления профиля

### API для обновления профиля

- `PUT /api/users/update` — обновление данных пользователя (логин и/или пароль)
  - Требует: `oldLogin`, `newLogin`, `password` (опционально, если не указан — пароль не меняется)
  - Возвращает: статус операции и сообщение об ошибке (если есть)

### Особенности

- Окно редактирования профиля доступно только авторизованным пользователям
- При обновлении профиля данные пользователя автоматически обновляются в `localStorage`
- Пароль можно не менять — достаточно оставить поле пустым
- При изменении логина требуется, чтобы новый логин был уникальным

---

## Система прав доступа

Модуль поддерживает два режима работы: **редактирование** и **просмотр**.

### Режим редактирования

Доступен при нажатии кнопки **"Войти"** на странице авторизации. Предоставляет полный доступ ко всем функциям:

- ✅ Редактирование названий задач
- ✅ Изменение дат, рабочих дней, ответственных
- ✅ Изменение статусов задач
- ✅ Добавление задач (клавиша Insert)
- ✅ Удаление задач (клавиша Delete)
- ✅ Drag&drop задач для изменения порядка
- ✅ Редактирование этапов (переименование, удаление, изменение порядка)
- ✅ Редактирование названия компании и загрузка логотипа
- ✅ Сброс плана
- ✅ Все функции режима просмотра

### Режим просмотра

Доступен при нажатии кнопки **"Режим просмотра"** на странице авторизации. Ограничивает доступ только функциями просмотра:

- ✅ Просмотр графика и таблицы задач
- ✅ Выгрузка в PDF
- ✅ Выгрузка в Excel/CSV
- ✅ Переключение детального вида (точки/полосы)
- ✅ Переключение колонки "Ответственный"
- ✅ Фильтры по этапам (кнопки этапов)
- ✅ Переключение вида Гант/Таблица
- ✅ Навигация по задачам (выделение, прокрутка)
- ❌ Все функции редактирования заблокированы

**Визуальные индикаторы режима просмотра:**
- В правом верхнем углу отображается индикатор "Режим просмотра"
- Кнопка "Сбросить план" визуально заблокирована (полупрозрачная)
- Поля ввода неактивны для редактирования
- Drag&drop отключен

Режим сохраняется в `localStorage` и применяется автоматически при загрузке страницы графика.

---

## Что умеет модуль (по смыслу)

- **Адаптивная временная шкала**
  - Переключение уровней детализации в зависимости от масштаба:
    - по дням (отдельные даты, выделение выходных и праздников);
    - по неделям (подписи вида `10–16` + месяц на отдельной строке, агрегация задач по неделям; названия месяцев всегда выровнены по высоте);
    - по месяцам (подписи `Февраль 2025`, агрегация задач по месяцам).
  - При максимальном отдалении виден весь проект + «хвост» до конца следующего года.
  - Серый «хвост» временной шкалы после конца последней задачи визуально отделяет будущее расширение плана.

- **Задачи и статусы**
  - Структура: этап, вид контроля, мероприятие, даты начала/окончания, количество рабочих дней, **ответственный**, статус.
  - Поддерживаемые статусы задачи:
    - Запланирована
    - В работе
    - Завершено
    - Доп. статусы для отдельных дней через контекстное меню (выходной, праздник и т.п.);  
      дни со статусами «выходной» и «праздник» подсвечиваются в Ганте отдельными цветами (розовый / жёлтый).
  - В таблице под диаграммой можно менять даты начала/окончания и количество рабочих дней:
    - если заданы **дата начала + рабочие дни** — дата окончания считается автоматически по рабочим дням;
    - если заданы **дата окончания + рабочие дни** — дата начала пересчитывается «назад» по рабочим дням;
    - если заданы **обе даты** — пересчитывается количество рабочих дней между ними.
  - Все последующие задачи образуют **жёсткую последовательность**: каждая новая задача начинается на следующий день после окончания предыдущей, при этом её длительность в рабочих днях сохраняется и хвост графика сдвигается.
  - При установке статуса **«В работе»** или **«Завершено»** по ячейке/диапазону открывается модальное окно для ввода комментария; комментарий сохраняется по датам и:
    - при наведении на закрашенную ячейку под ней всплывает чёрная подсказка с текстом комментария;
    - стандартный браузерный `title` для баров Ганта отключён, чтобы по ховеру отображался **только** текст комментария.
  - В детальном режиме:
    - при статусе **«В работе»** комментарии хранятся отдельно по каждой дате интервала;
    - при статусе **«Завершено (с начала по выбранную дату)»** все оставшиеся рабочие дни задачи перекрашиваются в зелёный, **но комментарии остаются привязаны к своим датам**: уже существующие тексты не затираются, а новый комментарий (если введён при завершении) привязывается только к выбранной дате завершения.
  - В таблице можно редактировать:
    - **Этап** — общее название группы задач; изменение названия для одной строки автоматически переименовывает все задачи с тем же этапом.  
      Префикс «Этап N.» защищён от редактирования, редактируется только текст после него.
    - **Вид контроля** — настраивается индивидуально для каждой задачи и не влияет на остальные строки.

- **Учёт рабочего календаря**
  - Старт проекта задаётся через `startDate` и может изменяться пользователем.
  - Рабочие дни считаются с учётом выходных и официальных праздников РФ (массив `holidays`).
  - Для каждой задачи вычисляются реальные календарные даты начала/окончания и массив рабочих дат.

- **Брендинг компании**
  - Под заголовком блока добавлен контейнер с логотипом и названием компании.
  - Слева — крупное превью логотипа (по умолчанию `favicon.png`) и надпись «Выберите файл» прямо поверх PNG; при загрузке нового PNG надпись исчезает.
  - Справа — название компании: по умолчанию серый текст «Введите название компании»; при вводе название набирается прямо в этой строке, отображается крупным градиентным текстом (от красного к тёмно‑красному), можно использовать и строчные, и прописные буквы.
  - Название и логотип **не сбрасываются** при нажатии на «Сбросить план» — сбрасывается только сам график.

- **Интерактивность диаграммы и управление задачами**
  - Клик по бару задачи открывает контекстное меню со статусами дня:
    - «В работе»,
    - «Завершено (с начала по выбранную дату)»,
    - «Выходной / Праздник» и др.
  - При выборе статуса диаграмма автоматически перерисовывается.
  - Переключатель режима отображения баров:
    - **Общий вид** — сплошные полосы по интервалам без детализации по дням (статус меняется сразу для всей задачи); цепочки задач образуют непрерывные полосы, одиночные задачи в интервале рисуются с закруглёнными краями.
    - **Детальный вид** — покраска по отдельным рабочим дням (можно менять статус по дням/неделям/месяцам).
  - Отдельная кнопка **«Ответственный»**:
    - при включении добавляет в левую часть Ганта столбец «Ответственный» (после «Рабочих дней») и показывает соответствующий столбец в таблице;
    - при выключении колонка скрывается на странице, но данные по ответственным сохраняются в задачах.
  - Изменения в таблице задач сразу пересчитывают временную шкалу и бары в диаграмме, и наоборот.
  - Поддерживается drag&drop строк задач и горизонтальный зум (сочетание Z + колесо мыши над диаграммой).
  - Один клик по задаче (в Ганте или в таблице) выделяет строку и подсвечивает её: при обычном режиме — мягкий голубой цвет, при включённом фильтре по этапу — все задачи выбранного этапа подсвечены светло‑голубым, выбранная строка чуть темнее.
  - **Insert** — вставляет новую задачу под выделенной: дата начала = следующий рабочий день после конца выделенной задачи, длительность по умолчанию 1 рабочий день; последующие задачи автоматически сдвигаются, сохраняя свою длительность.
  - **Delete** — удаляет выделенную задачу с подтверждением: появляется диалог «Удалить задачу?», Enter = удалить, Escape/«Нет» = отмена; после удаления следующая задача «подтягивается» вперёд (дата начала = конец предыдущей + 1 день), хвост пересчитывается.
  - **Стрелки вверх/вниз** — навигация по задачам с клавиатуры: выделение перемещается по списку задач, соответствующая строка в Ганте автоматически прокручивается в зону видимости.
  - Кнопки этапов над диаграммой (`Все этапы`, `Этап 1`, `Этап 2`, `Этап 3`, `Этап 4`) позволяют группировать задачи по этапам: при выборе конкретного этапа задачи этого этапа подсвечиваются светло‑голубым, остальные строки становятся полупрозрачными и неактивными; при выборе `Все этапы` фильтр сбрасывается.
  - Кнопки управления над диаграммой имеют кастомные CSS‑иконки (без эмодзи и стандартных картинок): иконка диаграммы в заголовке, иконка PDF, таблицы Excel, переключения вида (Гант/таблица) и сброса плана (`Сбросить план` с подсказкой «Сбросить все даты до дефолтных значений»).
  - Шапка диаграммы Ганта (`Задача / Дата начала / Дата окончания / Рабочих дней` и временная шкала по месяцам/неделям/дням) **фиксируется при вертикальном скролле** внутри блока Ганта — как в Excel при «зафиксации верхней строки», чтобы внизу всегда было видно, в каком месяце/дате находятся последние работы.
  - Для колонки **«Ответственный»**:
    - если текст не помещается целиком, в таблице и в блоке деталей Ганта при наведении на ячейку показывается чёрная всплывающая подсказка с полным списком ответственных (в том же стиле, что и остальные подсказки интерфейса).

- **Выгрузка данных**
  - **PDF**: кнопка «Выгрузить в PDF» сохраняет текущий вид Ганта с логотипом и названием компании.  
    Техническое ограничение: при очень длинных проектах браузер может обрезать диаграмму по ширине/высоте — PDF‑выгрузка сделана как «красивый скриншот», а не как строгий отчёт.
  - **Excel/CSV**:
    - Если библиотека `xlsx` доступна:
      - создаётся файл `График_внедрения_ICONA.xlsx` с двумя листами:
        1. **Лист‑Гант**: над кнопкой выгрузки есть выпадающий список масштаба (`дни / недели / месяцы / годы`).  
           В первом столбце — наименование задачи, далее даты начала/окончания/кол‑во рабочих дней и временная шкала;  
           ячейки шкалы закрашены в цвета, соответствующие статусам задач и отдельным дням (план — синий, в работе — оранжевый, завершено — зелёный, выходной/праздник — отдельные оттенки).  
           Если по датам внутри интервала есть комментарии, они добавляются в ячейку как **комментарий Excel** (note): при наведении в Excel видно текст вида  
           `YYYY-MM-DD: комментарий` (по строке на каждую дату с текстом).
        2. **Лист `Задачи`**: детальная таблица задач как на странице (включая столбец «Ответственный» — он выгружается всегда, даже если на странице колонка скрыта) и дополнительный столбец **«Комментарии по датам»** с агрегированным списком вида  
           `YYYY-MM-DD: комментарий; YYYY-MM-DD: комментарий ...`.
    - Если `xlsx` недоступна (например, нет доступа к CDN), модуль автоматически делает выгрузку в CSV (`График_внедрения_ICONA.csv`) в той же структуре (сначала блок Ганта, затем таблица задач), файл открывается в Excel без дополнительной настройки.

---

## Как запустить сервер

Это **отдельный независимый сервер** для модуля диаграммы Ганта. Его можно развернуть на любом домене/порту, и все данные будут сохраняться локально в папке `1`.

### Запуск сервера

1. Перейти в папку `1`:

   ```bash
   cd 1
   npm install
   node server.js
   ```

   **Важно:** При первом запуске или после обновления зависимостей убедитесь, что установлен пакет `bcrypt` для шифрования паролей:
   ```bash
   npm install bcrypt
   ```

2. Сервер запустится на порту **3001** (или на порту, указанном в переменной окружения `PORT`)

3. Открыть в браузере:

   **После деплоя на ваш сервер:**
   ```text
   https://ваш-домен.com/auth.html
   ```
   или
   ```text
   http://ваш-домен.com:3001/auth.html
   ```

   **На внутреннем сервере компании:**
   ```text
   http://icona_academy.corppn.ru:3001/auth.html
   ```

   **Для локальной разработки (только на вашем компьютере):**
   ```text
   http://localhost:3001/auth.html
   ```

   **Прямой доступ к графику (без авторизации):**
   ```text
   https://ваш-домен.com/implementation_schedule.html
   ```
   или
   ```text
   http://ваш-домен.com:3001/implementation_schedule.html
   ```

### Особенности

- ✅ **Независимый сервер** — работает отдельно от главного сервера проекта
- ✅ **Автономное сохранение данных** — все данные сохраняются в файлы `gantt-state.json` и `company-info.json` в папке `1`
- ✅ **Доступен с любого домена** — сервер слушает на `0.0.0.0`, доступен из сети
- ✅ **Порт настраивается** — можно задать через переменную окружения `PORT=3001 node server.js`

### Проверка работы API

Проверить работу сохранения/загрузки состояния через API `/api/gantt-state`:
- `GET /api/gantt-state?company=xxx` — вернуть текущее сохранённое состояние графика компании (файл `gantt-state-{companyId}.json`);
- `POST /api/gantt-state?company=xxx` — сохранить новое состояние графика компании в `gantt-state-{companyId}.json`.

Если файла `gantt-state-{companyId}.json` ещё нет, сервер создаст его при первом сохранении.

**Важно:** Все API эндпоинты для работы с графиком и информацией о компании требуют параметр `company` в query string или в теле запроса.

---

## Минимальный набор файлов для GitHub / деплоя

Чтобы модуль можно было отдельно выложить и развернуть, в папке `1` должны быть как минимум:

- `auth.html` — страница авторизации с анимациями;
- `companies.html` — страница выбора компании для работы;
- `admin.html` — админ-панель для управления пользователями;
- `implementation_schedule.html` — основная страница с диаграммой Ганта;
- `server.js` — сервер на Express, который:
  - отдаёт статические файлы из папки `1`;
  - обрабатывает `GET/POST /api/gantt-state?company=xxx` и работает с `gantt-state-{companyId}.json`;
  - обрабатывает `GET/POST /api/company-info?company=xxx` и работает с `company-info-{companyId}.json`;
  - обрабатывает `GET/POST/DELETE /api/companies` для управления компаниями;
  - обрабатывает `GET/POST/DELETE /api/users` и работает с `users.json`;
  - обрабатывает `PUT /api/users/:login/companies` для управления доступом к компаниям;
  - обрабатывает `POST /api/auth` для проверки авторизации;
  - поддерживает лимит размера запроса до 10MB для загрузки изображений.
- `companies.json` — файл со списком всех компаний (создаётся автоматически);
- `gantt-state-{companyId}.json` — файлы с сохранённым состоянием диаграммы для каждой компании (создаются автоматически);
- `company-info-{companyId}.json` — файлы с информацией о компании (логотип и название) для каждой компании (создаются автоматически);
- `users.json` — файл с данными пользователей (создаётся автоматически);
- `xlsx.min.js` — локальная копия библиотеки XLSX для экспорта в Excel (лежит рядом с `implementation_schedule.html`, чтобы не зависеть от CDN в корпоративной сети).
- `package.json` — описание проекта и зависимостей:

```json
{
  "name": "icona-gantt-schedule",
  "version": "1.0.0",
  "description": "Интерактивная диаграмма Ганта ICONA",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^5.1.0"
  }
}
```

---

## Подсказка для деплоя (например, через GitHub + Render/Railway)

Если этот README открыт на GitHub и нужно быстро понять, как развернуть модуль:

1. **Что именно разворачиваем**
   - страницу авторизации: `auth.html`;
   - страницу выбора компаний: `companies.html`;
   - админ-панель: `admin.html`;
   - фронтенд‑страницу: `implementation_schedule.html`;
   - Node/Express‑сервер: `server.js` с API для работы с компаниями, пользователями и графиками.

2. **Куда деплоить**
   - Код хранится в репозитории GitHub;
   - Платформа должна уметь запускать Node/Express‑приложение
     (Render, Railway, Fly.io, любой VPS и т.п.);
   - Команда запуска сервера: `npm start`;
   - Убедитесь, что платформа поддерживает постоянное хранилище для JSON файлов.

3. **Что получится на выходе**
   - Публичный URL для авторизации:
     `https://<имя‑сервера>/auth.html`
   
   - Публичный URL для выбора компаний:
     `https://<имя‑сервера>/companies.html`
   
   - Публичный URL для графика конкретной компании:
     `https://<имя‑сервера>/implementation_schedule.html?company=xxx`

   - Страница графика по этому адресу должна уметь:
     - загружать состояние диаграммы из `/api/gantt-state?company=xxx`;
     - сохранять изменения обратно в `/api/gantt-state?company=xxx` по мере работы пользователя;
     - загружать информацию о компании (логотип и название) из `/api/company-info?company=xxx`;
     - сохранять информацию о компании обратно в `/api/company-info?company=xxx`;
     - проверять доступ пользователя к компании перед загрузкой данных.

Если в этом файле чего‑то не хватает для конкретного варианта деплоя, можно дополнить раздел «Подсказка для деплоя» под вашу площадку.# implementation_schedule
